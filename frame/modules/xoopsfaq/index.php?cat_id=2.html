<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja"><!-- $Id: theme.html,v 1.1.1.1 2003/04/21 14:30:51 jc Exp $ --><head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="content-language" content="ja">
<meta name="robots" content="index,follow">
<meta name="keywords" content="MySQL, User group, MyNA, Nippon, Japan, MySQLユーザ会">
<meta name="description" content="MySQL is fast, robust, reliable open source database.">
<meta name="rating" content="general">
<meta name="author" content="MyNA Webmaster">
<meta name="copyright" content="Copyright ? 2001-2005">
<meta name="generator" content="XOOPS">
<title>MyNA Web Site</title>
<link href="../../favicon.ico" rel="SHORTCUT ICON">
<link rel="stylesheet" type="text/css" media="all" href="../../xoops.css">
<link rel="stylesheet" type="text/css" media="all" href="../../themes/myna/styleNN.css">
<!-- RMV: added module header -->

<script type="text/javascript">
<!--
//--></script><script type="text/javascript" src="../../include/xoops.js"></script><script type="text/javascript"><!--
//-->
</script>
</head>
<body>

<!-- Main Table -->

<table id="main" cellspacing="0">
  <tbody><tr>
    <!-- Center Column -->
    <!-- Main Contents -->
    <td id="centerColumn">
      <div id="content">
      <h4 style="text-align:left;">FAQ（よくある質問と回答）</h4>
<a id="top" name="top"></a><a href="index.php.html">メインページ</a>&nbsp;<span style="font-weight:bold;">»»</span>&nbsp;<b>MySQL運用</b><br><br>
<table width="100%" class="outer" cellspacing="1">
  <tbody><tr>
    <th colspan="2">目次</th>
  </tr>
  <tr>
    <td colspan="2" class="even">
      <ul style="list-style-image:url(images/question.gif);">

      <!-- start question loop -->
      
        <li>&nbsp;<a href="index.php%3Fcat_id%3D2.html#q2">ストレージエンジン??</a></li>

      
        <li>&nbsp;<a href="index.php%3Fcat_id%3D2.html#q4">複数のMySQLを同居させるには/MySQLを違うディレクトリで動かすには</a></li>

      
        <li>&nbsp;<a href="index.php%3Fcat_id%3D2.html#q9">I/O分散</a></li>

      
        <li>&nbsp;<a href="index.php%3Fcat_id%3D2.html#q12">ログ</a></li>

      
        <li>&nbsp;<a href="index.php%3Fcat_id%3D2.html#q15">3.X,4.0 -&gt; 4.1 以上</a></li>

      
        <li>&nbsp;<a href="index.php%3Fcat_id%3D2.html#q5">4.1サーバーと4.0クライアント</a></li>

      
        <li>&nbsp;<a href="index.php%3Fcat_id%3D2.html#q3">version 4.1 以上の文字コード変換機能とうまくつきあうには?</a></li>

      
        <li>&nbsp;<a href="index.php%3Fcat_id%3D2.html#q6">4.1 にupgradeしたら文字が?になります / 4.1 にしたらクエリの結果がおかしいことがある</a></li>

      
        <li>&nbsp;<a href="index.php%3Fcat_id%3D2.html#q14">日本語環境の設定</a></li>

            <!-- end question loop -->

      </ul>
    </td>
  </tr>
</tbody></table>
<br><br>
<table width="100%" class="outer" cellspacing="1">

<!-- start question and answer loop -->

  <tbody><tr>
    <th><a id="q2" name="q2"></a>ストレージエンジン??</th>
  </tr>
  <tr>
    <td class="even">MySQL は、データの保存形式を複数持っています。<br>その保存形式により、機能や特徴、パフォーマンスが変わります。<br>これをストレージエンジンと呼んでいます。<br><br>このモデルの利点は:<br>- 用途にあったストレージエンジンを選択することで、特別なチューニングを施すことなく、<br>  その目的に合った能力を得ることができる。<br>- 古いバージョンのMySQLで作成したファイルは、MySQLをバージョンアップをしてもそのまま使い続けることができる。<br>  MySQL のバージョンアップに際して、データの吸い上げ、入れ直しは発生しない。<br>- 新しい手法が登場したとき、簡単にその手法を取り入れ、よりよい環境を提供できる。<br>- あるストレージエンジンは他のストレージエンジンに影響を及ぼさない。<br>  このため、バグの影響が少ない<br><br>実際の使い方は<br>CREATE TABLE ..... (.....) TYPE=InnoDB;<br>のようにするだけ。<br>ALTER TABLE .... TYPE=MyISAM;<br>のように、テーブルのストレージエンジンを ALTER TABLE 文で変えることも可能。(TYPEのかわりに ENGINE キーワードでも OK)<br><br>代表的なストレージエンジン:<br>MyISAM  : 検索に強い<br>InnoDB  : トランザクション<br>HEAP(MEMORY) : メモリ内で動作するテーブル<br><br>標準のストレージエンジンは MyISAM。<br>すなわち、TYPE とか ENGINE を指定しなければ、テーブルの型は  MyISAM になるということ。<br><br><div style="text-align: right"><a href="index.php%3Fcat_id%3D2.html#top">トップに戻る</a></div></td>
  </tr>


  <tr>
    <th><a id="q4" name="q4"></a>複数のMySQLを同居させるには/MySQLを違うディレクトリで動かすには</th>
  </tr>
  <tr>
    <td class="even">mysqld --basedir=/usr/local/mysql-4.0.22 --datadir=/usr/local/mysql-4.0.22/data --socket=/tmp/sock4.0.22 --port=4022 &amp;<br><br>もしくは<br><br>/usr/local/mysql-4.0.22/my.cnf<br>に<br>[mysqld]<br>basedir=/usr/local/mysql-4.0.22<br>datadir=/usr/local/mysql-4.0.22/data<br>socket=/tmp/sock4.0.22<br>port=4022<br>と書いて<br><br>mysqld --defaults-file=/usr/local/mysql-4.0.22/my.cnf &amp;<br><br><div style="text-align: right"><a href="index.php%3Fcat_id%3D2.html#top">トップに戻る</a></div></td>
  </tr>


  <tr>
    <th><a id="q9" name="q9"></a>I/O分散</th>
  </tr>
  <tr>
    <td class="even">MyISAMの場合<br>CREATE TABLE .... (...) DATA DIRECTORY = '/path/to/directory/MYD'  INDEX DIRECTORY = '/path/to/directory/MYI'<br><br>InnoDB の場合1<br>[mysqld]<br>innodb_data_home_dir =<br>innodb_data_file_path=/path/to/file1:10M;/path/to/file2:50M<br><br>InnoDBの場合2<br>[mysqld]<br>innodb_file_per_table<br><br>OSでの対処の場合<br>データベースは単なるディレクトリなので、<br>違うdiskをそのディレクトリにマウント<br><div style="text-align: right"><a href="index.php%3Fcat_id%3D2.html#top">トップに戻る</a></div></td>
  </tr>


  <tr>
    <th><a id="q12" name="q12"></a>ログ</th>
  </tr>
  <tr>
    <td class="even">log-bin (バイナリ更新ログ) が肝です。<br># 3.22 までは、log-update (更新ログ) を使います。<br><br>log-bin 採取開始時のデータに対して、log-bin の内容(テキストのSQL文) を順に全て当てていけば、現在のデータになります。<br>もちろん、ログの途中まであてれば、その時までの状態になります。<br><br>どういう運用ができるかはあなたのアイデア次第。<br><br>max_binlog_size :<br>  1つのバイナリ更新ログファイルの最大サイズ。これに達すると、自動でローテート<br><br>log-bin=名前<br>  バイナリ更新ログファイルの名前の指定。ディレクトリを含めることが出来る。 log-bin=/disk1/logfile とすると、/disk1/logfile.###### ファイルになる。<br><div style="text-align: right"><a href="index.php%3Fcat_id%3D2.html#top">トップに戻る</a></div></td>
  </tr>


  <tr>
    <th><a id="q15" name="q15"></a>3.X,4.0 -&gt; 4.1 以上</th>
  </tr>
  <tr>
    <td class="even">1. クライアントの upgrade<br>Ruby, PHP, Perl など、C クライアントを 4.1 (以上)の libmysqlclient にリンクし直してインストール<br>なお、文字の自動変換機能による弊害が発生する可能性があるので、他のFAQを参考のこと。<br><br><br>2. 念のため、mysqldump でバックアップ<br><br><br>3.  upgrade<br>[mysqld]<br>default-character-set = ujis<br>old-passwords<br><br>[mysqldump]<br>default-character-set = ujis<br><br>old-passwords オプションは、4.1以上のサーバーの認証方法を、4.0 までの認証方法のままにするということ。<br><br><br>4. 権限テーブル upgrade<br>mysql_fix_privilege_tables もしくは<br>mysql -f -uroot mysql &lt; mysql_fix_privilege_tables.sql<br><div style="text-align: right"><a href="index.php%3Fcat_id%3D2.html#top">トップに戻る</a></div></td>
  </tr>


  <tr>
    <th><a id="q5" name="q5"></a>4.1サーバーと4.0クライアント</th>
  </tr>
  <tr>
    <td class="even">[mysqld-4.1]<br>old-passwords<br><br>MySQL 4.1 サーバーを 4.0 までの認証で動かす。<br><div style="text-align: right"><a href="index.php%3Fcat_id%3D2.html#top">トップに戻る</a></div></td>
  </tr>


  <tr>
    <th><a id="q3" name="q3"></a>version 4.1 以上の文字コード変換機能とうまくつきあうには?</th>
  </tr>
  <tr>
    <td class="even">MySQL version 4.1 から、utf8 が組み込まれたり、文字コードの自動変換が組み込まれたりと、けっこう文字周りがかわりました。<br>4.0までの MySQL とは感覚が変わるので、一応、こうした方がトラブルは少ないね、という経験上のものを書いておきます。<br><br>- mysqldump には必ず --default-character-set= を指定すること。<br>- MySQL サーバーとクライアントは、必ず同じキャラクターセットにしておくこと。<br>- 4.1以上対応のアプリケーションには、必ず "SET NAMES キャラクターセット名" という SQL 文を付けておくこと。<br>- データベース名、テーブル名、フィールド名には、マルチバイト文字は使用しないこと。<br>- マルチバイトキャラクターセットと、latin1などのシングルバイトキャラクターセットを混在させないようにすること。<br>- キャラクターセットはデータベース単位、テーブル単位、フィールド単位で指定できるが、フィールド単位でのキャラクターセットの指定はなるべく避けた方がよいだろう<br>- 文字の自動変換機能を抑止する、--default-character-set=binary の使用が便利。<br>- 既にコンパイル済みのバイナリを使うときは、そのバイナリが作成されたときに埋め込まれている、標準のキャラクターセットを知っておいた方がよい。<br>-- !!! MySQL AB のバイナリは latin1 が標準 !!!<br>- 自分でコンパイルする場合は、binary キャラクターセットを標準に指定してコンパイルすれば、アプリの変更や設定の変更無しに、MySQL 4.0,3.23 対象のアプリが動く。<br>- --init-connect='SET NAMES キャラクタセット名' は使わない。これはクライアントコマンドオプション --default-character-set= を無効にしてしまうから。<br>- 4.1 の mysqldump には --hex-blob というオプションが追加されている。これは BLOB のバイナリデータを壊さずに mysqldump 可能になる。<br><div style="text-align: right"><a href="index.php%3Fcat_id%3D2.html#top">トップに戻る</a></div></td>
  </tr>


  <tr>
    <th><a id="q6" name="q6"></a>4.1 にupgradeしたら文字が?になります / 4.1 にしたらクエリの結果がおかしいことがある</th>
  </tr>
  <tr>
    <td class="even">4.1 から文字の自動変換機能の追加、char() の仕様変更がありました。<br>なので、サーバーを 4.1 に upgrade すると、文字が ? になったり、文字が変になったり、クエリーの結果がおかしくなったりすることがあります。<br>4.1 に upgrade するならば、以下のようにします。<br><br>1. まず、ソースから MySQL をビルドし直す。charset は binary にして。(後述、備考参照)<br><br>2. ビルドしてできた libmysqlclient (windows の場合は libmysql.dll) を使用して、PHP, Perl, Ruby, などの MySQL モジュールをコンパイルし直す。<br><br>3. サーバーを 4.1 にする前に、念のためバックアップを取っておく<br><br>4. サーバーを 4.1 にする<br>/etc/my.cnf には<br>   [mysqld-4.1]<br>   old-passwords<br> <br>   [mysqld]<br>   default-character-set=使用するキャラクターセット名<br> <br>   [mysqldump]<br>   default-character-set=使用するキャラクターセット名<br>   skip-opt<br><br>  を書いて、4.1 の サーバー起動<br><br>5.  mysql_fix_privilege_tables を実行して、mysql データベースの権限テーブルを upgrade する。<br>Windows の場合は、<br> mysql -f -uroot mysql &lt; mysql_fix_privilege_tables.sql<br>とする<br><br>6. すべてのテーブルを ALTER する。<br>char() の定義がおかしくなっているので、指定し直す。<br>Unix の場合は、MyNA の <a href="../bwiki/%3FContrib.html" target="_blank">http://www.mysql.gr.jp/frame/modules/bwiki/?Contrib</a> にあるシェルスクリプトを使ってもよい。<br><br><br>7. また、mysql コマンド、mysqldump コマンド等は、必ず、default-character-set= を指定して使用しましょう。<br>character-set はサーバーと同じにしましょう。<br><br><br>8. クライアントプログラムに、'SET NAMES ' 文を追加する方法もあります。この場合は、1,2 の手順は必須ではなくなります。<br><br><br>備考. ソースからのビルド<br>Unix なら ./configure --with-charset=binary にする。<br>Windows なら、<br>include/my_config.h , include/config-win.h の<br><br>#define MYSQL_DEFAULT_CHARSET_NAME "latin1"<br>を<br>#define MYSQL_DEFAULT_CHARSET_NAME "binary"<br>に。<br><br>#define MYSQL_DEFAULT_COLLATION_NAME "latin1_swedish_ci"<br>を<br>#define MYSQL_DEFAULT_COLLATION_NAME "binary"<br>に。<br><div style="text-align: right"><a href="index.php%3Fcat_id%3D2.html#top">トップに戻る</a></div></td>
  </tr>


  <tr>
    <th><a id="q14" name="q14"></a>日本語環境の設定</th>
  </tr>
  <tr>
    <td class="even">標準のキャラクターセットが日本語になっていないバイナリを使用するときは、設定をしておきます。<br><br>[mysqld]<br>default-character-set = ujis<br><br>[mysqldump]<br>default-character-set = ujis<br><br>[mysql]<br>default-character-set = ujis<br><br>---<br>なお、language = の指定は、日本語が扱える、扱えないには、全く関係ありません。設定しても無意味。<br>たんにエラーメッセージが日本語になるだけで、クエリやデータを日本語扱いにするという意味ではありません。<br>エラーメッセージが日本語になっても邪魔くさい(変な文)ので、通常はlanguageは指定しません。<br><br><div style="text-align: right"><a href="index.php%3Fcat_id%3D2.html#top">トップに戻る</a></div></td>
  </tr>

<!-- end question and answer loop -->

</tbody></table>
<br><br>
<div style="text-align:center;"><b>[ <a href="index.php.html">メインページ</a> ]</b></div>

<div style="text-align:center; padding: 3px; margin:3px;">
  
<form method="get" action="index.php">
<table width="95%" class="outer" cellspacing="1">
  <tbody><tr>
    <td class="even" align="center"><select name="com_mode"><option value="flat" selected="selected">フラット表示</option><option value="thread">スレッド表示</option><option value="nest">ネスト表示</option></select> <select name="com_order"><option value="0" selected="selected">古いものから</option><option value="1">新しいものから</option></select><input type="hidden" name="cat_id" value="2"> <input type="submit" value="更新" class="formButton">
    </td>
  </tr>
</tbody></table>
</form>
  投稿された内容の著作権はコメントの投稿者に帰属します。
</div>

<div style="margin:3px; padding: 3px;">
<!-- start comments loop -->
  <table class="outer" cellpadding="5" cellspacing="1">
  <tbody><tr>
    <th width="20%">投稿者
    </th><th>スレッド
  </th></tr>
  </tbody></table><!-- end comments loop -->
</div>
      </div>

        <!-- Display center blocks if any -->
                <!-- End display center blocks -->

    </td>

  </tr>
</tbody></table>

<!-- Footer -->
<p id="copyright">
&lt;<a href="mailto:webmaster@mysql.gr.jp">webmaster@mysql.gr.jp</a>&gt;<br>
Copyright 2000-2005 © <a href="../../../index.html" target="_TOP">MyNA</a>. All Rights Reserved. Feel free to link. 

</p></body></html>