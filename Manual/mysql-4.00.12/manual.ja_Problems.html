<html><head>
  <!-- This HTML file has been created by texi2html 1.52 (hacked by david@detron.se)
     from manual.ja.texi on 4 March 2004 -->

  <title>MySQL Reference Manual for version 4.0.12. - A  Problems and Common Errors</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  </head>
  <body bgcolor="silver" text="#000000" link="#101090" vlink="#7030B0">
Go to the <a href="manual.ja_Introduction.html">first</a>, <a href="manual.ja_Extending_MySQL.html">previous</a>, <a href="manual.ja_Contrib.html">next</a>, <a href="manual.ja_Concept_Index.html">last</a> section, <a href="manual.ja_toc.html">table of contents</a>.
<p></p><hr><p>


</p><h1><a name="Problems" href="manual.ja_toc.html#Problems">A  Problems and Common Errors</a></h1>

<p>
<a name="IDX1767"></a>
<a name="IDX1768"></a>

</p>

<p>
This chapter lists some common problems and error messages that users have
run into.  You will learn how to figure out what the problem is, and what
to do to solve it.  You will also find proper solutions to some common
problems.

</p>



<h2><a name="What_is_crashing" href="manual.ja_toc.html#What_is_crashing">A.1  How to Determine What Is Causing Problems</a></h2>

<p>
When you run into problems, the first thing you should do is to find out
which program / piece of equipment is causing problems:

</p>

<ul>
<li>

If you have one of the following symptoms, then it is probably a hardware
(like memory, motherboard, CPU, or hard disk) or kernel problem:

<ul>
<li>

The keyboard doesn't work.  This can normally be checked by pressing
Caps Lock. If the Caps Lock light doesn't change you have to replace
your keyboard.  (Before doing this, you should try to reboot
your computer and check all cables to the keyboard.)
</li><li>

The mouse pointer doesn't move.
</li><li>

The machine doesn't answer to a remote machine's pings.
</li><li>

Different, unrelated programs don't behave correctly.
</li><li>

If your system rebooted unexpectedly (a faulty user level program should
<strong>never</strong> be able to take down your system).
</li></ul>

In this case you should start by checking all your cables and run some
diagnostic tool to check your hardware!
You should also check if there are any patches, updates, or service
packs for your operating system that could likely solve your problems.
Check also that all your libraries (like glibc) are up to date.

It's always good to use a machine with ECC memory to discover
memory problems early!
</li><li>

If your keyboard is locked up, you may be able to fix this by
logging into your machine from another machine and execute
<code>kbd_mode -a</code> on it.

</li><li>

Please examine your system log file (/var/log/messages or similar) for
reasons for your problems.  If you think the problem is in MySQL
then you should also examine MySQL's log files.  「<a href="manual.ja_MySQL_Database_Administration.html#Update_log">4.9.3  更新ログ</a>」節参照.

</li><li>

If you don't think you have hardware problems, you should try to find
out which program is causing problems.

Try using <code>top</code>, <code>ps</code>, <code>taskmanager</code>, or some similar program,
to check which program is taking all CPU or is locking the machine.

</li><li>

Check with <code>top</code>, <code>df</code>, or a similar program if you are out of
memory, disk space, open files, or some other critical resource.

</li><li>

If the problem is some runaway process, you can always try to kill it. If it
doesn't want to die, there is probably a bug in the operating system.
</li></ul>

<p>
If after you have examined all other possibilities and you have
concluded that it's the MySQL server or a MySQL client
that is causing the problem, it's time to do a bug report for our
mailing list or our support team.  In the bug report, try to give a
very detailed description of how the system is behaving and what you think is
happening. You should also state why you think it's MySQL that
is causing the problems.  Take into consideration all the situations in
this chapter. State any problems exactly how they appear when you
examine your system. Use the 'cut and paste' method for any output
and/or error messages from programs and/or log files!

</p>
<p>
Try to describe in detail which program is not working and all
symptoms you see!  We have in the past received many bug reports that just
state "the system doesn't work".  This doesn't provide us with any
information about what could be the problem.

</p>
<p>
If a program fails, it's always useful to know:

</p>

<ul>
<li>

Has the program in question made a segmentation fault (core dumped)?
</li><li>

Is the program taking up the whole CPU? Check with <code>top</code>. Let the
program run for a while, it may be evaluating something heavy.
</li><li>

If it's the <code>mysqld</code> server that is causing problems, can you
do <code>mysqladmin -u root ping</code> or <code>mysqladmin -u root processlist</code>?
</li><li>

What does a client program say (try with <code>mysql</code>, for example)
when you try to connect to the MySQL server?
Does the client jam?  Do you get any output from the program?
</li></ul>

<p>
When sending a bug report, you should of follow the outlines
described in this manual.  「<a href="manual.ja_Introduction.html#Asking_questions">1.6.1.2  質問またはバグ報告</a>」節参照.

</p>



<h2><a name="Common_errors" href="manual.ja_toc.html#Common_errors">A.2  MySQL 使用時のよくあるいくつかのエラー</a></h2>

<p>
<a name="IDX1769"></a>

</p>

<p>
This section lists some errors that users frequently get.  You will find
descriptions of the errors, and how to solve the problem here.

</p>



<h3><a name="Error_Access_denied" href="manual.ja_toc.html#Error_Access_denied">A.2.1  <code>Access denied</code> エラー</a></h3>

<p>
<a name="IDX1770"></a>
<a name="IDX1771"></a>
<a name="IDX1772"></a>

</p>
<p>
 「<a href="manual.ja_MySQL_Database_Administration.html#Access_denied">4.2.11  何故 <code>Access denied</code> エラーになるのか</a>」節参照.
 「<a href="manual.ja_MySQL_Database_Administration.html#Privileges">4.2.6  特権システムはどのように動くか？</a>」節参照.

</p>



<h3><a name="Gone_away" href="manual.ja_toc.html#Gone_away">A.2.2  <code>MySQL server has gone away</code> エラー</a></h3>

<p>
このセクションは <code>Lost connection to server
during query</code> エラーに関することもカバーします。

</p>
<p>
<code>MySQL server has gone away</code> エラーのもっとも一般的な理由は、サーバ
がタイムアウトで接続をクローズしたことです。デフォルトでは、何も起きない
場合、サーバは 8 時間後に接続をクローズします。
この時間は <code>mysqld</code> 起動時の <code>wait_timeout</code> 変数に与えることにより、変
更できます。

</p>
<p>
Another common reason to receive the <code>MySQL server has gone away</code> error
is because you have issued a ``close'' on your MySQL connection
and then tried to run a query on the closed connection.

</p>
<p>
<code>mysqladmin version</code> を実行することで MySQL が死んでいるかどうか、
また uptime はどれぐらいか、チェックできます。

</p>
<p>
スクリプトの場合は、自動的に再接続するためにクライアントからクエリを再発
行する必要があります。

</p>
<p>
この場合、通常これらのエラーコードを得ます:
(OS 依存です):

</p>
<table border="" width="100%" nosave="">
<tbody><tr><td><code>CR_SERVER_GONE_ERROR</code> </td><td> クライアントがサーバーに問い合わせを送る
ことができなかった
server.
</td></tr>
<tr><td><code>CR_SERVER_LOST</code> </td><td> クライアントがサーバーに書き込みを行ったときに
はエラーは無かったけれども、問い合わせに対して完全に回答が返ってこない
</td></tr>
</tbody></table>

<p>
You will also get this error if someone has kills the running thread with
<code>kill #threadid#</code>.

</p>
<p>
You can check that the MySQL hasn't died by executing <code>mysqladmin
version</code> and examining the uptime.  If the problem is that mysqld
crashed you should concentrate one finding the reason for the crash.
You should in this case start by checking if issuing the query again
will kill MySQL again.  「<a href="manual.ja_Problems.html#Crashing">A.4.1  What To Do If MySQL Keeps Crashing</a>」節参照.

</p>
<p>
間違っているか大きすぎるクエリをサーバに送った場合にもこのエラーが発生し
ます。<code>mysqld</code> が間違ったブロックを得た場合、クライアントの何かが間違った
と見なし、接続をクローズします。大きなクエリが必要な場合、例えば大きな 
<code>BLOB</code> で働かせる場合は、<code>mysqld</code> をオプション <code>-O max_query_size=#</code>
(デフォルト 1M) で起動することでクエリ制限を増加できます。拡張メモリ
はオンデマンドで割り当てられます。そのため、<code>mysqld</code> は大きなクエリを発行し
た時や大きな結果行を返す必要のある時だけ、多くのメモリを割り当てます！

</p>
<p>
You will also get a lost connection if you are sending a packet &gt;= 16M
if your client is older than 4.0.8 and your server is 4.0.8 and above, or
the other way around.

</p>
<p>
If you want to make a bug report regarding this problem, be sure that
you include the following information:

</p>

<ul>
<li>

Include information if MySQL died or not. (You can find this in the
<code>hostname.err file</code>.  「<a href="manual.ja_Problems.html#Crashing">A.4.1  What To Do If MySQL Keeps Crashing</a>」節参照.
</li><li>

If a specific query kills <code>mysqld</code> and the involved tables where
checked with <code>CHECK TABLE</code> before you did the query, can you do
a test case for this?  「<a href="manual.ja_Porting.html#Reproduceable_test_case">E.1.6  Making a Test Case When You Experience Table Corruption</a>」節参照.
</li><li>

What is the value of the <code>wait_timeout</code> variable in the MySQL server ?
<code>mysqladmin variables</code> gives you the value of this
</li><li>

Have you tried to run <code>mysqld</code> with <code>--log</code> and check if the
issued query appears in the log ?
</li></ul>

<p>
 「<a href="manual.ja_Introduction.html#Asking_questions">1.6.1.2  質問またはバグ報告</a>」節参照.

</p>


<h3><a name="Can_not_connect_to_server" href="manual.ja_toc.html#Can_not_connect_to_server">A.2.3  <code>Can't connect to [local] MySQL server</code> エラー</a></h3>

<p>
UNIX 上の MySQL クライアントは  <code>mysqld</code> サーバに2つの異なる方法で
接続できます:
UNIX ソケット, これはファイルシステム上のファイル(デフォルト 
<tt>`/tmp/mysql.sock'</tt>)を通して接続します。または TCP/IP, これはポート番
号を通して接続します。Unix ソケットは TCP/IP よりも速いですが、サーバと
同じコンピュータから接続する時しか使えません。UNIX ソケットは、ホスト名
を指定しない場合か、特別なホスト名 <code>localhost</code> を指定した場合に使用され
ます。

</p>
<p>
On Windows, if the <code>mysqld</code> server is running on 9x/Me, you can
connect only via TCP/IP. If the server is running on NT/2000/XP and
mysqld is started with <code>--enable-named-pipe</code>, you
can also connect with named pipes. The name of the named pipe is MySQL.
If you don't give a hostname when connecting to <code>mysqld</code>, a MySQL
client will first try to connect to the named pipe, and if this doesn't
work it will connect to the TCP/IP port.  You can force the use of named
pipes on Windows by using <code>.</code> as the hostname.

</p>
<p>
(2002) <code>Can't connect to ...</code> エラーは、通常、MySQL サーバーが
システム上に走っていないか、あなたが、間違ったソケットファイルや
TCP/IP ポートを使用して <code>mysqld</code> に接続しようとする場合におきます。

</p>
<p>
サーバー上に <code>mysqld</code> というプロセスが走っているか ( <code>ps</code> を使用して。
 Windows の場合はタスクマネージャでみて)
確認することから開始してください！
 「<a href="manual.ja_Installing.html#Starting_server">2.4.2  MySQL サーバー起動時の問題</a>」節参照.

</p>
<p>
<code>mysqld</code> プロセスが走っているなら、違う接続を試すことでサーバーを
確認することができます（もちろん、ポート番号とソケットのパスはあなたが
セットアップしたものとは違うでしょう）：

</p>

<pre>shell&gt; mysqladmin version
shell&gt; mysqladmin variables
shell&gt; mysqladmin -h `hostname` version variables
shell&gt; mysqladmin -h `hostname` --port=3306 version
shell&gt; mysqladmin -h 'ip for your host' version
shell&gt; mysqladmin --protocol=socket --socket=/tmp/mysql.sock version
</pre>

<p>
<code>hostname</code> コマンドはフォワードクオートでなくバッククオテーションで
囲んでいることに注意してください； これは <code>ホスト名</code> (カレントのホスト名) 
を <code>mysqladmin</code> コマンドに与えます。

</p>
<p>
<code>Can't connect to local MySQL server</code> エラーが起こりうる理由として：

</p>

<ul>
<li>

<code>mysqld</code> is not running.

</li><li>

MIT-pthreads を使用するシステム上で実行している。
ネイティブスレッドを持たないシステム上で実行している場合 <code>mysqld</code> は 
MIT-pthreads パッケージを使用します。 「<a href="manual.ja_Installing.html#Which_OS">2.2.5  MySQL がサポートする OS</a>」節参照. 
MIT-pthreads スレッドは UNIX ソケットをサポートしません。
そのため、サーバに接続する時は常にホスト名を与える必要があります。
サーバーへの接続をチェックするために、以下を試してください：

<pre>shell&gt; mysqladmin -h `hostname` version
</pre>

</li><li>

誰かが <code>mysqld</code> が使用する UNIX ソケット を削除した (default <tt>`/tmp/mys
qld.sock'</tt>).
だれかが <code>cron</code> で MySQL ソケットを削除しているかもしれません。(例
えば <tt>`/tmp'</tt> ディレクトリから古いファイルを削除するようなクローンで)。
いつでも <code>mysqladmin version</code> を実行して
<code>mysqladmin</code> が使用するソケットが本当に存在するかをチェックできます。
この場合の修正は、<tt>`mysqld.sock'</tt> を消さないように <code>cron</code> を変更するか、
またはソケットをどこか他の場所に移すことです。
 「<a href="manual.ja_Problems.html#Problems_with_mysql.sock">A.4.5  MySQL ソケットファイル <tt>`/tmp/mysql.sock'</tt> を変更する方法、削除から守る方法</a>」節参照.

</li><li>

<code>--socket=/path/to/socket</code> オプションで <code>mysqld</code> サーバーを起動できます。
もしサーバーのソケットのパスを変えた場合、MySQL クライアントに、新しい
パスを教えなければなりません。
 「<a href="manual.ja_Problems.html#Problems_with_mysql.sock">A.4.5  MySQL ソケットファイル <tt>`/tmp/mysql.sock'</tt> を変更する方法、削除から守る方法</a>」節参照.

</li><li>

Linux を使用していてスレッドが一つ死んだとき（コアダンプした）。
この場合、他の <code>mysqld</code> スレッドをキルしなければなりません。
たとえば、<code>mysql_zap</code> スクリプトを、新しく MySQL サーバーを
起動する前に実行します。   「<a href="manual.ja_Problems.html#Crashing">A.4.1  What To Do If MySQL Keeps Crashing</a>」節参照.

</li><li>

You may not have read and write privilege to either the directory that holds
the socket file or privilege to the socket file itself. In this case you
have to either change the privilege for the directory / file or restart
<code>mysqld</code> so that it uses a directory that you can access.
</li></ul>

<p>
もし <code>Can't connect to MySQL server on some_hostname</code> エラーの場合,
何が問題なのかを見つけるために、以下の手順を踏みます：

</p>

<ul>
<li>

もし <code>telnet your-host-name tcp-ip-port-number</code> を実行すると
サーバーがアップするなら、 <code>RETURN</code> を何回かたたいてください。
もしこのポートで MySQL サーバーが走っているなら、
走っている MySQL サーバーのバージョンナンバーを含んだ
レスポンスが得られるはずです。
もし <code>telnet: Unable to connect to remote host: Connection refused</code> のような
エラーになったならば、このポートを使用しているサーバーはありません。

</li><li>

ローカルのマシンの <code>mysqld</code> デーモンに接続してみてください。
<code>mysqldmin variables</code> で、<code>mysqld</code> が使用するように指定された 
TCP/IP ポート(変数 <code>port</code>)をチェックしてください。

</li><li>

<code>mysqld</code> サーバーが <code>--skip-networking</code> オプションで起動されていないか
確認してください。
</li></ul>



<h3><a name="Blocked_host" href="manual.ja_toc.html#Blocked_host">A.2.4  <code>Host '...' is blocked</code> エラー</a></h3>

<p>
以下のエラーの場合：

</p>

<pre>Host 'hostname' is blocked because of many connection errors.
Unblock with 'mysqladmin flush-hosts'
</pre>

<p>
これは <code>mysqld</code> が多くの <code>'hostname'</code> ホストからの接続エラー(<code>max
_connect_errors</code>)
を受けた場合に発生します。
この <code>max_connect_errors</code> 大量発生後、<code>mysqld</code> は何か(クラッカーによる
サーバーへのアタックなど)が起こったと判断し、このホストからの接続をいっさい拒否
するようにします。
これを解除するには、<code>mysqladmin flush-hosts</code> コマンドを実行します。

</p>
<p>
デフォルトでは、10回の接続エラーが発生した場合に、<code>mysqld</code> はそのホストを拒
否します。
この値は以下のようにして簡単に変更できます：

</p>

<pre>shell&gt; safe_mysqld -O max_connect_errors=10000 &amp;
</pre>

<p>
もしこのエラーがあるホストに対して発生するならば、まず最初にそのホストからの TCP
/IP 接続に不具合がないかチェックしてください。
もし TCP/IP 接続が動作していないようなら、 <code>max_connect_errors</code> 値を増やす
ことはよくないことです！

</p>



<h3><a name="Too_many_connections" href="manual.ja_toc.html#Too_many_connections">A.2.5  <code>Too many connections</code> エラー</a></h3>

<p>
もし MySQL に接続しようとして <code>Too many connections</code> となった場合、
これは既に <code>max_connections</code> 分、クライアントから <code>mysqld</code> サーバーへの
接続が行われています。

</p>
<p>
もしデフォルトの100よりも多い接続を必要とするならば、
<code>max_connections</code> 変数に多くの値を与えて、<code>mysqld</code> を
リスタートしなくてはなりません。

</p>
<p>
実際は、<code>mysqld</code> は (<code>max_connections</code>+1) 個のクライアントからの接続を
許しています。
最後の１個は、 <code>SUPER</code> 権限 (version4.0.2以上。未満は <code>PROCESS</code> 権限)を
もつユーザーのために取ってあります。
By not giving this privilege to normal
users (they shouldn't need this), an administrator with this privilege
can log in and use <code>SHOW PROCESSLIST</code> to find out what could be
wrong.  「<a href="manual.ja_MySQL_Database_Administration.html#SHOW_PROCESSLIST">4.5.6.6  <code>SHOW PROCESSLIST</code></a>」節参照.

</p>
<p>
The maximum number of connects MySQL is depending on how good
the thread library is on a given platform. Linux or Solaris should be
able to support 500-1000 simultaneous connections, depending on how much
RAM you have and what your clients are doing.

</p>



<h3><a name="Non-transactional_tables" href="manual.ja_toc.html#Non-transactional_tables">A.2.6  <code>Some non-transactional changed tables couldn't be rolled back</code> エラー</a></h3>

<p>
<a name="IDX1773"></a>

</p>
<p>
もし <code>ROLLBACK</code> を試みたときに
<code>Warning: Some non-transactional changed tables couldn't be rolled back</code>
エラー/警告が出た場合、これは、あなたが使用しているテーブルがトランザクションを
サポートしていないということです。
これらの非トランザクションのテーブルは <code>ROLLBACK</code> によって、何の影響も受けません。

</p>
<p>
The most typical case when this happens is when you have tried to create
a table of a type that is not supported by your <code>mysqld</code> binary.
If <code>mysqld</code> doesn't support a table type (or if the table type is
disabled by a startup option) , it will instead create the table type
with the table type that is most resembles to the one you requested,
probably <code>MyISAM</code>.

</p>
<p>
以下の SQL 文でテーブルの型をチェックできます:

</p>
<p>
<code>SHOW TABLE STATUS LIKE 'table_name'</code>.  「<a href="manual.ja_MySQL_Database_Administration.html#SHOW_TABLE_STATUS">4.5.6.2  <code>SHOW TABLE STATUS</code></a>」節参照.

</p>
<p>
You can check the extensions your <code>mysqld</code> binary supports by doing:

</p>
<p>
<code>show variables like 'have_%'</code>.  「<a href="manual.ja_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></a>」節参照.

</p>



<h3><a name="Out_of_memory" href="manual.ja_toc.html#Out_of_memory">A.2.7  <code>Out of memory</code> エラー</a></h3>

<p>
クエリを行って、次のエラーのようなものを得た場合:

</p>

<pre>mysql: Out of memory at line 42, 'malloc.c'
mysql: needed 8136 byte (8k), memory in use: 12481367 bytes (12189k)
ERROR 2008: MySQL client ran out of memory
</pre>

<p>
エラーは MySQL クライアント <code>mysql</code> に関係することに注意してください。
エラーの理由は単純で、クライアントが結果全体を格納するのに十分なメモリを持っ
ていないことです。

</p>
<p>
この問題を解決するにあたり、まず最初にクエリーが正しいか確認してください。
そのクエリーは大量の結果を返すものでしょうか？
もしそうなら、<code>mysql --quick</code> を使用してください。
これは結果を取り出すために <code>mysql_use_result()</code> を使用します。
これはクライアントのロード不足を補います(サーバーより多い領域は取れません)。

</p>



<h3><a name="Packet_too_large" href="manual.ja_toc.html#Packet_too_large">A.2.8  <code>Packet too large</code> エラー</a></h3>

<p>
MySQL クライアントが <code>max_allowed_packet</code> よりも大きなブロックを
<code>mysqld</code> サーバーから得た時、<code>Packet too large</code> エラーを発します。

</p>
<p>
In MySQL 3.23 the biggest possible packet is 16M (due to limits in the
client/server protocol). In MySQL 4.0.1 and up, this is only limited by
the amount on memory you have on your server (up to a theoretical
maximum of 2G).

</p>
<p>
A communication packet is a single SQL statement sent to the MySQL server
or a single row that is sent to the client.

</p>
<p>
MySQL クライアントや <code>mysqld</code> サーバーが <code>max_allowed_packet</code> バイトより
大きなパケットを受け取ったた場合、 <code>Packet too large</code> エラーを発して
接続を閉じます。
いくつかのクライアントでは、
<code>Lost connection to MySQL server during query</code> エラーも出すでしょう。

</p>
<p>
クライアントとサーバーは、自身の <code>max_allowed_packet</code> 変数を持っています。
もし大きなパケットを扱いたい場合には、クライアントとサーバーの両方の
<code>max_allowed_packet</code> 値を増やしてください。

</p>
<p>
It's safe to increase this variable as memory is only allocated when
needed; this variable is more a precaution to catch wrong packets
between the client/server and also to ensure that you don't accidentally
use big packets so that you run out of memory.

</p>
<p>
If you are using the <code>mysql</code> client, you may specify a bigger
buffer by starting the client with
<code>mysql --set-variable=max_allowed_packet=8M</code>.
Other clients have different methods to set this variable.
Please note that <code>--set-variable</code> is deprecated since
MySQL 4.0, just use <code>--max-allowed-packet=8M</code> instead.

</p>
<p>
You can use the option file to set <code>max_allowed_packet</code> to a larger
size in <code>mysqld</code>.  For example, if you are expecting to store the
full length of a <code>MEDIUMBLOB</code> into a table, you'll need to start
the server with the <code>set-variable=max_allowed_packet=16M</code> option.

</p>



<h3><a name="Communication_errors" href="manual.ja_toc.html#Communication_errors">A.2.9  Communication Errors / Aborted Connection</a></h3>

<p>
<a name="IDX1774"></a>
<a name="IDX1775"></a>
<a name="IDX1776"></a>

</p>
<p>
<code>MySQL 3.23.40</code> からは、<code>mysqld</code> を <code>--warnings</code> オプションで
たち上げた時にだけ、<code>Aborted connection</code> エラーを出力することが可能です。

</p>
<p>
もし以下のようなエラーがエラーログファイルに記録されていたら、

</p>

<pre>010301 14:38:23  Aborted connection 854 to db: 'users' user: 'josh'
</pre>

<p>
 「<a href="manual.ja_MySQL_Database_Administration.html#Error_log">4.9.1  The Error Log</a>」節参照.

</p>
<p>
これは以下が起きたことを示します：

</p>

<ul>
<li>

クライアントプログラムが終了前に <code>mysql_close()</code> を呼び出さなかった。
</li><li>

クライアントが <code>wait_timeout</code> か <code>interactive_timeout</code> 
以上、いかなるリクエストもしない状態だった。
 「<a href="manual.ja_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></a>」節参照.
 「<a href="manual.ja_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></a>」節参照.
</li><li>

クライアントプログラムが転送の途中にプログラムを終了した
</li></ul>

<p>
上記が起きたときには、サーバーは <code>Aborted_clients</code> 変数を増やします。

</p>
<p>
サーバー変数 <code>Aborted_connects</code> は以下の時に増えます：

</p>

<ul>
<li>

コネクションパケットが正しい情報を含んでいなかった時
</li><li>

ユーザーがデータベースに接続する権限を持たなかった時
</li><li>

あるユーザーが間違ったパスワードを使用した時
</li><li>

コネクションパケットを得る際に、 <code>connect_timeout</code> 秒以上
かかった時
 「<a href="manual.ja_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></a>」節参照.
</li></ul>

<p>
Note that the above could indicate that someone is trying to break into
your database!

</p>
<p>
 「<a href="manual.ja_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></a>」節参照.

</p>
<p>
Other reasons for problems with Aborted clients / Aborted connections.

</p><ul>
<li>

Usage of duplex Ethernet protocol, both half and full with
Linux. Many Linux Ethernet drivers have this bug. You should test
for this bug by transferring a huge file via ftp between these two
machines. If a transfer goes in burst-pause-burst-pause ... mode then
you are experiencing a Linux duplex syndrome. The only solution to
this problem is switching off either half or full duplex mode on hubs
and switches, and testing the results to decide on the best setting.
</li><li>

Some problem with the thread library that causes interrupts on reads.
</li><li>

Badly configured TCP/IP.
</li><li>

Faulty Ethernets or hubs or switches, cables ... This can be diagnosed
properly only by replacing hardware.
</li><li>

<code>max_allowed_packet</code> is too small or queries require more memory
than you have alloacated for <code>mysqld</code>.  「<a href="manual.ja_Problems.html#Packet_too_large">A.2.8  <code>Packet too large</code> エラー</a>」節参照.
</li></ul>



<h3><a name="Full_table" href="manual.ja_toc.html#Full_table">A.2.10  <code>The table is full</code> エラー</a></h3>

<p>
<a name="IDX1777"></a>

</p>

<ul>
<li>

このエラーは、古い MySQL バージョン(before 3.23.0)において、
メモリ内一時テーブルが <code>tmp_table_size</code> よりも大きくなっ
た時に発生します。この問題を回避するために、<code>mysqld</code> のオプション
<code>-O tmp_table_size=#</code> で増加、または、SQL オプション <code>BIG_TABLES</code> 
(ver.4.0.3未満では <code>SQL_BIG_TABLES</code> )
を問題のクエリの前に使用できます。
 「<a href="manual.ja_MySQL_Optimisation.html#SET_OPTION">5.5.6  <code>SET</code> 構文</a>」節参照.

You can also start <code>mysqld</code> with the <code>--big-tables</code> option.
This is exactly the same as using <code>BIG_TABLES</code> for all queries.

In MySQL Version 3.23, in-memory temporary tables will automatically be
converted to a disk-based <code>MyISAM</code> table after the table size gets
bigger than <code>tmp_table_size</code>.
</li><li>

You are using <code>InnoDB</code> tables and run out of room in the
<code>InnoDB</code> tablespace. In this case the solution is to extend the
<code>InnoDB</code> tablespace.
</li><li>

You are using <code>ISAM</code> or <code>MyISAM</code> tables on an OS that only
supports files of 2G in size and you have hit this limit for the data
or index file.
</li><li>

You are using <code>MyISAM</code> tables and the needed data or index size is
bigger than what MySQL has allocated pointers for.  (If you don't specify
<code>MAX_ROWS</code> to <code>CREATE TABLE</code> MySQL will only allocate pointers
to hold 4G of data).

You can check the maximum data/index sizes by doing

<pre>SHOW TABLE STATUS FROM database LIKE 'table_name';
</pre>

or using <code>myisamchk -dv database/table_name</code>.

If this is the problem, you can fix it by doing something like:

<pre>ALTER TABLE table_name MAX_ROWS=1000000000 AVG_ROW_LENGTH=nnn;
</pre>

You only have to specify <code>AVG_ROW_LENGTH</code> for tables with BLOB/TEXT
fields as in this case MySQL can't optimise the space required based
only on the number of rows.
</li></ul>



<h3><a name="Cannot_create" href="manual.ja_toc.html#Cannot_create">A.2.11  <code>Can't create/write to file</code> エラー</a></h3>

<p>
<a name="IDX1778"></a>

</p>
<p>
If you get an error for some queries of type:

</p>

<pre>Can't create/write to file '\\sqla3fe_0.ism'.
</pre>

<p>
this means that MySQL can't create a temporary file for the
result set in the given temporary directory. (The above error is a
typical error message on Windows, and the Unix error message is similar.)
The fix is to start <code>mysqld</code> with <code>--tmpdir=path</code> or to add to your
option file:

</p>

<pre>[mysqld]
tmpdir=C:/temp
</pre>

<p>
assuming that the <tt>`c:\\temp'</tt> directory exists.  「<a href="manual.ja_MySQL_Database_Administration.html#Option_files">4.1.2  <tt>`my.cnf'</tt> オプションファイル</a>」節参照.

</p>
<p>
Check also the error code that you get with <code>perror</code>. One reason
may also be a disk full error;

</p>

<pre>shell&gt; perror 28
Error code  28:  No space left on device
</pre>



<h3><a name="Commands_out_of_sync" href="manual.ja_toc.html#Commands_out_of_sync">A.2.12  <code>Commands out of sync</code> Error in Client</a></h3>

<p>
<a name="IDX1779"></a>

</p>
<p>
<code>Commands out of sync; you can't run this command now</code> をクライアン
トコード中で得た場合、クライアント関数を間違った順番で呼び出しました！

</p>
<p>
これは例えば、<code>mysql_use_result()</code> を使用していて、<code>mysql_free_result(
)</code>
を行う前に新しいクエリの実行を試みた場合に発生します。これはまた、データ
を返す２つのクエリの実行を、間に <code>mysql_use_result()</code> や 
<code>mysql_store_result()</code> 無しで試みた場合にも発生します。

</p>



<h3><a name="Ignoring_user" href="manual.ja_toc.html#Ignoring_user">A.2.13  <code>Ignoring user</code> エラー</a></h3>

<p>
以下のエラーの場合：

</p>
<p>
<code>Found wrong password for user: 'some_user@some_host'; ignoring user</code>

</p>
<p>
これは <code>mysqld</code> の開始または 'reload' 時に <code>user</code> テーブル内に正しいパ
スワードを持たないエントリを見つけたことを意味します。
これは単にエントリが許可システムに拒否されているだけです。

</p>
<p>
起こり得ることとその解決:

</p>

<ul>
<li>

新しいバージョンの <code>mysqld</code> を、古いバージョン用の <code>user</code> テーブルで走
らせているのかもしれません。
<code>mysqlshow mysql user</code> を行うことによってこれを検証できます。
パスワードフィールドが 16 文字よりも短いかどうかをチェックしてください。
もしそうなら、これを修正するために、<code>scripts/add_long_password</code> スクリプト
を実行してください。

</li><li>

ユーザーが古いパスワード(最大8文字) を使用していて、<code>mysqld</code> を <code>--old
-protocol</code> オプションで起動していないのかもしれません。
新しいパスワードで <code>user</code> テーブル内のユーザを更新するか、<code>--old-protocol</code>
付きで <code>mysqld</code> を再起動してください。

</li><li>

<a name="IDX1780"></a>
<code>user</code> テーブルのパスワードを、<code>PASSWORD()</code> 関数を使用しないで登録した
のかもしれません。
この場合、<code>user</code> テーブルのパスワードを、<code>mysql</code> を使用して更新します。
<code>PASSWORD()</code> 関数は以下のようにして使用します：


<pre>mysql&gt; UPDATE user SET password=PASSWORD('your password')
    -&gt;             WHERE user='XXX';
</pre>

</li></ul>



<h3><a name="Cannot_find_table" href="manual.ja_toc.html#Cannot_find_table">A.2.14  <code>Table 'xxx' doesn't exist</code> エラー</a></h3>

<p>
もし <code>Table 'xxx' doesn't exist</code> か <code>Can't find file: 'xxx' (errno: 2)</code>
 エラーが出た場合、使用しているデータベースに  <code>xxx</code> という名前のテーブルが
見付からなかったことを示します

</p>
<p>
データベースとテーブルの保存に、MySQL はディレクトリとファイルを使用し、
データベースとテーブルの名前は<strong>ケース依存</strong>です!
(Windows ではデータベースとテーブル名はケース非依存です。
クエリ中のテーブルに対する問い合わせは全て、同じケースで書かなくてはなりません！)

</p>
<p>
<code>SHOW TABLES</code> を使用してデータベースのテーブルを確認できます.
 「<a href="manual.ja_MySQL_Database_Administration.html#SHOW">4.5.6  <code>SHOW</code> 構文</a>」節参照.

</p>



<h3><a name="Cannot_initialize_character_set" href="manual.ja_toc.html#Cannot_initialize_character_set">A.2.15  <code>Can't initialize character set xxx</code> エラー</a></h3>

<p>
<a name="IDX1781"></a>

</p>
<p>
もし以下のようなエラーが出た場合：

</p>

<pre>MySQL Connection Failed: Can't initialize character set xxx
</pre>

<p>
これは次を意味します：

</p>

<ul>
<li>

キャラクタ・セットがマルチバイトで、、クライアントがそのキャラクタ・セットを
持っていない場合

この場合、クライアントを <code>--with-charset=xxx</code> か
<code>--with-extra-charsets=xxx</code> コンフィギャ・オプションで再コンパイルする必要があります。
 「<a href="manual.ja_Installing.html#configure_options">2.3.3  典型的な <code>configure</code> オプション</a>」節参照.

All standard MySQL binaries are compiled with
<code>--with-extra-character-sets=complex</code> which will enable support for
all multi-byte character sets.  「<a href="manual.ja_MySQL_Database_Administration.html#Character_sets">4.6.1  データとソートに使用されるキャラクター・セット</a>」節参照.

</li><li>

そのキャラクタ・セットが単純なキャラクタ・セットで、それが <code>mysqld</code> に
組み込まれておらず、さらに 定義ファイルも特定の場所に存在しなかった場合。

この場合は以下のようにします：


<ul>
<li>

クライアントをそのキャラクタ・セットをサポートするように再コンパイル。
 「<a href="manual.ja_Installing.html#configure_options">2.3.3  典型的な <code>configure</code> オプション</a>」節参照.
</li><li>

クライアントに、そのキャラクタ・セットの定義ファイルがどこに存在するかを教える。
多くのクライアントは <code>--character-sets-dir=path-to-charset-dir</code> オプションを
持っています。
</li><li>

そのクライアントが定義ファイルを探しにいっているディレクトリに、
定義ファイルをコピーする。
</li></ul>

</li></ul>



<h3><a name="Not_enough_file_handles" href="manual.ja_toc.html#Not_enough_file_handles">A.2.16  File Not Found</a></h3>

<p>
<code>ERROR '...' not found (Errcode: 23)</code>, <code>Can't open file: ... (errno: 24)</code>
 や <code>errcode 23</code> <code>errno 24</code> のエラーを MySQL から得た場合、
これは MySQL に十分なファイル記述子が割り当てられなかったことを意味します。
<code>perror</code> ユーティリティはさらに読みやすい形式のエラーメッセージを与えます:

</p>

<pre>shell&gt; perror 23
File table overflow
shell&gt; perror 24
Too many open files
shell&gt; perror 11
Resource temporarily unavailable
</pre>

<p>
これは <code>mysqld</code> が多くのファイルを開こうとしたことに起因します。
<code>mysqld</code> に一度に開くファイル数を多く開かないようしたり、あるいは、
<code>mysqld</code> が扱えるファイル記述子の数を与えたりできます。

</p>
<p>
<code>mysqld</code> が一度に開くファイルの数を少なくするには、<code>-O table_cache=32</code>
 オプション(デフォルトは64)を <code>safe_mysqld</code> に与えることで可能です。
また、<code>max_connections</code> の値(デフォルトは90)を少なくするならば、
開くファイル数も少なくできます。

</p>
<p>
<a name="IDX1782"></a>
To change the number of file descriptors available to <code>mysqld</code>, you
can use the option <code>--open-files-limit=#</code> to <code>safe_mysqld</code> or
<code>-O open-files-limit=#</code> to <code>mysqld</code>.
 「<a href="manual.ja_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></a>」節参照.
The easiest way to do that is to add the option to your option file.
 「<a href="manual.ja_MySQL_Database_Administration.html#Option_files">4.1.2  <tt>`my.cnf'</tt> オプションファイル</a>」節参照.  If you have an old <code>mysqld</code> version that
doesn't support this, you can edit the <code>safe_mysqld</code> script.  There
is a commented-out line <code>ulimit -n 256</code> in the script.  You can
remove the <code>'#'</code> character to uncomment this line, and change the
number 256 to affect the number of file descriptors available to
<code>mysqld</code>.

</p>
<p>
<code>ulimit</code> と <code>open-files-limit</code> はオペレーティングシステムの
制限内でしかファイル記述子の数を指定できません。
There is also a 'hard' limit that can only be overrided if you
start <code>safe_mysqld</code> or <code>mysqld</code> as root (Just remember that
you need to also use the <code>--user=..</code> option in this case).
もし OS の制限以上にファイル記述子のオープン数を増やしたい場合、
お使いのオペレーティングシステムのドキュメントを見て対処してください。

</p>
<p>
<code>tcsh</code> を使用している場合は <code>ulimit</code> は動かないことに注意してください！
<code>tcsh</code> は現在の制限をあなたが問い合わせても、違った値を報告するでしょう。
この場合、<code>safe_mysqld</code> は <code>sh</code> で起動すべきです！

</p>



<h2><a name="Installation_Issues" href="manual.ja_toc.html#Installation_Issues">A.3  Installation Related Issues</a></h2>



<h3><a name="Link_errors" href="manual.ja_toc.html#Link_errors">A.3.1  Problems When Linking with the MySQL Client Library</a></h3>

<p>
<a name="IDX1783"></a>
<a name="IDX1784"></a>
<a name="IDX1785"></a>

</p>
<p>
If you are linking your program and you get errors for unreferenced
symbols that start with <code>mysql_</code>, like the following:

</p>

<pre>/tmp/ccFKsdPa.o: In function `main':
/tmp/ccFKsdPa.o(.text+0xb): undefined reference to `mysql_init'
/tmp/ccFKsdPa.o(.text+0x31): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x57): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x69): undefined reference to `mysql_error'
/tmp/ccFKsdPa.o(.text+0x9a): undefined reference to `mysql_close'
</pre>

<p>
この場合には、<code>-Lpath-to-the-mysql-library -lmysqlclient</code> を、
リンクの <strong>最後に</strong> 加えれば解決します。

</p>
<p>
もし <code>undefined reference</code> エラーで <code>uncompress</code> や
<code>compress</code> が定義されていないエラーを受けたならば、
<code>-lz</code> をリンク ラインの <strong>最後に</strong> 加えて再リンクしてください！

</p>
<p>
If you get <code>undefined reference</code> errors for functions that should
exist on your system, like <code>connect</code>, check the man page for the
function in question, for which libraries you should add to the link
line!

</p>
<p>
If you get <code>undefined reference</code> errors for functions that don't
exist on your system, like the following:

</p>

<pre>mf_format.o(.text+0x201): undefined reference to `__lxstat'
</pre>

<p>
it usually means that your library is compiled on a system that is not
100% compatible with yours.  In this case you should download the
latest MySQL source distribution and compile this yourself.
 「<a href="manual.ja_Installing.html#Installing_source">2.3  MySQL ソースディストリビューションのインストール</a>」節参照.

</p>
<p>
If you are trying to run a program and you then get errors for
unreferenced symbols that start with <code>mysql_</code> or that the
<code>mysqlclient</code> library can't be found, this means that your system
can't find the share <tt>`libmysqlclient.so'</tt> library.

</p>
<p>
The fix for this is to tell your system to search after shared
libraries where the library is located by one of the following methods:

</p>

<ul>
<li>

<code>LD_LIBRARY_PATH</code> 環境変数に、<tt>`libmysqlclient.so'</tt> が存在する
ディレクトリを加える。
</li><li>

<code>LD_LIBRARY</code> 環境変数に、<tt>`libmysqlclient.so'</tt> が存在する
ディレクトリを加える。
</li><li>

Copy <tt>`libmysqlclient.so'</tt> to some place that is searched by your system,
like <tt>`/lib'</tt>, and update the shared library information by executing
<code>ldconfig</code>.
</li></ul>

<p>
他の解決方法は、あなたのプログラムを <code>-static</code> フラグで static にリンクするか、
動的な MySQL ライブラリをリンク前に移動してから、リンクします。
二つ目の場合は、他のプログラムがそのダイナミックライブラリを使用していないか
注意してください！

</p>



<h3><a name="Changing_MySQL_user" href="manual.ja_toc.html#Changing_MySQL_user">A.3.2  一般ユーザで MySQL を動かす方法</a></h3>

<p>
<a name="IDX1786"></a>
<a name="IDX1787"></a>

</p>
<p>
<code>mysqld</code> (MySQL サーバ) はいかなるユーザーでも開始し実行することが
できます。<code>mysqld</code> をユーザ <code>user_name</code> で実行するように変更するためには、
次を行なう必要があります:

</p>

<ol>
<li>

Stop the server if it's running (use <code>mysqladmin shutdown</code>).

</li><li>

<code>user_name</code> が読み書きできるように、データベースディレクトリとその中のファ
イルのパーミッションを変更します。(これは UNIX <code>root</code> ユーザーで実行する必
要があるでしょう)：


<pre>shell&gt; chown -R user_name /path/to/mysql/datadir
</pre>

MySQL データベースディレクトリのディレクトリーやファイルがシンボリック
リンクの場合、
これらリンクの先のディレクトリとファイルも変更します。<code>chown -R</code> はシンボリ
ックリンク先を変更してくれません。

</li><li>

ユーザ <code>user_name</code> でサーバを起動します。または MySQL 3.22 以降を
使用する場合は、<code>mysqld</code> を UNIX <code>root</code> で起動し
<code>--user=user_name</code> スイッチを使用します。
<code>mysqld</code> は、接続を許可する前に、与えられた UNIX user <code>user_name</code> で実
行するように切り替えます。

</li><li>

To start the server as the given user name automatically at system
startup time, add a <code>user</code> line that specifies the user name to
the <code>[mysqld]</code> group of the <tt>`/etc/my.cnf'</tt> option file or the
<tt>`my.cnf'</tt> option file in the server's data directory. For example:


<pre>[mysqld]
user=user_name
</pre>

</li></ol>

<p>
この時点で、あなたの <code>mysqld</code> プロセスは UNIX user <code>user_name</code> で正常
に動作します。

</p>
<p>
一つのことは変わりません。それは権限許可テーブルです。デフォルト 
(パーミッションテーブルインストールスクリプト<code>mysql_install_db</code>実行後の権限)
では、<code>mysql</code>データベースへのアクセスやデータベースの作成、破棄はユーザ
MySQL user <code>root</code> だけです。
これを変更しないと、それはそのままです。
<code>root</code> 以外の UNIX userでログインしている時でも、あなたは 
MySQL <code>root</code> user としてアクセスは可能です - ただプログラムに
<code>-u root</code> をクライアントプログラムにオプション指定するだけです。

</p>
<p>
MySQL に <code>root</code> としてアクセスするには、
コマンドラインで <code>-u root</code> を使用するだけでいいことに注意してください。
UNIX <code>root</code> user や MySQL を走らせている UNIX ユーザーである必要は
<em>ない</em>ことに注意してください。
MySQL のアクセスパーミッションとMySQL のユーザは、
UNIX ユーザとは完全に別のものです。UNIX ユーザに関係するのは、クライアン
トに <code>-u</code> オプションを使用しない場合だけです。この場合、クライアントは
MySQL へのログインを、あなたの UNIX ログイン名で試みます。

</p>
<p>
あなたの UNIX マシンそれ自身が安全でない場合は、少なくとも MySQL ア
クセステーブルの MySQL <code>root</code> ユーザにはパスワードを設定すべきです。
どこかの誰かが <code>mysql -u root db_name</code> を行ない、彼が望むことの全てを実行で
きてしまうからです。

</p>



<h3><a name="File_permissions" href="manual.ja_toc.html#File_permissions">A.3.3  ファイルパーミッションの問題</a></h3>

<p>
<a name="IDX1788"></a>
<a name="IDX1789"></a>
<a name="IDX1790"></a>

</p>
<p>
ファイルパーミッションの問題がある場合、
例えば、テーブルの生成時に <code>mysql</code> が次を出力する場合:

</p>

<pre>ERROR: Can't find file: 'path/with/filename.frm' (Errcode: 13)
</pre>

<p>
<a name="IDX1791"></a>
<a name="IDX1792"></a>
これは <code>UMASK</code> 環境変数が <code>mysqld</code> 起動時に間違ってセットされていると
考えられます。
デフォルトの umask は <code>0660</code> です. 
これは以下のようにして <code>safe_mysqld</code> 立ち上げ時に変更できます:

</p>

<pre>shell&gt; UMASK=384  # = 600 in octal
shell&gt; export UMASK
shell&gt; /path/to/safe_mysqld &amp;
</pre>

<p>
<a name="IDX1793"></a>
<a name="IDX1794"></a>
By default MySQL will create database and <code>RAID</code>
directories with permission type 0700.  You can modify this behaviour by
setting the <code>UMASK_DIR</code> variable. If you set this, new
directories are created with the combined <code>UMASK</code> and
<code>UMASK_DIR</code>. For example, if you want to give group access to
all new directories, you can do:

</p>

<pre>shell&gt; UMASK_DIR=504  # = 770 in octal
shell&gt; export UMASK_DIR
shell&gt; /path/to/safe_mysqld &amp;
</pre>

<p>
In MySQL Version 3.23.25 and above, MySQL assumes that the
value for <code>UMASK</code> and <code>UMASK_DIR</code> is in octal if it starts
with a zero.

</p>
<p>
 「<a href="manual.ja_Environment_variables.html#Environment_variables">F  Environment Variables</a>」節参照.

</p>



<h2><a name="Administration_Issues" href="manual.ja_toc.html#Administration_Issues">A.4  Administration Related Issues</a></h2>



<h3><a name="Crashing" href="manual.ja_toc.html#Crashing">A.4.1  What To Do If MySQL Keeps Crashing</a></h3>

<p>
<a name="IDX1795"></a>

</p>
<p>
全ての MySQL バージョンはリリースの前に多くのプラットフォームで
テストされます。 これは MySQL にいかなるバグもないということを
意味しますが、発見するのが困難で、わずかなバグがあるかもしれません。
もし問題があった場合、何がシステムをクラッシュしているかを見つけようとする事は、
問題を早く修正するためのより良い機会でもあります。

</p>
<p>
まず最初に, その問題で <code>mysqld</code> デーモンが死ななければならないかどうかか, 
また
はその問題がクライアントで処理しなければならないかどうかを調べるべきです。
<code>mysqladmin version</code> を実行することにより、 <code>mysqld</code> サーバーが
どれぐらい稼働していたかわかります。 もし <code>mysqld</code> が死んでいたなら、
を実行することによってあるのかをチェックすることができます. mysqldが死んだなら、
その原因を <tt>`mysql-data-directory/`hostname`.err'</tt> で見つけれるかもしれません。
 「<a href="manual.ja_MySQL_Database_Administration.html#Error_log">4.9.1  The Error Log</a>」節参照.

</p>
<p>
Many crashes of MySQL are caused by corrupted index / data
files.  MySQL will update the data on disk, with the
<code>write()</code> system call, after every SQL statement and before the
client is notified about the result. (This is not true if you are running
with <code>delay_key_write</code>, in which case only the data is written.)
This means that the data is safe even if <code>mysqld</code> crashes, as the OS will
ensure that the not flushed data is written to disk.  You can force
MySQL to sync everything to disk after every SQL command by
starting <code>mysqld</code> with <code>--flush</code>.

</p>
<p>
The above means that normally you shouldn't get corrupted tables unless:

</p>

<ul>
<li>

Someone/something killed <code>mysqld</code> or the machine in the middle
of an update.
</li><li>

You have found a bug in <code>mysqld</code> that caused it to die in the
middle of an update.
</li><li>

Someone is manipulating the data/index files outside of <strong>mysqld</strong>
without locking the table properly.
</li><li>

If you are running many <code>mysqld</code> servers on the same data on a
system that doesn't support good filesystem locks (normally handled by
the <code>lockd</code> daemon ) or if you are running
multiple servers with <code>--skip-external-locking</code>
</li><li>

You have a crashed index/datafile that contains very wrong data that
got <code>mysqld</code> confused.
</li><li>

You have found a bug in the data storage code. This isn't that likely,
but it's at least possible.  In this case you can try to change the file
type to another storage engine by using <code>ALTER TABLE</code> on a
repaired copy of the table!
</li></ul>

<p>
何かがクラッシュする理由を知るのは非常に難しいので、まず、他の人で動くも
のがあなたでクラッシュするのかどうかをチェックしてください。次のことを行っ
てください。

</p>

<ul>
<li>

<code>mysqld</code> デーモンを <code>mysqladmin shutdown</code> で停止し, 全てのテーブルで
<code>myisamchk --silent --force */*.MYI</code> を実行し、そして <code>mysqld</code> デーモ
ンを再起動します.  これはきれいな状態から開始することになります。
 「<a href="manual.ja_MySQL_Database_Administration.html#MySQL_Database_Administration">4  データベース管理</a>」節参照.

</li><li>

<code>mysqld --log</code> を使用し、ログの情報から特定のクエリがサーバーをキルしている
かを見つけ出してください。 95% のバグは特定のクエリに関係があります！
通常これは、 MySQL が再起動される前の、ログファイルの最後のクエリの一つ
です。  「<a href="manual.ja_MySQL_Database_Administration.html#Query_log">4.9.2  The General Query Log</a>」節参照.
If you can repeatadly kill MySQL with one of the queries, even
when you have checked all tables just before doing the query, then you
have been able to locate the bug and should do a bug report for this!
 「<a href="manual.ja_Introduction.html#Bug_reports">1.6.1.3  バグや問題を報告する方法</a>」節参照.

</li><li>

Try to make a test case that we can use to reproduce the problem.
 「<a href="manual.ja_Porting.html#Reproduceable_test_case">E.1.6  Making a Test Case When You Experience Table Corruption</a>」節参照.

</li><li>

Try running the included mysql-test test and the MySQL
benchmarks.   「<a href="manual.ja_Extending_MySQL.html#MySQL_test_suite">9.1.2  MySQL Test Suite</a>」節参照.  They should test MySQL
rather well.  You can also add code that to the benchmarks to simulates
your application!  The benchmarks can be found in the <tt>`bench'</tt>
directory in the source distribution or, for a binary distribution, in
the <tt>`sql-bench'</tt> directory under your MySQL installation
directory.

</li><li>

<code>fork_test.pl</code> と <code>fork2_test.pl</code> を試します。

</li><li>

デバッグ用に MySQL をコンフィグすると、何かが悪くなる場合にエラー
を見つけ出すのがより簡単になります。<code>configure</code> に 
<code>--with-debug</code> オプションか <code>--with-debug=full</code> オプションを
つけて MySQL を再コンフィグし、
再コンパイルしてください。 「<a href="manual.ja_Porting.html#Debugging_server">E.1  MySQL server のデバッグ</a>」節参照.

</li><li>

デバッグ用に MySQL をコンフィグすると、いくつかのエラーを検出で
きる安全なメモリ割り当てを含めます。これは何が起きているかについての多く
の出力も提供します。

</li><li>

あなたの OS の最新のパッチを適用しましたか？

</li><li>

<code>--skip-external-locking</code> (ver. 4.0.3未満では <code>--skip-locking</code>)
オプションを <code>mysqld</code> に使用してください。いくつかのシステム上では、
<code>lockd</code> ロックマネージャは正しく動きません;
<code>--skip-external-locking</code> (ver. 4.0.3未満では <code>--skip-locking</code>)
オプションは <code>mysqld</code> に外部ロッキングを使用
しないように伝えます。(これは同じデータ上で2つの <code>mysqld</code> サーバを
動すことができず、<code>myisamchk</code> の使用時に注意しなければいけないことを
意味します。しかし、テストとしてこのオプションを試すことは指示できます。)

</li><li>

<code>mysqld</code> が動いているのに応答がないように見えた時 
<code>mysqladmin -u root processlist</code> を試しましたか？ 時々 
<code>mysqld</code> はそう思えても死んでいません。問題は全ての接続が使用中であ
ることか、いくつかの内部ロック問題があることです。<code>mysqladmin
processlist</code> は通常これらの場合でも接続を作ることができ、現在の接続数と
それらの状態についての有用な情報を提供できます。

</li><li>

別のウィンドウで、統計出力のためにコマンド <code>mysqladmin -i 5 status</code> 
や <code>mysqladmin -i 5 -r status</code> をクエリ中に行ってください。

</li><li>

次を試してください:

<ol>
<li>

<code>gdb</code> (または他のデバッガ) から <code>mysqld</code> を開始してください。
 「<a href="manual.ja_Porting.html#Using_gdb_on_mysqld">E.1.3  Debugging mysqld under gdb</a>」節参照.

</li><li>

あなたのテストスクリプトを実行してください。

</li><li>

Print the backtrace and the local variables at the 3 lowest levels. In gdb you
can do this with the following commands when <code>mysqld</code> has crashed inside
gdb:


<pre>backtrace
info local
up
info local
up
info local
</pre>

With gdb you can also examine which threads exist with <code>info
threads</code> and switch to a specific thread with <code>thread #</code>, where
<code>#</code> is the thread id.
</li></ol>

</li><li>

MySQL にクラッシュまたは間違った振る舞いをさせるあなたのアプリ
ケーションのシミュレートを Perl スクリプトで試みてください。

</li><li>

または通常のバグレポートを送ってください。 「<a href="manual.ja_Introduction.html#Bug_reports">1.6.1.3  バグや問題を報告する方法</a>」節参照。しかし通常
よりもさらに詳細にしてください。MySQL は多くの人のために働いて
いるため、クラッシュはあなたのコンピュータだけに存在する何か(例えば、あ
なたの特別なシステムライブラリに関連したエラー)から生じていると思われま
す。

</li><li>

もし可変長のレコードを扱うテーブルで問題があった場合、
もし、<code>BLOB/TEXT</code> フィールドは使用しておらず、<code>VARCHAR</code> フィールド
だけ使用しているなら、全ての <code>VARCHAR</code> フィールドを
 <code>ALTER TABLE</code> で <code>CHAR</code> に変更してみてください。
これは MySQL に固定長レコードを使用させるようにします。
固定長レコードは少し余分な領域をとりますが、よりエラーに対して
強くなります。

現在の可変長のレコードのコードは MySQL AB で少なくとも３年以上問題なく
使用されています。 しかし可変長のレコードはよりエラーの傾向があり、
上記の事柄を試すことは良いアイデアです！
</li></ul>



<h3><a name="Resetting_permissions" href="manual.ja_toc.html#Resetting_permissions">A.4.2  忘れたパスワードをリセットする</a></h3>

<p>
<a name="IDX1796"></a>
<a name="IDX1797"></a>
<a name="IDX1798"></a>

</p>
<p>
If you never set a <code>root</code> password for MySQL, then the server will
not require a password at all for connecting as <code>root</code>. It is
recommended to always set a password for each user.  「<a href="manual.ja_MySQL_Database_Administration.html#Security">4.2.2  MySQL をクラッカーに対して安全にする方法</a>」節参照.

</p>
<p>
もし MySQL の <code>root</code> ユーザーのパスワードを忘れた場合、
これを以下のようにして入れ直すことが可能です。

</p>

<ol>
<li>

<code>mysqld</code> サーバーを <code>kill</code> で落とす。
(<code>kill -9</code> ではありません！)
PID 番号は通常 MySQL データディレクトリに <tt>`.pid'</tt> ファイルに
書かれています：


<pre>shell&gt; kill `cat /mysql-data-directory/hostname.pid`
</pre>

これを、 Unix <code>root</code> ユーザーか、MySQL サーバーを実行した
ユーザーで行います。

</li><li>

<code>mysqld</code> を <code>--skip-grant-tables</code> オプションで起動。

</li><li>

<code>mysqladmin password</code> コマンドでパスワードを変更します。 

<pre>shell&gt; mysqladmin -u root password 'mynewpassword'
</pre>

</li><li>

Now you can either stop <code>mysqld</code> and restart it normally,
or just load the privilege tables with:

<pre>shell&gt; mysqladmin -h hostname flush-privileges
</pre>

</li><li>

After this, you should be able to connect using the new password.
</li></ol>

<p>
Alternatively, you can set the new password using the <code>mysql</code> client:

</p><ol>
<li>

Take down and restart <code>mysqld</code> with the <code>--skip-grant-tables</code>
option as described above.
</li><li>

Connect to the <code>mysqld</code> server with:

<pre>shell&gt; mysql -u root mysql
</pre>

</li><li>

Issue the following commands in the <code>mysql</code> client:

<pre>mysql&gt; UPDATE user SET Password=PASSWORD('mynewpassword')
    -&gt;             WHERE User='root';
mysql&gt; FLUSH PRIVILEGES;
</pre>

</li><li>

After this, you should be able to connect using the new password.
</li><li>

You can now stop <code>mysqld</code> and restart it normally.
</li></ol>



<h3><a name="Full_disk" href="manual.ja_toc.html#Full_disk">A.4.3  MySQL はフルディスクをどのように扱うか？</a></h3>

<p>
<a name="IDX1799"></a>
<a name="IDX1800"></a>

</p>
<p>
ディスクフルが起きた場合 MySQL は次のことを行います:

</p>

<ul>
<li>

現在の行を書くのに十分な領域があるかどうかを1分毎に1回チェックします。十
分なディスクがある場合は、何も起きなかったように継続します。

</li><li>

6分毎にログファイルにディスクフルを警告するエントリを書き出します。
</li></ul>

<p>
この問題の場合、以下のようにします：

</p>

<ul>
<li>

継続するためには、全てのレコードを挿入するのに十分な領域を解放する必要が
あります。

</li><li>

スレッドをアボートするためには、<code>mysqladmin kill</code> をスレッドに送る
必要があります。スレッドは次に(1分)ディスクをチェックした時にアボートし
ます。

</li><li>

他のスレッドが ``disk full'' が発生したテーブルで待たされることに注意して
ください。多くの ``locked'' スレッドがある場合、disk full を待つ一つのスレッ
ドを kill することで、他のスレッドの継続を許します。

</li></ul>

<p>
Exceptions to the above behaveour is when you use <code>REPAIR</code> or
<code>OPTIMIZE</code> or when the indexes are created in a batch after an
<code>LOAD DATA INFILE</code> or after an <code>ALTER TABLE</code> statement.

</p>
<p>
All of the above commands may use big temporary files that left to
themself would cause big problems for the rest of the system.  If
MySQL gets disk full while doing any of the above operations,
it will remove the big temporary files and mark the table as crashed
(except for <code>ALTER TABLE</code>, in which the old table will be left
unchanged).

</p>



<h3><a name="Temporary_files" href="manual.ja_toc.html#Temporary_files">A.4.4  MySQL が一時ファイルを格納する場所</a></h3>

<p>
MySQL は一時ファイルを格納する場所として <code>TMPDIR</code> 環境変数の値を
使用します。<code>TMPDIR</code> を設定していなければ、MySQL はシステムのデフォルトを
使用します。通常は <tt>`/tmp'</tt> または <tt>`/usr/tmp'</tt> です。<code>TMPDIR</code> が
小さすぎる場合、<code>safe_mysqld</code> を編集して、十分な領域がある他のディレクトリ
を指すように <code>TMPDIR</code> を設定すべきです！
<code>--tmpdir</code> オプションを <code>mysqld</code> に与えることで、一時ファイルディレク
トリを指定することも可能です。

</p>
<p>
MySQL は全ての一時ファイルを ``隠しファイル'' として生成します。
これは <code>mysqld</code> が終了した場合に、一時ファイルが削除されないことを確実にし
ます。隠しファイルを使用する '悪い' 側面は、小さすぎる一時ディスクを一杯
にする大きな一時ファイルを見つけられないことです。

</p>
<p>
ソート時 (<code>ORDER BY</code> または <code>GROUP BY</code>)、MySQL は通常一つまた
は二つの一時ファイルを使用します。必要な最大のディスク容量は:

</p>

<pre>(length of what is sorted + sizeof(database pointer))
* number of matched rows
* 2
</pre>

<p>
<code>sizeof(database_pointer)</code> は通常４ですが、将来本当に大きなテーブル
のために大きくなることもあります。

</p>
<p>
いくつかの <code>SELECT</code> クエリは一時的な SQL テーブルも生成します。これらは隠
しファイルではなく、<tt>`SQL_*'</tt> という名前です。

</p>
<p>
<code>ALTER TABLE</code> は一時テーブルをオリジナルテーブルと同じディレクトリ
内に生成します。

</p>
<p>
If you use MySQL 4.1 or later you can spread load between
several physical disks by setting <code>--tmpdir</code> to a list of paths
separated by colon <code>:</code> (semicolon <code>;</code> on Windows). They
will be used in round-robin fashion.
<strong>Note:</strong> These paths should end up on different <strong>physical</strong> disks,
not different partitions of the same disk.

</p>


<h3><a name="Problems_with_mysql.sock" href="manual.ja_toc.html#Problems_with_mysql.sock">A.4.5  MySQL ソケットファイル <tt>`/tmp/mysql.sock'</tt> を変更する方法、削除から守る方法</a></h3>

<p>
<a name="IDX1801"></a>
<a name="IDX1802"></a>

</p>
<p>
もし誰かに MySQL のソケットファイル <tt>`/tmp/mysql.sock'</tt> が消されるな
ら、ほとんどの UNIX がそうであるように、 <tt>`/tmp'</tt> に <code>sticky</code> ビットをたてて
保護します。
<code>root</code> でログインして、以下のようにします：

</p>

<pre>shell&gt; chmod +t /tmp
</pre>

<p>
これはファイルのオーナーとスーパーユーザー(<code>root</code>) のみが、
 <tt>`/tmp'</tt> のファイルを消すことができます。

</p>
<p>
<code>sticky</code> ビットが立っているか確認するには、 <code>ls -ld /tmp</code> を行います。
パーミッションの最後のビットが <code>t</code> ならば、セットされています。

</p>
<p>
<a name="IDX1803"></a>

</p>
<p>
You can change the place where MySQL uses / puts the socket file the
following ways:

</p>

<ul>
<li>

Specify the path in a global or local option file.
For example, put in <code>/etc/my.cnf</code>:


<pre>[client]
socket=path-for-socket-file

[mysqld]
socket=path-for-socket-file
</pre>

 「<a href="manual.ja_MySQL_Database_Administration.html#Option_files">4.1.2  <tt>`my.cnf'</tt> オプションファイル</a>」節参照.
</li><li>

Specifying this on the command-line to <code>safe_mysqld</code> and most
clients with the <code>--socket=path-for-socket-file</code> option.
</li><li>

この場合、 <code>MYSQL_UNIX_PORT</code> 環境変数に設定することにより可能です。
</li><li>

Defining the path with the <code>configure</code> option
<code>--with-unix-socket-path=path-for-socket-file</code>.  「<a href="manual.ja_Installing.html#configure_options">2.3.3  典型的な <code>configure</code> オプション</a>」節参照.
</li></ul>

<p>
ソケットのテストをする場合、以下のようにします：

</p>

<pre>shell&gt; mysqladmin --socket=/path/to/socket version
</pre>



<h3><a name="Timezone_problems" href="manual.ja_toc.html#Timezone_problems">A.4.6  Time Zone Problems</a></h3>

<p>
<a name="IDX1804"></a>
<a name="IDX1805"></a>

</p>
<p>
<a name="IDX1806"></a>
<a name="IDX1807"></a>

</p>
<p>
もし <code>SELECT NOW()</code> があなたのローカル時間ではなく GMT を返すなら、
 <code>TZ</code> 環境変数をローカルのTimezone に設定しなくてはなりません。
環境変数の設定は、サーバーを実行する前に行われなくてはなりません。
たとえば、<code>safe_mysqld</code> や <code>mysql.server</code> スクリプトで
行います。
 「<a href="manual.ja_Environment_variables.html#Environment_variables">F  Environment Variables</a>」節参照.

</p>



<h2><a name="Query_Issues" href="manual.ja_toc.html#Query_Issues">A.5  Query Related Issues</a></h2>



<h3><a name="Case_sensitivity" href="manual.ja_toc.html#Case_sensitivity">A.5.1  検索時のケース依存</a></h3>

<p>
<a name="IDX1808"></a>
<a name="IDX1809"></a>
<a name="IDX1810"></a>
<a name="IDX1811"></a>

</p>
<p>
デフォルトでは MySQL フィールドはケース非依存です (しかし、ケース非依
存にならないいくつかの文字セットはありますsuch as <code>czech</code>)。
これは、<code>col_name LIKE 'a%'</code>
で検索した場合、<code>A</code> または <code>a</code> で始まる全てのフィールドを得ることを
意味します。検索をケース依存にしたいのなら、始まりをチェックするには
<code>INDEX(column, "A")=1</code> のようなことを、また、文字列全体が同じかどう
かには <code>STRCMP(column, "A") = 0</code> を使用してください。

</p>
<p>
単純な比較操作 <code>&gt;=, &gt;, =, &lt;, &lt;=</code>、ソートそしてグループ化は、文字 ``sort val
ue'' 上で行われます。同じソート値の文字 (like E, e and 'e)は同じ文字と
して扱われます！

</p>
<p>
In older MySQL versions <code>LIKE</code> comparisons where done on
the uppercase value of each character (E == e but E &lt;&gt; 'e.  In newer
MySQL versions <code>LIKE</code> works just like the other comparison
operators.

</p>
<p>
あるフィールドをいつでもケース依存で扱いたい場合は、それを <code>BINARY</code> 
として宣言してください。  「<a href="manual.ja_Reference.html#CREATE_TABLE">6.5.3  <code>CREATE TABLE</code> 構文</a>」節参照.

</p>
<p>
big5 エンコーディングと呼ばれる中国語データを使用している場合は、全ての
文字項目を <code>BINARY</code> にしてください。これは、big5 エンコーディング文
字のソート順が ascii コードが基になっているため、機能します。

</p>



<h3><a name="Using_DATE" href="manual.ja_toc.html#Using_DATE">A.5.2  <code>DATE</code> フィールド使用時の問題</a></h3>

<p>
<a name="IDX1812"></a>

</p>
<p>
<a name="IDX1813"></a>
<a name="IDX1814"></a>

</p>
<p>
日付 <code>DATE</code> の形式は <code>'YYYY-MM-DD'</code> です。ANSI SQL に従って実際には他
のは許されま
せん。更新または <code>SELECT</code> 文中の WHERE 節内ではこの形式を使用すべきです。す
なわち:

</p>

<pre>mysql&gt; SELECT * FROM tbl_name WHERE date &gt;= '1997-05-05';
</pre>

<p>
利便のため MySQL は、日付が数値の文脈で使用されると、日付を自動的に数
値に変換します。これにより、更新と <code>TIMESTAMP</code>, <code>DATE</code> または 
<code>DATETIME</code> フィールドでの <code>WHERE</code> 時に、わりと自由に日付を指定すること
ができます。
(この記述を許すため、句読記号を日付のセパレーターとして使用します。
例えば、<code>'1998-08-15'</code> と <code>'1998#08#15'</code> は同一です.)
もしろんセパレーターのない記述(例：<code>'19980815'</code>)も日付として変換してくれま
す。

</p>
<p>
特別な日付 <code>'0000-00-00'</code> は <code>'0000-00-00'</code> として格納され取り出されま
す。
<code>MyODBC</code> を通して <code>'0000-00-00'</code> 日付を使用する時、<code>MyODBC</code> 2
.50.12 以上では自動的に <code>NULL</code> に変換されます。ODBC はこの日付の種類を扱え
ないためです。

</p>
<p>
Because MySQL performs the conversions described above, the following
statements work:

</p>

<pre>mysql&gt; INSERT INTO tbl_name (idate) VALUES (19970505);
mysql&gt; INSERT INTO tbl_name (idate) VALUES ('19970505');
mysql&gt; INSERT INTO tbl_name (idate) VALUES ('97-05-05');
mysql&gt; INSERT INTO tbl_name (idate) VALUES ('1997.05.05');
mysql&gt; INSERT INTO tbl_name (idate) VALUES ('1997 05 05');
mysql&gt; INSERT INTO tbl_name (idate) VALUES ('0000-00-00');

mysql&gt; SELECT idate FROM tbl_name WHERE idate &gt;= '1997-05-05';
mysql&gt; SELECT idate FROM tbl_name WHERE idate &gt;= 19970505;
mysql&gt; SELECT MOD(idate,100) FROM tbl_name WHERE idate &gt;= 19970505;
mysql&gt; SELECT idate FROM tbl_name WHERE idate &gt;= '19970505';
</pre>

<p>
次は動きません

</p>

<pre>mysql&gt; SELECT idate FROM tbl_name WHERE STRCMP(idate,'19970505')=0;
</pre>

<p>
<code>STRCMP()</code> は文字列関数で、<code>idate</code> を文字に変換して、文字比較を行いま
す。
<code>'19970505'</code> は日付には変換してくれず、日付の比較も行いません。

</p>
<p>
MySQL は日付が正しいかどうかをチェックしないことに注意してください。
間違った日付(例えば <code>'1998-2-31'</code>)を格納すると、その間違った日付が格
納されます。

</p>
<p>
Because MySQL packs dates for storage, it can't store any given date as
it would not fit onto the result buffer. The rules for accepting a date
are:

</p><ul>
<li>

If MySQL can store and retrieve a given date, the wrong date is accepted
for <code>DATE</code> and <code>DATETIME</code> columns.
</li><li>

All days values between 0-31 are accepted for any date.  This makes it
very convenient for web applications where you ask year, month and day
in 3 different fields.
</li><li>

The day or month field may be zero.  This is convenient if you want
to store a birthdate in a <code>DATE</code> column and you only know part
of the date.
</li></ul>

<p>
If the date cannot be converted to any reasonable value, a <code>0</code> is
stored in the <code>DATE</code> field, which will be retrieved as
<code>0000-00-00</code>.  This is both a speed and convenience issue as we
believe that the database's responsiblity is to retrieve the same date
you stored (even if the data was not logically correct in all cases).
We think it is up to the application to check the dates, and not the server.

</p>


<h3><a name="Problems_with_NULL" href="manual.ja_toc.html#Problems_with_NULL">A.5.3  <code>NULL</code> 値での問題</a></h3>

<p>
<a name="IDX1815"></a>

</p>
<p>
<a name="IDX1816"></a>

</p>
<p>
SQL の初心者のありがちな混乱は、<code>NULL</code> 値が空文字列  <code>""</code> と同じ物だと
考えることです。これは正しくありません！ 例えば、次のステートメントは全く別の
ものです:

</p>

<pre>mysql&gt; INSERT INTO my_table (phone) VALUES (NULL);
mysql&gt; INSERT INTO my_table (phone) VALUES ("");
</pre>

<p>
両方の文とも <code>phone</code> フィールドに値を挿入していますが、
初めのは <code>NULL</code> 値を挿入し、二番目のは空文字列を挿入しています。
初めのは ``電話番号を知らない'' と見なされ、二番目のは ``彼女は電話を
持っていない'' と見なされます。

</p>
<p>
SQL では、  <code>NULL</code> は他の全ての値(たとえ  <code>NULL</code> でも)と比較した時に、
常に偽になる値です。 <code>NULL</code> を含む式は、特に断りがなければ、常に 
<code>NULL</code> 値を生成します。次の項目は全て  <code>NULL</code> を返します:

</p>

<pre>mysql&gt; SELECT NULL,1+NULL,CONCAT('Invisible',NULL);
</pre>

<p>
<code>NULL</code> 値がセットされている項目を検索する場合、
 <code>=NULL</code> テストを行わないでください。
これは <code>expr = NULL</code> が FALSE なので、なんの行も返しません。
例えば以下の例：

</p>

<pre>mysql&gt; SELECT * FROM my_table WHERE phone = NULL;
</pre>

<p>
<code>NULL</code> 値を持つフィールドを検索したい場合は、<code>IS NULL</code> テストを使用し
なくてはいけま
せん。次は <code>NULL</code> 電話番号と空の電話番号を見つける方法を示しています:

</p>

<pre>mysql&gt; SELECT * FROM my_table WHERE phone IS NULL;
mysql&gt; SELECT * FROM my_table WHERE phone = "";
</pre>

<p>
Note that you can only add an index on a column that can have <code>NULL</code>
values if you are using MySQL Version 3.23.2 or newer and are using the
<code>MyISAM</code> or <code>InnoDB</code> table type.
Version 3.23.2 以前の MySQL では、他の多くの SQL サーバのように、<code>NULL</code> 値を持つ
インデックスフィールドを持てません。これらのフィールドは <code>NOT NULL</code> と宣言
しなくてはいけません。

</p>
<p>
<a name="IDX1817"></a>
<code>LOAD DATA INFILE</code> でデータを読み込むときは、空のフィールドは <code>''</code> で
更新されます。
項目を <code>NULL</code> 値にしたい場合は、テキストファイル中に <code>\N</code> を使用すべき
です。
リテラルとしての <code>'NULL'</code> 語が、ある状況下で使用されています。
 「<a href="manual.ja_Reference.html#LOAD_DATA">6.4.9  <code>LOAD DATA INFILE</code> 構文</a>」節参照.

</p>
<p>
When using <code>ORDER BY</code>, <code>NULL</code> values are presented first.
In versions prior to 4.0.2, if you sort in descending order using
<code>DESC</code>, <code>NULL</code> values are presented last.
When using <code>GROUP BY</code>, all <code>NULL</code> values are regarded as equal.

</p>
<p>
To help with <code>NULL</code> handling, you can use the <code>IS NULL</code> and
<code>IS NOT NULL</code> operators and the <code>IFNULL()</code> function.

</p>
<p>
<code>ORDER BY</code> 使用時, <code>NULL</code> 値は最初に提示されます.
<code>DESC</code> を使用して降順にソートする時、<code>NULL</code> 値は最後になります。
<code>GROUP BY</code> 使用時, 全ての <code>NULL</code> 値は等しいと見なされます。

</p>
<p>
<code>NULL</code> 処理を手助けするため、次の関数を使用できます:
<code>IS NULL</code>, <code>IS NOT NULL</code>, <code>IFNULL()</code>.

</p>
<p>
<a name="IDX1818"></a>
<a name="IDX1819"></a>
<a name="IDX1820"></a>
<a name="IDX1821"></a>
いくつかの項目型では、<code>NULL</code> 値はハンドルとして扱われます。
もしテーブル内の最初の <code>TIMESTAMP</code> 項に <code>NULL</code> を挿入するなら、
現在の日付と時刻が挿入されます。もし <code>AUTO_INCREMENT</code> 項に<code>NULL</code> 値を
挿入するなら、
次のシーケンス番号が挿入されます。

</p>



<h3><a name="Problems_with_alias" href="manual.ja_toc.html#Problems_with_alias">A.5.4  <code>alias</code> の問題</a></h3>

<p>
<a name="IDX1822"></a>

</p>
<p>
<code>GROUP BY</code>, <code>ORDER BY</code>, <code>HAVING</code> 節において
項目を参照するに当たりエイリアスが使用できます。
エイリアスは項目としてより良い名称を与えるのに使用されます：

</p>

<pre>SELECT SQRT(a*b) as rt FROM table_name GROUP BY rt HAVING rt &gt; 0;
SELECT id,COUNT(*) AS cnt FROM table_name GROUP BY id HAVING cnt &gt; 0;
SELECT id AS "Customer identity" FROM table_name;
</pre>

<p>
 ANSI SQL が <code>WHERE</code> 節内でエイリアスを参照することを
許可していないことに注意してください。これは <code>WHERE</code> が実行される時点で
項目の値がまだ決定されていないからです。例えば、以下のクエリは <strong>あやまり
です</strong>：

</p>

<pre>SELECT id,COUNT(*) AS cnt FROM table_name WHERE cnt &gt; 0 GROUP BY id;
</pre>

<p>
どの行が <code>GROUP BY</code> に含まれるかを決めるために <code>WHERE</code> 構文が
実行される一方で、
得られた結果のどの行を使うか確定するために <code>HAVING</code> が使用されます。

</p>



<h3><a name="Deleting_from_related_tables" href="manual.ja_toc.html#Deleting_from_related_tables">A.5.5  Deleting Rows from Related Tables</a></h3>

<p>
<a name="IDX1823"></a>
<a name="IDX1824"></a>
<a name="IDX1825"></a>

</p>
<p>
MySQL は現在 副問い合わせ は未サポート(バージョン4.1以上)です。また、
Version 4.0 以前では <code>DELETE</code> 構文で複数のテーブルを扱う事もサポートしていません。
したがって、２つのテーブルに関連するレコードを消すには、以下のようにして行います：

</p>

<ol>
<li>

いくつかの <code>WHERE</code> 条件を使用して、基本となるテーブルから行を <code>SELECT</code>
</li><li>

同じ条件下で、基本となるテーブルに含まれる行を <code>DELETE</code>
</li><li>

<code>DELETE FROM related_table WHERE related_column IN (selected_rows)</code>.
</li></ol>

<p>
<code>related_column</code> のクエリの合計文字数が、1,048,576 (デフォルトは <code>max_
allowed_packet</code> の値) をこえる場合、
それをいくつかに分割して、複数の <code>DELETE</code> 構文にしなくてはなりません。

</p>
<p>
<code>related_column</code> がインデックスで、100-1000 の<code>related_column</code>だけを消
す場合、よりはやく <code>DELETE</code> できます。
もし <code>related_column</code> がインデックスでない場合、その速度は <code>IN</code> 節の引
数の数に無関係になります。

</p>



<h3><a name="No_matching_rows" href="manual.ja_toc.html#No_matching_rows">A.5.6  Solving Problems with No Matching Rows</a></h3>

<p>
<a name="IDX1826"></a>
<a name="IDX1827"></a>

</p>
<p>
複雑なクエリーを行って、もしなんの結果も返さなければ、
そのクエリーの何が悪いかを見つけるため、以下の手続きを行います：

</p>

<ol>
<li>

<code>EXPLAIN</code> を使用してクエリーをテストし、明白な間違いを見つけます。
 「<a href="manual.ja_MySQL_Optimisation.html#EXPLAIN">5.2.1  <code>EXPLAIN</code> 構文 (<code>SELECT</code>についての情報を得る)</a>」節参照.

</li><li>

<code>WHERE</code> 節で使用されているフィールドだけを Select してみます

</li><li>

結果が返ってくるまで、一つ一つクエリーからテーブルを取り除いていきます。
テーブルが大きい場合、<code>LIMIT 10</code> をクエリーで使用することは良くありません。

</li><li>

行にマッチすべきであろう項を <code>SELECT</code> してみます。
その場合、select するのは、上記で最後に取り除いたテーブルに対して行います。

</li><li>

If you are comparing <code>FLOAT</code> or <code>DOUBLE</code> columns with numbers that
have decimals, you can't use <code>'='</code>. This problem is common in most
computer languages because floating-point values are not exact values.
In most cases, changing the <code>FLOAT</code> to a <code>DOUBLE</code> will fix this.
 「<a href="manual.ja_Problems.html#Problems_with_float">A.5.7  Problems with Floating-Point Comparison</a>」節参照.

</li><li>

もしなにも悪いところを見つけることができなかった場合、
小さなテストをつくって <code>mysql test &lt; query.sql</code> を行ってみてください。
<code>mysqldump --quick database tables &gt; query.sql</code> でテストファイルを作成でき
ます。
このファイルをエディターで編集し、いくつかのinsert行を(多すぎるなら)消します。
そしてファイルの最後にselect構文を付け足します。

テストを行うには：


<pre>shell&gt; mysqladmin create test2
shell&gt; mysql test2 &lt; query.sql
</pre>

<code>mysqlbug</code> を使用して <a href="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a> にテストを投稿してくだ
さい。
</li></ol>



<h3><a name="Problems_with_float" href="manual.ja_toc.html#Problems_with_float">A.5.7  Problems with Floating-Point Comparison</a></h3>

<p>
floating-point numbers cause confusion sometimes, because these numbers
are not stored as exact values inside computer architecture. What one
can see on the screen usually is not the exact value of the number.

</p>
<p>
Field types <code>FLOAT</code>, <code>DOUBLE</code> and <code>DECIMAL</code> are such.

</p>

<pre>CREATE TABLE t1 (i INT, d1 DECIMAL(9,2), d2 DECIMAL(9,2));
INSERT INTO t1 VALUES (1, 101.40, 21.40), (1, -80.00, 0.00),
(2, 0.00, 0.00), (2, -13.20, 0.00), (2, 59.60, 46.40),
(2, 30.40, 30.40), (3, 37.00, 7.40), (3, -29.60, 0.00),
(4, 60.00, 15.40), (4, -10.60, 0.00), (4, -34.00, 0.00),
(5, 33.00, 0.00), (5, -25.80, 0.00), (5, 0.00, 7.20),
(6, 0.00, 0.00), (6, -51.40, 0.00);

mysql&gt; SELECT i, SUM(d1) AS a, SUM(d2) AS b
    -&gt; FROM t1 GROUP BY i HAVING a &lt;&gt; b;
+------+--------+-------+
| i    | a      | b     |
+------+--------+-------+
|    1 |  21.40 | 21.40 |
|    2 |  76.80 | 76.80 |
|    3 |   7.40 |  7.40 |
|    4 |  15.40 | 15.40 |
|    5 |   7.20 |  7.20 |
|    6 | -51.40 |  0.00 |
+------+--------+-------+
</pre>

<p>
The result is correct. Although the first five records look like they
shouldn't pass the comparison test, they may do so because the
difference between the numbers show up around tenth decimal, or so
depending on computer architecture.

</p>
<p>
The problem cannot be solved by using ROUND() (or similar function),
because the result is still a floating-point number. Example:

</p>

<pre>mysql&gt; SELECT i, ROUND(SUM(d1), 2) AS a, ROUND(SUM(d2), 2) AS b
    -&gt; FROM t1 GROUP BY i HAVING a &lt;&gt; b;
+------+--------+-------+
| i    | a      | b     |
+------+--------+-------+
|    1 |  21.40 | 21.40 |
|    2 |  76.80 | 76.80 |
|    3 |   7.40 |  7.40 |
|    4 |  15.40 | 15.40 |
|    5 |   7.20 |  7.20 |
|    6 | -51.40 |  0.00 |
+------+--------+-------+
</pre>

<p>
This is what the numbers in column 'a' look like:

</p><pre>mysql&gt; SELECT i, ROUND(SUM(d1), 2)*1.0000000000000000 AS a,
    -&gt; ROUND(SUM(d2), 2) AS b FROM t1 GROUP BY i HAVING a &lt;&gt; b;
+------+----------------------+-------+
| i    | a                    | b     |
+------+----------------------+-------+
|    1 |  21.3999999999999986 | 21.40 |
|    2 |  76.7999999999999972 | 76.80 |
|    3 |   7.4000000000000004 |  7.40 |
|    4 |  15.4000000000000004 | 15.40 |
|    5 |   7.2000000000000002 |  7.20 |
|    6 | -51.3999999999999986 |  0.00 |
+------+----------------------+-------+
</pre>

<p>
Depending on the computer architecture you may or may not see similar results.
Each CPU may evaluate floating-point numbers differently. For example in
some machines you may get 'right' results by multiplaying both arguments
with 1, an example follows.

</p>
<p>
<strong>WARNING: NEVER TRUST THIS METHOD IN YOUR APPLICATION, THIS IS
AN EXAMPLE OF A WRONG METHOD!!!</strong>

</p>

<pre>mysql&gt; SELECT i, ROUND(SUM(d1), 2)*1 AS a, ROUND(SUM(d2), 2)*1 AS b
    -&gt; FROM t1 GROUP BY i HAVING a &lt;&gt; b;
+------+--------+------+
| i    | a      | b    |
+------+--------+------+
|    6 | -51.40 | 0.00 |
+------+--------+------+
</pre>

<p>
The reason why the above example seems to be working is that on the
particular machine where the test was done, the CPU floating-point
arithmetics happens to round the numbers to same, but there is no
rule that any CPU should do so, so it cannot be trusted.

</p>
<p>
The correct way to do floating-point number comparison is to first
decide on what is the wanted tolerance between the numbers and then do
the comparsion against the tolerance number. For example, if we agree on
that floating-point numbers should be regarded the same, if they are
same with precision of one of ten thousand (0.0001), the comparsion
should be done like this:

</p>

<pre>mysql&gt; SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
    -&gt; GROUP BY i HAVING ABS(a - b) &gt; 0.0001;
+------+--------+------+
| i    | a      | b    |
+------+--------+------+
|    6 | -51.40 | 0.00 |
+------+--------+------+
1 row in set (0.00 sec)
</pre>

<p>
And vice versa, if we wanted to get rows where the numbers are the same,
the test would be:

</p>

<pre>mysql&gt; SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
    -&gt; GROUP BY i HAVING ABS(a - b) &lt; 0.0001;
+------+-------+-------+
| i    | a     | b     |
+------+-------+-------+
|    1 | 21.40 | 21.40 |
|    2 | 76.80 | 76.80 |
|    3 |  7.40 |  7.40 |
|    4 | 15.40 | 15.40 |
|    5 |  7.20 |  7.20 |
+------+-------+-------+
</pre>



<h2><a name="Table_Definition_Issues" href="manual.ja_toc.html#Table_Definition_Issues">A.6  Table Definition Related Issues</a></h2>



<h3><a name="ALTER_TABLE_problems" href="manual.ja_toc.html#ALTER_TABLE_problems">A.6.1  Problems with <code>ALTER TABLE</code>.</a></h3>

<p>
<a name="IDX1828"></a>
<a name="IDX1829"></a>
<a name="IDX1830"></a>

</p>
<p>
<code>ALTER TABLE</code> changes a table to the current character set.
If you get a duplicate key error during <code>ALTER TABLE</code>, then the cause
is either that the new character sets maps two keys to the same value
or that the table is corrupted, in which case you should run
<code>REPAIR TABLE</code> on the table.

</p>
<p>
もし <code>ALTER TABLE</code> が以下のようなエラーで死んだ場合：

</p>

<pre>Error on rename of './database/name.frm' to './database/B-a.frm' (Errcode: 17)
</pre>

<p>
これは以前の <code>ALTER TABLE</code> で MySQL がクラッシュしており、
<tt>`A-something'</tt> か <tt>`B-something'</tt> という名前の、誤った情報を流している
古いテーブルが存在しています。
この場合、MySQL データディレクトリに入り、<code>A-</code> や <code>B-</code> で始まる
名前を持つファイルを全て消します。
(消す代わりにどこかに移動しても構いません。)

</p>
<p>
<code>ALTER TABLE</code> は以下のように動作します:

</p>

<ul>
<li>変更要求のあった <tt>`A-xxx'</tt> という名前の新しいテーブルを作成。

</li><li>元のテーブル内の全ての行を <tt>`A-xxx'</tt> にコピー。

</li><li>元のテーブルを <tt>`B-xxx'</tt> に名称変更。

</li><li><tt>`A-xxx'</tt> は元のテーブル名に名称変更される。

</li><li><tt>`B-xxx'</tt> は消去される。

</li></ul>

<p>
もし名称変更の際に問題があると、MySQL は変更を取り消すように動きます。
致命的な問題が起きた場合(ありえませんが)、MySQL は元の古いテーブルを
 <tt>`B-xxx'</tt> という名前のままにしておきます。単にシステムレベルで名称変更すれば
データは戻ります。

</p>



<h3><a name="Change_column_order" href="manual.ja_toc.html#Change_column_order">A.6.2  テーブル中でフィールドの順序を入れ替える方法</a></h3>

<p>
<a name="IDX1831"></a>
<a name="IDX1832"></a>
<a name="IDX1833"></a>
<a name="IDX1834"></a>

</p>
<p>
SQLの主な目的はデータフォーマットからアプリケーションを切り離してしまうことにあります。そのため、常に取り出したいデータの順序を常に指定する必要があります。例えば、次のような文:

</p>

<pre>SELECT col_name1, col_name2, col_name3 FROM tbl_name;
</pre>

<p>
これは、<code>col_name1</code>, <code>col_name2</code>, <code>col_name3</code>, の順序でデータを返します。ここで、

</p>

<pre>SELECT col_name1, col_name3, col_name2 FROM tbl_name;
</pre>

<p>
こうすると、<code>col_name1</code>, <code>col_name3</code>, <code>col_name2</code>, の順序でデータを返します。

</p>
<p>
アプリケージョン内で<code>SELECT *</code>やそのテーブル内での位置に依存してしまうような
取り出し方は<strong>けっして</strong>するべきではありません。
というのは取り出されるデータの順序が常に<strong>保障されるものではない</strong>からです。
単にフィールドの情報が変更されただけでアプリケーションがエラーが発生する可能性を有しているのです。

</p>
<p>
にもかかわらずフィールドの順序を変えたい場合には次のような方法があります。

</p>

<ol>
<li>

新しいテーブルを望んでいるフィールドの順序で作成します。
</li><li>

<code>INSERT INTO new_table SELECT fields-in-new_table-order FROM old_table</code>.
を実行します。
</li><li>

<code>old_table</code>をドロップするかリネームして下さい。
</li><li>

<code>ALTER TABLE new_table RENAME old_table</code>.
を実行します。
</li></ol>

<p>
You should <strong>never</strong>, in an application, use <code>SELECT *</code> and
retrieve the columns based on their position, because the order and
position in which columns are returned <strong>cannot</strong> may not remain
the same (if you add/move/delete columns). A simple change to your
database structure would then cause your application to fail.
Of course <code>SELECT *</code> is quite suitable for testing queries.

</p>



<h3><a name="Temporary_table_problems" href="manual.ja_toc.html#Temporary_table_problems">A.6.3  TEMPORARY TABLE 問題</a></h3>

<p>
<a name="IDX1835"></a>

</p>
<p>
<code>TEMPORARY TABLES</code>を用いる処理における制限を以下に示します。

</p>

<ul>
<li>

テンポラリーテーブルでは<code>HEAP</code>, <code>ISAM</code>, <code>MyISAM</code>, <code>MERGE</code>, <code>InnoDB</code> の
いづれかの型のみを持つことが可能です。
</li><li>

テンポラリーテーブルは一度のクエリで一回しか使用できません。例えば、次のようなものは動きません。


<pre>mysql&gt; SELECT * FROM temporary_table, temporary_table AS t2;
</pre>

</li><li>

<code>ALTER TABLE org_name RENAME new_name</code> は動作します。しかし、
<code>TEMPORARY</code>テーブルに<code>RENAME</code>を使用することはできません。

</li></ul>

<p></p><hr><p>
Go to the <a href="manual.ja_Introduction.html">first</a>, <a href="manual.ja_Extending_MySQL.html">previous</a>, <a href="manual.ja_Contrib.html">next</a>, <a href="manual.ja_Concept_Index.html">last</a> section, <a href="manual.ja_toc.html">table of contents</a>.
 
 
</p></body></html>