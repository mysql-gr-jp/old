<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:14389</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="14388">[前]</a><a href="14390">[次]</a><a href="../list/14301-14400">[番号順一覧]</a><a href="../thread/14301-14400">[スレッド一覧]</a></p>
<p class="id">
mysql:14389
</p>
<div class="header">
<p>
From: &lt;idaaki@xxxxxxxxxx&gt;<br>
Date: Thu, 21 Feb 2008 09:43:47 +0900<br>
Subject: [mysql 14389] Re: レプリケーション時にDecimal型の値だけ壊れる<br>

</p>
</div>
<div class="body">
<pre>
こんにちは。

最近、私も同じような現象で困っているので、
解決にはならないかもしれませんが、参考になれば。

DBの文字コード（もしくは接続している文字コード）が
CP932ではないでしょうか？

このあたりの修正での影響で、そのような状態になっている
ようです。
<a href="http://bugs.mysql.com/bug.php?id=11338">http://bugs.mysql.com/bug.php?id=11338</a>

解決（回避）するには
　・CP932以外の文字コードで接続する
　・PreparedStatementを使用しない
　・（PHPで確認している感じでは、値をbindするさいに
　　　数値としてbindすると問題ない）
といった感じで回避できるようです。


<span class="quote1">&gt; はじめまして、川畑と申します。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; MySQLをJavaからJConnectorのPreparedStatement </span>
<span class="quote1">&gt; で使用しているのですが</span>
<span class="quote1">&gt; レプリケーションを行った際に、Decimal型が壊れるという現象が</span>
<span class="quote1">&gt; 発生しております。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; ---</span>
<span class="quote1">&gt; OS:RHEL4</span>
<span class="quote1">&gt; MySQL:5.0.19</span>
<span class="quote1">&gt; Java:JDK1.4</span>
<span class="quote1">&gt; ---</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; 例：下記のようなテーブルがあった際に</span>
<span class="quote1">&gt; id    int(8)</span>
<span class="quote1">&gt; dec decimal(6,2)</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; マスタDBに対しinsertを実行すると、正しく挿入されるのです </span>
<span class="quote1">&gt; が</span>
<span class="quote1">&gt; （ 例えば id = 4 dec = 5023.0 ）</span>
<span class="quote1">&gt; それをレプリケーションしているスレーブ側でのぞく </span>
<span class="quote1">&gt; と、decimalの</span>
<span class="quote1">&gt; 値が999999などとおかしな値になっている状況です。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; バイナリログをcatでみる限り、16進数のhex値 </span>
<span class="quote1">&gt; でログに保存されている</span>
<span class="quote1">&gt; ようなのです。これが原因なのかわかりませんが上記現象となります。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; 切り分けですが、コマンドラインのmysqlクライアントで書き </span>
<span class="quote1">&gt; 込むと</span>
<span class="quote1">&gt; 正常にレプリケーションされ、またPHPMyAdminから書き込んでも</span>
<span class="quote1">&gt; 正しくレプリケーションされてしまいます。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; これ以上の対処法が見つからずご相談させていただきました。</span>
<span class="quote1">&gt; 何か情報があればお知らせいただきたいと思います。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; ---</span>
<span class="quote1">&gt; Yusuke Kawabata &lt;kawabata at mars co jp&gt;</span>
<span class="quote1">&gt; </span>


-----------------------------------------------
IDAAKI
mail：idaaki@xxxxxxxxxx


</pre>
</div>
<p class="button"><a href="14388">[前]</a><a href="14390">[次]</a><a href="../list/14301-14400">[番号順一覧]</a><a href="../thread/14301-14400">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="14387">  14387 2008-02-20 21:07 [Yusuke Kawabata &lt;kaw] レプリケーション時にDecimal型の値だけ壊れる</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14388">  14388 2008-02-21 07:42 ┣[とみたまさひろ &lt;tomm]                                       </a></span>
<span class="current">-&gt;&nbsp;<a href="14389">  14389 2008-02-21 09:43 ┗[&lt;idaaki@xxxxxxxxxx&gt; ]                                       </a></span>
</pre>
</body>
</html>
