<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:6606</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="6605">[前]</a><a href="6607">[次]</a><a href="../list/6601-6700">[番号順一覧]</a><a href="../thread/6601-6700">[スレッド一覧]</a></p>
<p class="id">
mysql:6606
</p>
<div class="header">
<p>
From: shogo &lt;shogo &lt;sho@xxxxxxxxxx&gt;&gt;<br>
Date: Sun, 24 Nov 2002 02:32:09 +0900<br>
Subject: [mysql 06606] MySQL におけるロックについて<br>

</p>
</div>
<div class="body">
<pre>
はじめまして。河瀬と申します。

まだMySQLを初めて数ヶ月なので、初心者的な質問かも知れませんがお許しください。

MySQLのMyISAMテーブルを対戦型ゲームのユーザー情報に使用しています。
処理としては

１．ユーザー情報をSELECTにより取得
２．対戦相手情報をSELECTにより取得
３．PHPで対戦処理
４．ユーザー情報をUPDATE
５．対戦相手情報をUPDATE

という流れになっています。実際には0.1秒以内に終わるような処理なのですが、
同時に多数のアクセスがあるので、同じレコードに対して複数のスレッドからの
アクセスを想定した場合、UPDATE前のデータをSELECTされては困ります。

そのため、テーブル（またはレコード）のロックを考えているのですが、
SELECT２回、UPDATE２回という短い処理においてテーブルをロックするのはあまり
効率的とは思えず、マニュアルを読んでいるのですが良い方法が思いつきません。

そこでSELECT 〜 FOR UPDATE構文を見つけたのですが、その部分についての
記述がよく理解できず、結局どのような方法を使えばいいのかがわからずじまいとなっています。

もしよろしければ、どなたかお知恵をお貸しください。

なお、開発（デバッグ）環境は
Windows 2000 SP3 + PHP 4.2.2 + MySQL 3.23.51
サーバー環境は
Linux（バージョン不明） + PHP 4.1.2 + MySQL (バージョン不明。2001/11/21時点での安定版だと思います)
です。

よろしくお願いいたします。

</pre>
</div>
<p class="button"><a href="6605">[前]</a><a href="6607">[次]</a><a href="../list/6601-6700">[番号順一覧]</a><a href="../thread/6601-6700">[スレッド一覧]</a></p>
<pre class="list">
<span class="current">-&gt;&nbsp;<a href="6606">   6606 2002-11-24 02:32 [shogo &lt;sho@xxxxxxxxx] MySQL におけるロックについて            </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6607">   6607 2002-11-24 17:44 ┗[Tomoyuki Ishino &lt;ish]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6610">   6610 2002-11-24 19:08 　┗[とみたまさひろ &lt;tomm]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6611">   6611 2002-11-24 19:57 　　┣[Tomoyuki Ishino &lt;ish]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6625">   6625 2002-11-26 19:07 　　┗[shogo &lt;sho@xxxxxxxxx]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6628">   6628 2002-11-27 00:07 　　　┗[とみたまさひろ &lt;tomm]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6629">   6629 2002-11-27 02:24 　　　　┗[Tomoyuki Ishino &lt;ish]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6630">   6630 2002-11-27 03:02 　　　　　┣[とみたまさひろ &lt;tomm]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6631">   6631 2002-11-27 15:47 　　　　　┗[遠藤 俊裕 &lt;endo_t@xx]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6633">   6633 2002-11-28 19:38 　　　　　　┗[Takeyuki Miyagawa &lt;m]                           </a></span>
</pre>
</body>
</html>
