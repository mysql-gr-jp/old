<html><head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:12908</title>
<link rel="stylesheet" type="text/css" href="/css/w3ml.css">
</head>
<body>
<p class="button"><a href="12907.html">[前]</a><a href="12909.html">[次]</a><a href="../list/12901-13000.html">[番号順一覧]</a><a href="../thread/12901-13000.html">[スレッド一覧]</a></p>
<p class="id">
mysql:12908
</p>
<div class="header">
<p>
From: "Kenta Hashimoto" &lt;"Kenta Hashimoto" &lt;kem@xxxxxxxxxx&gt;&gt;<br>
Date: Mon, 3 Apr 2006 16:42:00 +0900<br>
Subject: [mysql 12908] バイナリログからのデータの復旧<br>

</p>
</div>
<div class="body">
<pre>橋本です。
いつも、お世話になっております。

バイナリログからのデータの復旧に関して質問です。
バイナリログから、データを復旧する場合、レプリケーションの
Exec_Master_Log_Posを利用して、途中から適用するできますでしょうか？


今、ＤＢのバックアップを取る仕組みを構築しています。

誤ってデータを消してしまったなどの障害が起きた場合に、
一日に一度とってある、mysqldumpしたファイルを、mysqlに流し込む
形で、復旧するところまではできています。

これに加えて、さらに、バックアップをとった後に走ったクエリからも、
データを復旧したいと思っているのですが、そこで詰まっています。
アドバイスをいただけるとありがたいです。


バックアップは、以下の手順を自動化して、とっています。

１．レプリケーションのスレーブを、STOP SLAVEする。
２．FLUSH TABLESする
３．relay-log.info の、Master_Log_Fileと、Exec_Master_Log_Posを保存する
４．mysqldumpで、バックアップを取る。
５．レプリケーションを再開する。

これで、データを消してしまった場合などには、このダンプファイルの時点の
データまでは復元できます。
ダンプファイルの時点まで復元した後、バイナリログからも復元したいのですが、
その場合は、ダンプファイルを取った時点よりも後のものだけを適用したいのです。

mysqlbinlogには、positionという引数があるようなのですが、これは、
バイナリログ内での場所であって、レプリケーションのExec_Master_Log_Posとは
別のもののようです。


こういう場合は、皆さんはどうしていらっしゃるのでしょうか？

・Exec_Master_Log_Posをもとにmysqlbinlogを使用する方法がある？
・バックアップを取るときに、マスターを一度とめて、その時点でのバイナリログの場所を、
　なんらかの方法で記録する？
・バックアップを取るときに、バイナリログのファイルを新しいものにする方法がある？

などのことを考え、調べたのですが、結局見つかりませんでした。

よろしくお願いいたします。

</pre>
</div>
<p class="button"><a href="12907.html">[前]</a><a href="12909.html">[次]</a><a href="../list/12901-13000.html">[番号順一覧]</a><a href="../thread/12901-13000.html">[スレッド一覧]</a></p>
<pre class="list"><span class="current">-&gt;&nbsp;<a href="12908.html">  12908 2006-04-03 16:42 ["Kenta Hashimoto" &lt;k] バイナリログからのデータの復旧          </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12909.html">  12909 2006-04-03 17:01 ┣["F.Y" &lt;fumi_sby@xxxx]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12910.html">  12910 2006-04-03 17:36 ┃┗["Kenta Hashimoto" &lt;k]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12912.html">  12912 2006-04-04 18:00 ┗[Yasufumi Kinoshita &lt;]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12916.html">  12916 2006-04-05 16:39 　┗["Kenta Hashimoto" &lt;k]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12924.html">  12924 2006-04-12 15:29 　　┗[Katsuyuki Sakai &lt;sak]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12929.html">  12929 2006-04-19 17:40 　　　┗[Katsuyuki Sakai &lt;sak]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12930.html">  12930 2006-04-20 11:28 　　　　┗["Kenta Hashimoto" &lt;k]                               </a></span>
</pre>


</body></html>