<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:14356</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css.html">
</head>
<body>
<p class="button"><a href="14355.html">[前]</a><a href="14357.html">[次]</a><a href="../list/14301-14400.html">[番号順一覧]</a><a href="../thread/14301-14400.html">[スレッド一覧]</a></p>
<p class="id">
mysql:14356
</p>
<div class="header">
<p>
From: Kinoshita &lt;Kinoshita &lt;QZT05560@xxxxxxxxxx&gt;&gt;<br>
Date: Sat, 26 Jan 2008 01:42:53 +0900<br>
Subject: [mysql 14356] Re: InnoDBテーブルのテーブルスペース容量計算<br>

</p>
</div>
<div class="body">
<pre>
木下と申します。

（同姓ですね）木下さん早速のお返事ありがとうございます。

On Thu, 24 Jan 2008 12:39:24 +0900
Yasufumi Kinoshita &lt;kinoshita.yasufumi@xxxxxxxxxx&gt; wrote:

<span class="quote1">&gt; InnoDBにおける表の構造は主キーの索引構造になっていますので、</span>
<span class="quote1">&gt; ランダムな順番での挿入はフラグメンテーションが多発してしまい、</span>
<span class="quote1">&gt; Data_lengthは無用に大きくなってしまいます。</span>

はい、確かにそのようです。
試しに、主キーをシーケンシャルに並べた256万レコードのINSERTと
ランダムに並べた256万レコードのINSERTでは、（そのランダム性にも
よると思いますが）おおよそ、1.6倍程度のData_lengthになりました。

<span class="quote1">&gt; ALTER TABLE test ENGINE=InnoDB;</span>
<span class="quote1">&gt; ANALYZE TABLE test;</span>
<span class="quote1">&gt; とデフラグすると、SHOW TABLE STATUSの結果が変わりませんか？</span>

そして、主キーをランダムに並べた256万レコードをINSERTしたテーブルに
対して、ALTER TABLEを実行すると、シーケンシャルに並べた256万レコードを
INSERTしたテーブルのData_lengthと同じ値になりました。

シーケンシャルの方が「詰まった配置」で書き込まれる、つまり、
一番少ない容量のテーブルサイズになると解釈しました。

<span class="quote1">&gt; また、必要容量計算ですが、</span>
<span class="quote1">&gt; このように表自体が索引の構造なので、厳密に正確にサイズを見積もるのは難しいです。</span>

UNDOログに相当する領域が必要であることと、
また、索引構造（InnoDBはB-Treeでしたよね？）のため、
厳密な計算が難しいというのも理解はできるのですが、
結局のところ、MySQLでInnoDBを用いた場合に、
必要なディスク容量を見積もるための「指針」というか「拠り所」は
ないものでしょうか？

現在担当しているシステムは、ディスク容量にシビアなシステムという
制約がありまして、「気にならないくらい大容量のパーティションを割り当てて
おけばいい」というわけにもいかず、困っております。

レコードの挿入の度にALTER TABLEを発行するのも性能に影響しそうですし、
何らか「これを越えない」といった計算はないものでしょうか？
あるいは、そういうコンサルテーションを受けることができる
専門家はおられませんでしょうか？

皆さんはどうされておられますか？

--
S.Kinoshita
shige_chan@xxxxxxxxxx


</pre>
</div>
<p class="button"><a href="14355.html">[前]</a><a href="14357.html">[次]</a><a href="../list/14301-14400.html">[番号順一覧]</a><a href="../thread/14301-14400.html">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="14352.html">  14352 2008-01-23 23:30 [Kinoshita &lt;QZT05560@] InnoDBテーブルのテーブルスペース容量計算</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14353.html">  14353 2008-01-24 12:39 ┗[Yasufumi Kinoshita &lt;]                                       </a></span>
<span class="current">-&gt;&nbsp;<a href="14356.html">  14356 2008-01-26 01:42 　┗[Kinoshita &lt;QZT05560@]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14359.html">  14359 2008-01-31 00:07 　　┗[IIDAYUICHI &lt;y_iida@x]                                   </a></span>
</pre>
</body>
</html>
