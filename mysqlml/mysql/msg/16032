<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:16032</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="16031">[前]</a><a href="16033">[次]</a><a href="../list/16001-16100">[番号順一覧]</a><a href="../thread/16001-16100">[スレッド一覧]</a></p>
<p class="id">
mysql:16032
</p>
<div class="header">
<p>
From: Hwang Se Won &lt;Hwang Se Won &lt;coolguy318@xxxxxxxxxx&gt;&gt;<br>
Date: Thu, 12 Sep 2013 10:43:57 +0900<br>
Subject: [mysql 16032] Re: MySQLのデータ領域が１００％になったとき。。<br>

</p>
</div>
<div class="body">
<pre>
平塚さん、
はじめまして、黄世元と申します。

メールありがとう御座います。
ccp_ompuvというデータベースの中に ファイルが圧倒てきにおおいですね。

これは、削除できないですね。
新しいサーバを構築して、全データを引っ越すしかないですね。


ccp_ompuv の中身をみると
-rw-rw---- 1 mysql dba 6660554752 Dec 1 2011 UV_LOG_BASE#P#p11.ibd
-rw-rw---- 1 mysql dba 15825108992 Jan 1 2012 UV_LOG_BASE#P#p12.ibd
-rw-rw---- 1 mysql dba 17960009728 Feb 1 2012 UV_LOG_BASE#P#P01.ibd
-rw-rw---- 1 mysql dba 16819159040 Mar 1 2012 UV_LOG_BASE#P#P02.ibd
-rw-rw---- 1 mysql dba 17922260992 Apr 1 2012 UV_LOG_BASE#P#P03.ibd
-rw-rw---- 1 mysql dba 17318281216 May 1 2012 UV_LOG_BASE#P#P04.ibd
-rw-rw---- 1 mysql dba 19159580672 Jun 1 2012 UV_LOG_BASE#P#P05.ibd
-rw-rw---- 1 mysql dba 19482542080 Jul 1 2012 UV_LOG_BASE#P#P06.ibd
-rw-rw---- 1 mysql dba 131072 Jul 13 2012 UV_LOG_BASE#P#P10.ibd
-rw-rw---- 1 mysql dba 72 Jul 28 2012 UV_LOG_BASE.par
-rw-rw---- 1 mysql dba 13280 Jul 28 2012 UV_LOG_BASE.frm
-rw-rw---- 1 mysql dba 15497953280 Aug 1 2012 UV_LOG_BASE#P#P07.ibd
-rw-rw---- 1 mysql dba 25132269568 Sep 30 2012 UV_LOG.ibd
-rw-rw---- 1 mysql dba 13149196288 Sep 30 2012 UV_LOG_BASE#P#P09.ibd




du -am /MYSQL/DATA | sort -k 1 -nr | head -100

179376 /MYSQL/DATA
176546 /MYSQL/DATA/ccp_ompuv
23992 /MYSQL/DATA/ccp_ompuv/UV_LOG.ibd
18599 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#P06.ibd
18290 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#P05.ibd
17145 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#P01.ibd
17109 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#P03.ibd
16533 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#P04.ibd
16056 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#P02.ibd
15107 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#p12.ibd
14795 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#P07.ibd
12553 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#P09.ibd
6359 /MYSQL/DATA/ccp_ompuv/UV_LOG_BASE#P#p11.ibd
1026 /MYSQL/DATA/ibdata2
1026 /MYSQL/DATA/ibdata1
257 /MYSQL/DATA/ib_logfile2
257 /MYSQL/DATA/ib_logfile1
257 /MYSQL/DATA/ib_logfile0
12 /MYSQL/DATA/ccp_ompuv/UV_LOG_20110614.dat
11 /MYSQL/DATA/ibdata3
1 /MYSQL/DATA/psamuvdb2.pid
1 /MYSQL/DATA/performance_schema/threads.frm
1 /MYSQL/DATA/performance_schema/setup_timers.frm
1 /MYSQL/DATA/performance_schema/setup_instruments.frm
1 /MYSQL/DATA/performance_schema/setup_consumers.frm
1 /MYSQL/DATA/performance_schema/rwlock_instances.frm
1 /MYSQL/DATA/performance_schema/performance_timers.frm
1 /MYSQL/DATA/performance_schema/mutex_instances.frm
1 /MYSQL/DATA/performance_schema/file_summary_by_instance.frm
1 /MYSQL/DATA/performance_schema/file_summary_by_event_name.frm
1 /MYSQL/DATA/performance_schema/file_instances.frm
1
/MYSQL/DATA/performance_schema/events_waits_summary_global_by_event_name.frm
1
/MYSQL/DATA/performance_schema/events_waits_summary_by_thread_by_event_name.frm
1 /MYSQL/DATA/performance_schema/events_waits_summary_by_instance.frm
1 /MYSQL/DATA/performance_schema/events_waits_history_long.frm
1 /MYSQL/DATA/performance_schema/events_waits_history.frm
1 /MYSQL/DATA/performance_schema/events_waits_current.frm
1 /MYSQL/DATA/performance_schema/db.opt
1 /MYSQL/DATA/performance_schema/cond_instances.frm
1 /MYSQL/DATA/performance_schema
1 /MYSQL/DATA/mysql/user.MYI
1 /MYSQL/DATA/mysql/user.MYD
1 /MYSQL/DATA/mysql/user.frm
1 /MYSQL/DATA/mysql_upgrade_info
1 /MYSQL/DATA/mysql/time_zone_transition_type.MYI
1 /MYSQL/DATA/mysql/time_zone_transition_type.frm
1 /MYSQL/DATA/mysql/time_zone_transition.MYI
1 /MYSQL/DATA/mysql/time_zone_transition.frm
1 /MYSQL/DATA/mysql/time_zone_name.MYI
1 /MYSQL/DATA/mysql/time_zone_name.frm
1 /MYSQL/DATA/mysql/time_zone.MYI
1 /MYSQL/DATA/mysql/time_zone_leap_second.MYI
1 /MYSQL/DATA/mysql/time_zone_leap_second.frm
1 /MYSQL/DATA/mysql/time_zone.frm
1 /MYSQL/DATA/mysql/tables_priv.MYI
1 /MYSQL/DATA/mysql/tables_priv.frm
1 /MYSQL/DATA/mysql/slow_log.frm
1 /MYSQL/DATA/mysql/slow_log.CSM
1 /MYSQL/DATA/mysql/servers.MYI
1 /MYSQL/DATA/mysql/servers.frm
1 /MYSQL/DATA/mysql/proxies_priv.MYI
1 /MYSQL/DATA/mysql/proxies_priv.MYD
1 /MYSQL/DATA/mysql/proxies_priv.frm
1 /MYSQL/DATA/mysql/procs_priv.MYI
1 /MYSQL/DATA/mysql/procs_priv.frm
1 /MYSQL/DATA/mysql/proc.MYI
1 /MYSQL/DATA/mysql/proc.MYD
1 /MYSQL/DATA/mysql/proc.frm
1 /MYSQL/DATA/mysql/plugin.MYI
1 /MYSQL/DATA/mysql/plugin.frm
1 /MYSQL/DATA/mysql/ndb_binlog_index.MYI
1 /MYSQL/DATA/mysql/ndb_binlog_index.frm
1 /MYSQL/DATA/mysql/host.MYI
1 /MYSQL/DATA/mysql/host.frm
1 /MYSQL/DATA/mysql/help_topic.MYI
1 /MYSQL/DATA/mysql/help_topic.MYD
1 /MYSQL/DATA/mysql/help_topic.frm
1 /MYSQL/DATA/mysql/help_relation.MYI
1 /MYSQL/DATA/mysql/help_relation.MYD
1 /MYSQL/DATA/mysql/help_relation.frm
1 /MYSQL/DATA/mysql/help_keyword.MYI
1 /MYSQL/DATA/mysql/help_keyword.MYD
1 /MYSQL/DATA/mysql/help_keyword.frm
1 /MYSQL/DATA/mysql/help_category.MYI
1 /MYSQL/DATA/mysql/help_category.MYD
1 /MYSQL/DATA/mysql/help_category.frm
1 /MYSQL/DATA/mysql/general_log.frm
1 /MYSQL/DATA/mysql/general_log.CSM
1 /MYSQL/DATA/mysql/func.MYI
1 /MYSQL/DATA/mysql/func.frm
1 /MYSQL/DATA/mysql/event.MYI
1 /MYSQL/DATA/mysql/event.frm
1 /MYSQL/DATA/mysql/db.MYI
1 /MYSQL/DATA/mysql/db.MYD
1 /MYSQL/DATA/mysql/db.frm
1 /MYSQL/DATA/mysql/columns_priv.MYI
1 /MYSQL/DATA/mysql/columns_priv.frm
1 /MYSQL/DATA/mysql
1 /MYSQL/DATA/lost@002bfound/db.opt
1 /MYSQL/DATA/lost@002bfound


ありがとうございました。


2013-09-12 ?? 9:53, HIRATSUKA Sadao ? ?:
<span class="quote1">&gt; こんにちは、平塚です。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; On Wed, 11 Sep 2013 15:16:32 +0900</span>
<span class="quote1">&gt; Hwang Se Won &lt;coolguy318@xxxxxxxxxx&gt; wrote:</span>
<span class="quote1">&gt;</span>
<span class="quote2">&gt;&gt; DRBD＋Heartbeat＋MySQLの構成でデータの領域を減らすためには、</span>
<span class="quote2">&gt;&gt; どうすればい いでしょうか？</span>
<span class="quote1">&gt; 以前<a href="15912">[mysql 15912]</a>で類似の質問をされていますが、</span>
<span class="quote1">&gt; それとは別のサーバですよね。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; 状況はあまり良くないと思います。</span>
<span class="quote1">&gt; DRBD構成のため、簡単にディスクを増設することができません。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; まず、以下のようなコマンドでどのファイルが領域を圧迫しているのか</span>
<span class="quote1">&gt; 調べてみてください。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; du -am /MYSQL/DATA | sort -k 1 -nr | head -100</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; ＜実行例＞</span>
<span class="quote1">&gt; 2349    /var/lib/mysql</span>
<span class="quote1">&gt; 1670    /var/lib/mysql/scott</span>
<span class="quote1">&gt; 1585    /var/lib/mysql/scott/lineorder.ibd</span>
<span class="quote1">&gt; 281     /var/lib/mysql/tpcc</span>
<span class="quote1">&gt; 141     /var/lib/mysql/ibdata1</span>
<span class="quote1">&gt; 128     /var/lib/mysql/ib_logfile1</span>
<span class="quote1">&gt; 128     /var/lib/mysql/ib_logfile0</span>
<span class="quote1">&gt; 97      /var/lib/mysql/tpcc/order_line.ibd</span>
<span class="quote1">&gt; 85      /var/lib/mysql/tpcc/stock.ibd</span>
<span class="quote1">&gt; 56      /var/lib/mysql/scott/part.ibd</span>
<span class="quote1">&gt; 45      /var/lib/mysql/tpcc/customer.ibd</span>
<span class="quote1">&gt; 20      /var/lib/mysql/scott/customer.ibd</span>
<span class="quote1">&gt; 17      /var/lib/mysql/tpcc/item.ibd</span>
<span class="quote1">&gt; 16      /var/lib/mysql/tpcc/orders.ibd</span>
<span class="quote1">&gt; 16      /var/lib/mysql/tpcc/history.ibd</span>
<span class="quote1">&gt; 10      /var/lib/mysql/tpcc/new_orders.ibd</span>
<span class="quote1">&gt; 10      /var/lib/mysql/scott/supplier.ibd</span>
<span class="quote1">&gt; …</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; 消してもよいファイルがあれば状況は良くなりますが、</span>
<span class="quote1">&gt; あまり期待はなさらないでください。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; 新たにDBサーバを構築して、そちらに全データを引っ越すような</span>
<span class="quote1">&gt; 対処になる可能性が高いです。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; よろしくお願いします。</span>
<span class="quote1">&gt;</span>



</pre>
</div>
<div class="attach">
<h3 class="attachtitle">添付ファイル</h3>
<ul>
<li><a href="http://www.mysql.gr.jp/mysqlml/mysql/msg/16032/0/"> [text/html]</a>
</ul>
</div>
<p class="button"><a href="16031">[前]</a><a href="16033">[次]</a><a href="../list/16001-16100">[番号順一覧]</a><a href="../thread/16001-16100">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="16030">@ 16030 2013-09-11 15:16 [Hwang Se Won &lt;coolgu] MySQLのデータ領域が１００％になったとき。。</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16031">  16031 2013-09-12 09:53 ┗[HIRATSUKA Sadao &lt;hir]                                       </a></span>
<span class="current">-&gt;&nbsp;<a href="16032">@ 16032 2013-09-12 10:43 　┗[Hwang Se Won &lt;coolgu]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16033">  16033 2013-09-12 11:06 　　┗[HIRATSUKA Sadao &lt;hir]                                   </a></span>
</pre>
</body>
</html>
