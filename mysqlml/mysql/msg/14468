<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:14468</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="14467">[前]</a><a href="14469">[次]</a><a href="../list/14401-14500">[番号順一覧]</a><a href="../thread/14401-14500">[スレッド一覧]</a></p>
<p class="id">
mysql:14468
</p>
<div class="header">
<p>
From: Alex &lt;Alex &lt;alex.backspin@xxxxxxxxxx&gt;&gt;<br>
Date: Thu, 24 Apr 2008 17:49:07 +0900<br>
Subject: [mysql 14468] Re: myisamchk<br>

</p>
</div>
<div class="body">
<pre>
ALEXです。

ありがとうございます。

その後いろいろやってみたところ、とりあえずデータは復旧したみたいです。

１．テーブル名.MYD　を別名でコピーして退避
２．MySQLクライアントからtruncateにて全件データを削除
３．１で退避したデータをオリジナルに上書きコピー
４．テーブルをロックしたあとで、　repair table テーブル名 を実行

myisamchk ではなく、テーブルをロックしてrepairかoptimizeにて最適化したほ
うが現実的ではないでしょうか。
運用をしているmysqldをとめることはなかなか難しいでしょうし。
または、一度mysqldumpでバックアップしてオリジナルを消去、その後再作成し
たほうが影響度は少ないかもしれないですね。

Mikiya Okuno wrote:
<span class="quote1">&gt; こんにちは。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; 残念ですが、コマンドが間違っているようです。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; myisamchk は MyISAM テーブルのリペアを行うコマンドであり、</span>
<span class="quote1">&gt; 最適化をするには mysqlcheck コマンドを -o オプションで使用するか</span>
<span class="quote1">&gt; OPTIMIZE TABLE ステートメントを使用する必要があります。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; また、myisamchk は mysqld オフライン時に使用しなければならないコマンドであり、</span>
<span class="quote1">&gt; もしオンライン時に使用されたのならデータの整合性が取れなくなってしまいます。</span>
<span class="quote1">&gt; 残念ですがデータはもう戻らない公算が高いので、バックアップから戻しましょう。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; MyISAM は別途レコード件数をメモリ上に保持しているので、</span>
<span class="quote1">&gt; count(*) が結果を返したのだと思います。</span>
<span class="quote1">&gt; --</span>
<span class="quote1">&gt; Mikiya Okuno, Support Engineer</span>
<span class="quote1">&gt; MySQL KK, <a href="http://www-jp.mysql.com/">http://www-jp.mysql.com/</a></span>
<span class="quote1">&gt; Office: Ebisu IS Building, 6th floor,</span>
<span class="quote1">&gt;         13-6 Ebisu 1-chome,</span>
<span class="quote1">&gt;         Shibuya-ku, Tokyo 150-0013</span>
<span class="quote1">&gt; Tel: 81-(0)3-5918-7523</span>
<span class="quote1">&gt; Fax: 81-(0)3-5918-7510</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; Are you MySQL certified?  <a href="http://www.mysql.com/certification">http://www.mysql.com/certification</a></span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; On 2008/04/24, at 14:49, Alex wrote:</span>
<span class="quote2">&gt;&gt; ALEXです。</span>
<span class="quote2">&gt;&gt;</span>
<span class="quote3">&gt;&gt;&gt; myisamchk -r テーブル名</span>
<span class="quote2">&gt;&gt; として725万件のテーブルを最適化しようとしました。</span>
<span class="quote2">&gt;&gt; 処理自身はエラーなく完了したのですが、中身を参照することができなくなりま</span>
<span class="quote2">&gt;&gt; した。</span>
<span class="quote2">&gt;&gt; mysqlクライアントにて、select文を発行してもemptyとなってしまいます。</span>
<span class="quote2">&gt;&gt; データが存在しないのかと思って、件数を確認(select count(*) from テーブル</span>
<span class="quote2">&gt;&gt; 名)しましたが存在しているようです。</span>
<span class="quote2">&gt;&gt;</span>
<span class="quote2">&gt;&gt; 原因と修復方法をご存知の方はご教授頂きたく、よろしくお願い致します。</span>
<span class="quote2">&gt;&gt;</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; </span>

</pre>
</div>
<p class="button"><a href="14467">[前]</a><a href="14469">[次]</a><a href="../list/14401-14500">[番号順一覧]</a><a href="../thread/14401-14500">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="14464">  14464 2008-04-24 14:49 [Alex &lt;alex.backspin@] myisamchk                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14465">  14465 2008-04-24 15:30 ┗[Mikiya Okuno &lt;okuno@]                                       </a></span>
<span class="current">-&gt;&nbsp;<a href="14468">  14468 2008-04-24 17:49 　┗[Alex &lt;alex.backspin@]                                     </a></span>
</pre>
</body>
</html>
