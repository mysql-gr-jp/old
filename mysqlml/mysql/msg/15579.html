<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:15579</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="15578.html">[前]</a><a href="15580.html">[次]</a><a href="../list/15501-15600.html">[番号順一覧]</a><a href="../thread/15501-15600.html">[スレッド一覧]</a></p>
<p class="id">
mysql:15579
</p>
<div class="header">
<p>
From: Mikiya Okuno &lt;Mikiya Okuno &lt;mikiya.okuno@xxxxxxxxxx&gt;&gt;<br>
Date: Thu, 28 Apr 2011 15:27:12 +0900<br>
Subject: [mysql 15579] Re: 最新 10  件の内でベスト 5  の合計を取りたい<br>

</p>
</div>
<div class="body">
<pre>
奥野です。

ポイントは次の2点ですね。

・結果を得るには異なるカラムでソートをする必要がある。
・LIMIT句で結果を絞り込んでからSUMで合計をとる。

いずれの場合もFROM句のサブクエリを利用する必要がありますので、
FROM句のサブクエリを2回利用する今のクエリ以外に方法はないと
思います。

ちなみに、

<span class="quote1">&gt; MySQL Version 5.1.16</span>

バージョンは古過ぎるように思います。本番環境で利用されるなら、
メンテナンスを考えるとせめてGA版にしたほうが良いと思います。

ではでは。
--
奥野 幹也 
<a href="http://www.google.com/profiles/mikiya.okuno">http://www.google.com/profiles/mikiya.okuno</a>
<a href="http://nippondanji.blogspot.com/">http://nippondanji.blogspot.com/</a> 
<a href="http://twitter.com/nippondanji">http://twitter.com/nippondanji</a>


On 04/28/2011 02:34 PM, 岩崎　誠司 wrote:
<span class="quote1">&gt; 岩崎と申します。</span>
<span class="quote1">&gt; いつも皆様MLを参考にさせていただいてます。</span>
<span class="quote1">&gt; ちょっと皆様のお知恵を拝借したいと思い投稿しました。</span>
<span class="quote1">&gt; 表題にもありますが、該当する「num」の一定期間の最新のデータ</span>
<span class="quote1">&gt; 10件のうち、diffのベスト5の合計を取りたいので以下のようなクエリで</span>
<span class="quote1">&gt; 取得しましたが、SELECTを何回も重ねるので</span>
<span class="quote1">&gt; スッキリせずに分かりにくいクエリになっています。</span>
<span class="quote1">&gt; 他に方法はないでしょうか、よろしくお願いします。</span>
<span class="quote1">&gt; ちなみにベスト5のデータを取るのでしたら、「AS d」の()内の</span>
<span class="quote1">&gt; クエリで取れます。</span>
<span class="quote1">&gt; SELECT SUM(di)</span>
<span class="quote1">&gt; FROM</span>
<span class="quote1">&gt; (SELECT di FROM</span>
<span class="quote1">&gt; (SELECT diff AS di</span>
<span class="quote1">&gt; FROM hd</span>
<span class="quote1">&gt; WHERE num = 1</span>
<span class="quote1">&gt; AND day BETWEEN '2010-04-01' AND '2011-03-31'</span>
<span class="quote1">&gt; ORDER BY day DESC LIMIT 10</span>
<span class="quote1">&gt; ) AS s</span>
<span class="quote1">&gt; ORDER BY di</span>
<span class="quote1">&gt; LIMIT 5</span>
<span class="quote1">&gt; ) AS d</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; テーブル作成文</span>
<span class="quote1">&gt; CREATE TABLE `hd` (</span>
<span class="quote1">&gt; `id` int(11) NOT NULL AUTO_INCREMENT,</span>
<span class="quote1">&gt; `num` int(11) NOT NULL,</span>
<span class="quote1">&gt; `day` date DEFAULT NULL,</span>
<span class="quote1">&gt; `diff` int(11) NOT NULL,</span>
<span class="quote1">&gt; PRIMARY KEY (`id`)</span>
<span class="quote1">&gt; ) ENGINE=MyISAM</span>
<span class="quote1">&gt; 環境</span>
<span class="quote1">&gt; OS Windows7 professional SP1</span>
<span class="quote1">&gt; MySQL Version 5.1.16</span>

</pre>
</div>
<p class="button"><a href="15578.html">[前]</a><a href="15580.html">[次]</a><a href="../list/15501-15600.html">[番号順一覧]</a><a href="../thread/15501-15600.html">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="15578.html">@ 15578 2011-04-28 14:34 [岩崎　誠司 &lt;iwasaki_] 最新 10 件の内でベスト 5 の合計を取りたい</a></span>
<span class="current">-&gt;&nbsp;<a href="15579.html">  15579 2011-04-28 15:27 ┗[Mikiya Okuno &lt;mikiya]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="15580.html">  15580 2011-04-28 16:58 　┗[岩崎　誠司 &lt;iwasaki_]                                     </a></span>
</pre>
</body>
</html>
