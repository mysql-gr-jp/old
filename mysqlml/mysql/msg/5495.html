<html><head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:5495</title>
<link rel="stylesheet" type="text/css" href="/css/w3ml.css">
</head>
<body>
<p class="button"><a href="5494.html">[前]</a><a href="5496.html">[次]</a><a href="../list/5401-5500.html">[番号順一覧]</a><a href="../thread/5401-5500.html">[スレッド一覧]</a></p>
<p class="id">
mysql:5495
</p>
<div class="header">
<p>
From: "Takeo Shibata" &lt;"Takeo Shibata" &lt;shibata@xxxxxxxxxx&gt;&gt;<br>
Date: Mon, 13 May 2002 17:03:53 -0700<br>
Subject: [mysql 05495] LOCK TABLE の使用およびそのた SQL の実行保証にかんして<br>

</p>
</div>
<div class="body">
<pre>いつもお世話になってます
関連する２つのテーブルを同時に更新をかけ
どのような状態においても
かならず２つのテーブルが同時にアップされる必要があります
１つが何らかの理由により失敗すればもういつの更新もキャンセル
しなければなりません

この<a href="http://www.mysql.gr.jp/">http://www.mysql.gr.jp/</a>
の1.4.6 COMMIT/ROLLBACK なしでうまくやる方法
で
いまいろいろ資料みて
LOCK TABLEという記述と
1回のオペレーション中でレコードを更新する関数
という記述がありました

実際は
connect_db
SQL1 = insert into customer(id, passwd, user, ....) values(xx,yy,zz)
SQL2 = insert into login(id, passwd, host) values(xx,yy,$REMOTE_HOST)
LOCK TABLES customer WRITE, login WRITE 
execute(SQL1),
execute(SQL2)
UNLOCK TABLES

とやりたいのですが
まあ用は
execute(SQL1)
でここで失敗すればすべてのアクションを取り消せばいいのですが
execute(SQL1)が成功して
execute(SQL2)が失敗した場合、再度試行するか、
SQL1をキャンセルしたいのですが

通常SQL1,SQL２両方成功させ、最悪でも
両方実行していない状態をできるだけ保証したいのですが
なにかSQLでスマートなやりかたありますでしょうか？

２つ以上の更新、追加SQL
クエリーを実行するときで最初のクエリーが成功し、その
次のクエリーが失敗したら、最初のクエリー実行をキャンセルして
から最試行するなりエラー表示するようにしたいのですが。。

なにかDBに関しては基本的なことかも
しれませんどうかよろしくお願いいたします
こういうときはROLLBACK
んあてのを使用するべきなんでしょうか？
なにかいい方法や解決方法に関する具体的な例SQLがあるサイト
ご存知でしたらどうかご教授ください
よろしくお願いいたします




</pre>
</div>
<p class="button"><a href="5494.html">[前]</a><a href="5496.html">[次]</a><a href="../list/5401-5500.html">[番号順一覧]</a><a href="../thread/5401-5500.html">[スレッド一覧]</a></p>
<pre class="list"><span class="current">-&gt;&nbsp;<a href="5495.html">   5495 2002-05-14 09:03 ["Takeo Shibata" &lt;shi] LOCK TABLE の使用およびそのた SQL の実行保証にかんして</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="5501.html">   5501 2002-05-14 23:07 ┗[とみたまさひろ &lt;tomm]                                       </a></span>
</pre>


</body></html>