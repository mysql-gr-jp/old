<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:15625</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css.html">
</head>
<body>
<p class="button"><a href="15624.html">[前]</a><a href="15626.html">[次]</a><a href="../list/15601-15700.html">[番号順一覧]</a><a href="../thread/15601-15700.html">[スレッド一覧]</a></p>
<p class="id">
mysql:15625
</p>
<div class="header">
<p>
From: Etsuo SUMIYA &lt;Etsuo SUMIYA &lt;sumiya-e@xxxxxxxxxx&gt;&gt;<br>
Date: Wed, 31 Aug 2011 18:27:12 +0900 (LMT)<br>
Subject: [mysql 15625] Re: mysql 5.5.9でのset names sjisで性能低下<br>

</p>
</div>
<div class="body">
<pre>
sumiyaといいます。

From: HIRATSUKA Sadao &lt;hiratsuka.sadao@xxxxxxxxxx&gt;
Subject: <a href="15624.html">[mysql 15624]</a> Re: mysql 5.5.9でのset names sjisで性能低下
Date: Wed, 31 Aug 2011 12:33:06 +0900
Message-ID: &lt;20110831123306.2AD2.C8FC6C14@xxxxxxxxxx&gt;

<span class="quote2">&gt; &gt; &quot;set names sjis&quot;を実行すると、t2の</span>
<span class="quote2">&gt; &gt; rowsが10となり、indexがきかず、全スキャンかかってしまうようです。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; いただいたテストケースは</span>
<span class="quote1">&gt; MySQL 5.5.11で再現して、MySQL 5.5.12だと再現しませんでした。</span>
<span class="quote1">&gt; たぶん↓これです。</span>
<span class="quote1">&gt; <a href="http://bugs.mysql.com/bug.php?id=60625">http://bugs.mysql.com/bug.php?id=60625</a></span>

最新では修正済みだったんですね。今年の4月頃、遅くなる現象はつかん
でいたのですが、時間が取れず、5.1.xを使用してました。
問題を放って置くわけにもゆかず調べたので、古いシステムで失礼しまし
た。

<span class="quote1">&gt; ただそれとは別に</span>
<span class="quote1">&gt; 最新のMySQL 5.5.15でも再現するケースを作れたので、バグ報告してみました。</span>
<span class="quote1">&gt; <a href="http://bugs.mysql.com/bug.php?id=62307">http://bugs.mysql.com/bug.php?id=62307</a></span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; 仕組みとしては、tm = '20:01'という検索条件を</span>
<span class="quote1">&gt;   CONVERT(tm USING SJIS sjis) = '20:01'</span>
<span class="quote1">&gt; に変換するわりと残念なロジックがMySQL 5.5から入っていて、</span>
<span class="quote1">&gt; これの発動条件の一つがcharacter_set_connection = ucs2あるいはsjis</span>
<span class="quote1">&gt; となっているようです。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; ucs2のためにはこのロジックがどうしても必要なようですが、</span>
<span class="quote1">&gt; sjisは巻き添えを喰らった感があります。</span>

同じ原因なのかもしれませんが、sjisにすると、日付や時刻などの検索条
件として,DBに記録されているのと同じ書式、1:1:0ならば01:01:00と記述
しないとquery結果が出ないなど色々と問題がありそうですね。

今回は、5.1.xを使うということにしたいと思います。ありがとうござい
ました。

ありがとうございました。

</pre>
</div>
<p class="button"><a href="15624.html">[前]</a><a href="15626.html">[次]</a><a href="../list/15601-15700.html">[番号順一覧]</a><a href="../thread/15601-15700.html">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="15623.html">  15623 2011-08-30 20:29 [Etsuo SUMIYA &lt;sumiya] mysql 5.5.9でのset names sjisで性能低下 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="15624.html">  15624 2011-08-31 12:33 ┗[HIRATSUKA Sadao &lt;hir]                                       </a></span>
<span class="current">-&gt;&nbsp;<a href="15625.html">  15625 2011-08-31 18:27 　┗[Etsuo SUMIYA &lt;sumiya]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="15626.html">  15626 2011-09-01 09:50 　　┗[HIRATSUKA Sadao &lt;hir]                                   </a></span>
</pre>
</body>
</html>
