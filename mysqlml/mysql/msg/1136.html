<html><head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:1136</title>
<link rel="stylesheet" type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="1135.html">[前]</a><a href="1137.html">[次]</a><a href="../list/1101-1200.html">[番号順一覧]</a><a href="../thread/1101-1200.html">[スレッド一覧]</a></p>
<p class="id">
mysql:1136
</p>
<div class="header">
<p>
From: &lt;takeshi@xxxxxxxxxx&gt;<br>
Date: Mon, 23 Aug 1999 15:32:52 +0900<br>
Subject: [mysql 01136] Re: インデックス作成のトラブル<br>

</p>
</div>
<div class="body">
<pre>毅です

At Mon, 23 Aug 1999 13:48:29 +0900,
Yutaka Miyahara &lt;yutaka@xxxxxxxxxx&gt; wrote:
<span class="quote1">&gt; </span>
<span class="quote1">&gt; はじめまして。宮原＠富士通と申します。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; 最近mysqlを使い始めたばかりなのですが、インデックスの作成がうまくゆかな</span>
<span class="quote1">&gt; いという問題に遭遇しました。</span>
<span class="quote1">&gt; 300万行程度のテーブルのmediumintのカラムに対してuniqueでないインデックス</span>
<span class="quote1">&gt; を作成しようとしています。</span>
<span class="quote1">&gt; create indexを実行するとsqlプロンプトが戻ってきません。ユーザに対応する</span>
<span class="quote1">&gt; ディレクトリを見ると次の三つのファイルができています。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; A-1.ISD	インデックス作成対象の表と同じサイズ（65MB程度）</span>
<span class="quote1">&gt; A-1.ISM	60MB程度</span>
<span class="quote1">&gt; A-1.frm	8KB程度</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; それぞれのタイムスタンプは、A-1.frmはインデックス作成開始時刻頃、A-1.ISD</span>
<span class="quote1">&gt; は作成開始後3時間程度、A-1.ISMはサイズが変わらないままいつまでも更新され</span>
<span class="quote1">&gt; つづけています。パフォーマンスメーターを見ると、CPUやディスクアクセスは</span>
<span class="quote1">&gt; 数分間隔で鋸歯状のピークを描いています。</span>
<span class="quote1">&gt; これは既知の現象なのでしょうか？また、バッファサイズなどのパラメータを変</span>
<span class="quote1">&gt; 更すれば回避できるのでしょうか？</span>
<span class="quote1">&gt; 情報がありましたら教えてください。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; なお、環境は次のとおりです。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; mysql 3.22.25</span>
<span class="quote1">&gt; Solaris 2.5.1</span>
<span class="quote1">&gt; gcc 2.95で文字コードはujisでコンパイル</span>

MySQL は、 ALTER TABLE を行うとき、一度、今あるテーブルを
まるまる A-数字.* にコピーします。
したがって、ファイルサイズが多いテーブルを alter すると、時間がかかります。
が、たがだか 65M 300万件で、何時間も、っていうのはあまりにも変です
# --tmpdir (通常こんぱいるしたら /tmp) が少ないとか
# disk があまりにも遅いとかメモリがないものだとか
他の手段としては、一度 mysqldump を取っておき、
そのテーブルはダンプ後にリネーム. そして新しく
正しいテーブルを作って入れてみる手があります。

-- 
 村上 毅  takeshi@xxxxxxxxxx

</pre>
</div>
<p class="button"><a href="1135.html">[前]</a><a href="1137.html">[次]</a><a href="../list/1101-1200.html">[番号順一覧]</a><a href="../thread/1101-1200.html">[スレッド一覧]</a></p>
<pre class="list"><span>&nbsp;&nbsp;&nbsp;<a href="1134.html">   1134 1999-08-23 13:48 [Yutaka Miyahara &lt;yut] インデックス作成のトラブル              </a></span>
<span class="current">-&gt;&nbsp;<a href="1136.html">   1136 1999-08-23 15:32 ┣[&lt;takeshi@xxxxxxxxxx&gt;]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="1146.html">   1146 1999-08-24 14:07 ┃┗[Yutaka Miyahara &lt;yut]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="1147.html">   1147 1999-08-24 15:34 ┗[Yuzuru Goto &lt;kn6y-gt]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="1148.html">   1148 1999-08-24 18:23 　┗[&lt;takeshi@xxxxxxxxxx&gt;]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="1150.html">   1150 1999-08-25 10:58 　　┣[Yutaka Miyahara &lt;yut]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="1158.html">   1158 1999-08-26 11:26 　　┗[Yuzuru Goto &lt;kn6y-gt]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="1160.html">   1160 1999-08-26 12:23 　　　┗[&lt;takeshi@xxxxxxxxxx&gt;]                                 </a></span>
</pre>


</body></html>