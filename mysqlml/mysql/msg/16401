<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:16401</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="16400">[前]</a><a href="16402">[次]</a><a href="../list/16401-16500">[番号順一覧]</a><a href="../thread/16401-16500">[スレッド一覧]</a></p>
<p class="id">
mysql:16401
</p>
<div class="header">
<p>
From: aoike &lt;aoike &lt;masahiro.aoike@xxxxxxxxxx&gt;&gt;<br>
Date: Fri, 14 Apr 2017 11:19:43 +0900<br>
Subject: [mysql 16401] Re: [mysql 16400] Re: [mysql 16399] Re: [mysql 16393] [告知] MySQL勉強会 in 大阪(第10回)：4/11(火)<br>

</p>
</div>
<div class="body">
<pre>

あおいけです

CAST使ってやってみました。
バッチリです！！ありがとうございます！！

＃先日の勉強会＠大阪にて「json_unquote使えば出来るのでは…」という話題になりましたので。。


On 2017年04月14日 10:43, yoku ts. wrote:
<span class="quote1">&gt; yoku0825といいます。</span>
<span class="quote1">&gt; もともとの宿題がわからないのですが、JSON型にキャストすると上手くいくのではないでしょうか？</span>
<span class="quote1">&gt; （微妙にカラム名とテーブル名が違うのはご容赦ください）</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; ```</span>
<span class="quote1">&gt; mysql57&gt; SELECT  json_insert(j,'$.authority.DC2',</span>
<span class="quote1">&gt; CAST('{&quot;DC2&quot;:{&quot;rack&quot;:[&quot;A01&quot;]}}' AS JSON)) FROM t;</span>
<span class="quote1">&gt; +------------------------------------------------------------------------------+</span>
<span class="quote2">&gt; | json_insert(j,'$.authority.DC2', CAST('{&quot;DC2&quot;:{&quot;rack&quot;:[&quot;A01&quot;]}}' AS JSON))   |</span>
<span class="quote1">&gt; +------------------------------------------------------------------------------+</span>
<span class="quote2">&gt; | {&quot;authority&quot;: {&quot;DC1&quot;: {&quot;rack&quot;: [&quot;A01&quot;]}, &quot;DC2&quot;: {&quot;DC2&quot;: {&quot;rack&quot;: [&quot;A01&quot;]}}}} |</span>
<span class="quote1">&gt; +------------------------------------------------------------------------------+</span>
<span class="quote1">&gt; 1 row in set (0.00 sec)</span>
<span class="quote1">&gt; ```</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; あってますかね？</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; yoku0825,</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; 2017年4月14日 10:11 aoike &lt;masahiro.aoike@xxxxxxxxxx&gt;:</span>
<span class="quote2">&gt;&gt; 先日はありがとうございました、あおいけです。</span>
<span class="quote2">&gt;&gt;</span>
<span class="quote2">&gt;&gt; 宿題（？）だったJSON型の件です。</span>
<span class="quote2">&gt;&gt; jsonを扱う関数にjson文字列をjsonObjectとして使えないか…という問いに対して</span>
<span class="quote2">&gt;&gt; 「json_extract使えばいいんじゃない？」とのことだったので試してみました。</span>
<span class="quote2">&gt;&gt;</span>
<span class="quote2">&gt;&gt; JSON型のcolumn(authority)がupdate前には</span>
<span class="quote2">&gt;&gt;    {&quot;authority&quot;: {&quot;DC1&quot;: {&quot;rack&quot;: [&quot;A01&quot;]}}}</span>
<span class="quote2">&gt;&gt; となっている状態から</span>
<span class="quote2">&gt;&gt;    {&quot;authority&quot;: {&quot;DC1&quot;: {&quot;rack&quot;: [&quot;A01&quot;]},&quot;DC2&quot;:{&quot;rack&quot;:[&quot;A01&quot;]}}}</span>
<span class="quote2">&gt;&gt; に変更したい（{&quot;DC2&quot;:{&quot;rack&quot;:[&quot;A01&quot;]}}をinsert）ので、json_unquoteにJson文字列を放り込んで</span>
<span class="quote2">&gt;&gt;</span>
<span class="quote2">&gt;&gt; update u_group set authority =</span>
<span class="quote2">&gt;&gt; json_insert(authority,'$.authority.DC2',json_unquote(&quot;{\&quot;DC2\&quot;:{\&quot;rack\&quot;:[\&quot;A01\&quot;]}}&quot;));</span>
<span class="quote2">&gt;&gt;</span>
<span class="quote2">&gt;&gt; とすると</span>
<span class="quote2">&gt;&gt; {&quot;authority&quot;: {&quot;DC1&quot;: {&quot;rack&quot;: [&quot;A01&quot;]},&quot;DC2&quot;:</span>
<span class="quote2">&gt;&gt; &quot;{\&quot;DC2\&quot;:{\&quot;rack\&quot;:[\&quot;A01\&quot;]}}&quot;}}</span>
<span class="quote2">&gt;&gt;</span>
<span class="quote2">&gt;&gt; と文字列扱いされてしまい、NGでした。</span>
<span class="quote2">&gt;&gt;</span>
<span class="quote2">&gt;&gt;</span>



</pre>
</div>
<p class="button"><a href="16400">[前]</a><a href="16402">[次]</a><a href="../list/16401-16500">[番号順一覧]</a><a href="../thread/16401-16500">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="16393">  16393 2017-04-05 18:30 [&quot;YAMASAKI, Yoshiaki&quot;] [告知] MySQL勉強会 in 大阪(第10回)：4/11(火)</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16399">  16399 2017-04-14 10:11 ┗[aoike &lt;masahiro.aoik] Re: [mysql 16393] [告知] MySQL勉強会 in 大阪(第10回)：4/11(火)</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16400">  16400 2017-04-14 10:43 　┗[&quot;yoku ts.&quot; &lt;yoku0825] Re: [mysql 16399] Re: [mysql 16393] [告知] MySQL勉強会 in 大阪(第10回)：4/11(火)</a></span>
<span class="current">-&gt;&nbsp;<a href="16401">  16401 2017-04-14 11:19 　　┗[aoike &lt;masahiro.aoik] Re: [mysql 16400] Re: [mysql 16399] Re: [mysql 16393] [告知] MySQL勉強会 in 大阪(第10回)：4/11(火)</a></span>
</pre>
</body>
</html>
