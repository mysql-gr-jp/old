<html><head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:5925</title>
<link rel="stylesheet" type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="5924.html">[前]</a><a href="5926.html">[次]</a><a href="../list/5901-6000.html">[番号順一覧]</a><a href="../thread/5901-6000.html">[スレッド一覧]</a></p>
<p class="id">
mysql:5925
</p>
<div class="header">
<p>
From: "Yuya.Nishida." &lt;"Yuya.Nishida." &lt;yuya@xxxxxxxxxx&gt;&gt;<br>
Date: Mon, 05 Aug 2002 20:17:29 +0900<br>
Subject: [mysql 05925] Re: 二重登録を防ぐには？<br>

</p>
</div>
<div class="body">
<pre>雄也と申します．

<span class="quote1">&gt; $SQL = "select mail from user_tbl where mail = $email";</span>
ロックをかける
<span class="quote1">&gt; $result = mysql_query($SQL,$ConnectID);</span>
<span class="quote1">&gt; if ($result1 == FALSE){</span>
<span class="quote1">&gt; 	$ErrMSG .= "データの取得に失敗しました&lt;BR&gt;";</span>
<span class="quote1">&gt; }else{</span>
<span class="quote1">&gt; 	if($row = mysql_fetch_array($result)){</span>
<span class="quote1">&gt; 		$ErrMSG .= "すでにこのメールアドレスは登録されています&lt;BR&gt;";</span>
<span class="quote1">&gt; 	}else{</span>
<span class="quote1">&gt; 		$SQL = "insert into user_tbl ....... ";#省略</span>
<span class="quote1">&gt; 		$result = mysql_query($SQL,$ConnectID);</span>
<span class="quote1">&gt; 	}</span>
<span class="quote1">&gt; }</span>
ロックを解除する
<span class="quote1">&gt; しかし、上記のような処理をしても、登録ボタンの連続クリックなどを</span>
<span class="quote1">&gt; された場合に、2重登録されてしまう場合があります。</span>

最初の部分でロックをかけ，
処理が終わってからロックを解除することで解決できます．
<a href="http://www.mysql.gr.jp/jpdoc/3.23.x/manual.ja_Reference.html#LOCK_TABLES">http://www.mysql.gr.jp/jpdoc/3.23.x/manual.ja_Reference.html#LOCK_TABLES</a>
シンプルな解決方法だと思います．

<span class="quote1">&gt; オラクルで開発を行っていたときは、トランザクション処理を</span>
<span class="quote1">&gt; 利用していたのですが、MySQLにはトランザクション処理ないと聞いています。</span>

テーブルによるようです．以下をどうぞ．
<a href="http://www.mysql.gr.jp/jpdoc/3.23.x/manual.ja_Reference.html#COMMIT">http://www.mysql.gr.jp/jpdoc/3.23.x/manual.ja_Reference.html#COMMIT</a>

---
Yuya.Nishida.
yuya@xxxxxxxxxx

</pre>
</div>
<p class="button"><a href="5924.html">[前]</a><a href="5926.html">[次]</a><a href="../list/5901-6000.html">[番号順一覧]</a><a href="../thread/5901-6000.html">[スレッド一覧]</a></p>
<pre class="list"><span>&nbsp;&nbsp;&nbsp;<a href="5924.html">   5924 2002-08-05 19:59 [MAO &lt;mao@xxxxxxxxxx&gt;] 二重登録を防ぐには？                    </a></span>
<span class="current">-&gt;&nbsp;<a href="5925.html">   5925 2002-08-05 20:17 ┗["Yuya.Nishida." &lt;yuy]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="5927.html">   5927 2002-08-06 09:58 　┗[MAO &lt;mao@xxxxxxxxxx&gt;]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="5928.html">   5928 2002-08-06 18:43 　　┗["Hiroaki,Sakuma" &lt;sa]                                   </a></span>
</pre>


</body></html>