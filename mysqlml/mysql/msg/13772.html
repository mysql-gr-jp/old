<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:13772</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="13771.html">[前]</a><a href="13773.html">[次]</a><a href="../list/13701-13800.html">[番号順一覧]</a><a href="../thread/13701-13800.html">[スレッド一覧]</a></p>
<p class="id">
mysql:13772
</p>
<div class="header">
<p>
From: とみたまさひろ &lt;とみたまさひろ &lt;tommy@xxxxxxxxxx&gt;&gt;<br>
Date: Tue, 27 Feb 2007 07:34:49 +0900<br>
Subject: [mysql 13772] Re: 全DBを読み取りロックする方法について<br>

</p>
</div>
<div class="body">
<pre>
とみたです。

On Tue, 27 Feb 2007 02:19:47 +0900
ひら けん &lt;hirai0213@xxxxxxxxxx&gt; wrote:

<span class="quote1">&gt; FLUSH TABLES WITH READ LOCK文を実行する場合は、</span>
<span class="quote1">&gt;    # mysql &lt;DATABASE名&gt;</span>
<span class="quote1">&gt; といったように、あるDBへログインし、RELOAD権限(LOCK TABLESも必要？)があれ</span>
<span class="quote1">&gt; ば、</span>
<span class="quote1">&gt; ログインした&lt;DATABASE名&gt;に関してはLOCKが実行できるということを確認済みなので</span>
<span class="quote1">&gt; すが、</span>
<span class="quote1">&gt; 『すべてのDB(の全テーブル)を読み取りロックする。』</span>
<span class="quote1">&gt; には、どのようにすればよいのでしょうか？</span>

FLUSH TABLES WITH READ LOCK は全DBの全テーブルをロックします。

<span class="quote1">&gt; 当初は、</span>
<span class="quote1">&gt;    # mysql -u root -e &quot;FLUSH TABLES WITH READ LOCK&quot;</span>
<span class="quote1">&gt; と</span>
<span class="quote1">&gt;    # mysql -u root -e &quot;UNLOCK TABLES&quot;</span>
<span class="quote1">&gt; の間にバックアップをとればOKかなと思っていたのですが、</span>
<span class="quote1">&gt; 試したところセッションが切れるようで、実際にはLOCKがかかっておりませんでし</span>
<span class="quote1">&gt; た。</span>

1つ目の mysql コマンドが終了する際にロックも解放されてしまいます。

バックアップを取るためのコマンドが backup.sh としたら、こんな感じでで
きると思います。

# mysql -u root -e 'FLUSH TABLES WITH READ LOCK; system backup.sh; UNLOCK TABLES'

-- 
とみたまさひろ &lt;tommy@xxxxxxxxxx&gt;
3469 42CC 4D32 F53C AD98  65A5 8C37 FF09 69C1 6040

</pre>
</div>
<p class="button"><a href="13771.html">[前]</a><a href="13773.html">[次]</a><a href="../list/13701-13800.html">[番号順一覧]</a><a href="../thread/13701-13800.html">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="13771.html">  13771 2007-02-27 02:19 [ひら けん &lt;hirai0213] 全DBを読み取りロックする方法について    </a></span>
<span class="current">-&gt;&nbsp;<a href="13772.html">  13772 2007-02-27 07:34 ┗[とみたまさひろ &lt;tomm]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13773.html">  13773 2007-02-28 01:16 　┗[ひら けん &lt;hirai0213]                                     </a></span>
</pre>
</body>
</html>
