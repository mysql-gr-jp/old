<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:4940</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="4939">[前]</a><a href="4941">[次]</a><a href="../list/4901-5000">[番号順一覧]</a><a href="../thread/4901-5000">[スレッド一覧]</a></p>
<p class="id">
mysql:4940
</p>
<div class="header">
<p>
From: &lt;mizuki-yamamoto@xxxxxxxxxx&gt;<br>
Date: Thu, 17 Jan 2002 11:50:03 +0900<br>
Subject: [mysql 04940] ＭＹＳＱＬ　Ｃ　ＡＰＩ　「 mysql_use_result 」について<br>

</p>
</div>
<div class="body">
<pre>
私は、山本と申します。

つぎの事象につきまして、どなたかご存知でしたら、教えてください。

状況としては、まずｍｙｓｑｌ_ｒｅａｌ_connectで、２つのコネクションを作成し
ています。
片方のコネクションであるテーブル（ここではＴＡＢＬＥ＿Ａとします）を検索して
います。
そのＴＡＢＬＥ＿ＡはＢＬＯＢ型を含んだ１レコードサイズの大きいもので、クライ
アント処理にするのは
適さないため、検索時、mysql_use_resultを使用してます。
その検索１レコードのカレント行をローカル変数に読み込みその値を変更し、別コネ
クションでそのレコードを
変更した値（ローカル変数から）でＵＰＤＡＴＥをかけるという処理を最終抽出レ
コードまでループする処理です。

この処理を実際に実行してみたところ、ある件数まで（ここでいう件数とは検索条件
にマッチする件数）
はうまくいくのですが、その件数を超えると実行処理自体は正常終了で返してくるの
ですが、実際は
検索されるはずの件数より少ない回数のループで終了してしまうという事象がおきて
しまうのです。

例）上記処理をTABLE_Aから１００件抽出するようなSQLを発行した場合。
        検索される件数・・・１００件、ＵＰＤＡＴＥされる件数・・・１００件
　　上記処理をTABLE_Aから３００００件抽出するようなＳＱＬを発行した場合。
　　　検索される件数・・・２００件、ＵＰＤＡＴＥされる件数・・・２００件
　　　（このとき、ｗｈｉｌｅのｂｒｅａｋ条件として、mysql_fetch_rowがNULLに
なったらという指定をしています）

また、検索条件の正誤確認のためＵＰＤＡＴＥ部分のみコメントアウトして、走らせ
たところ、
正しくループカウンタは３００００を刻んでいました。

mysql_use_resultは同一コネクションでは最終行まで結果を返したあと、
mysql_free_resultにて結果セットを
開放してからでないといけないとありますが、別コネクションを張ったとしても、そ
れに該当するのでしょうか？

ご存知の方いらっしゃいましたら、ご回答よろしくお願いいたします。　


</pre>
</div>
<p class="button"><a href="4939">[前]</a><a href="4941">[次]</a><a href="../list/4901-5000">[番号順一覧]</a><a href="../thread/4901-5000">[スレッド一覧]</a></p>
<pre class="list">
<span class="current">-&gt;&nbsp;<a href="4940">   4940 2002-01-17 11:50 [&lt;mizuki-yamamoto@xxx] ＭＹＳＱＬ　Ｃ　ＡＰＩ　「 mysql_use_result 」について</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="4941">   4941 2002-01-17 14:22 ┗[&quot;goudo&quot; &lt;goudo@xxxxx]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="4944">   4944 2002-01-17 14:52 　┗[&lt;mizuki-yamamoto@xxx]                                     </a></span>
</pre>
</body>
</html>
