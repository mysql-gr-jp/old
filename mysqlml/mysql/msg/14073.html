<html><head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:14073</title>
<link rel="stylesheet" type="text/css" href="/css/w3ml.css">
</head>
<body>
<p class="button"><a href="14072.html">[前]</a><a href="14074.html">[次]</a><a href="../list/14001-14100.html">[番号順一覧]</a><a href="../thread/14001-14100.html">[スレッド一覧]</a></p>
<p class="id">
mysql:14073
</p>
<div class="header">
<p>
From: YuGo &lt;YuGo &lt;yu.gotou@xxxxxxxxxx&gt;&gt;<br>
Date: Fri, 22 Jun 2007 15:13:54 +0900<br>
Subject: [mysql 14073] Re: ビューをWHERE条件付きでSELECTすると遅くなる<br>

</p>
</div>
<div class="body">
<pre>bm2dx.dd@xxxxxxxxxxどの。
C.F2にはインデックスがあるがV.CF2にはインデックスがつけられないので
遅いということはないですか。ためしに下のようなテーブルを作って、
tmp_tbl.CF2にインデックスをつけてみたらどうですか。
CREATE tmp_tbl  SELECT A.F1 AF1, A.F2 AF2, B.F1 BF1, B.F2 BF2,C.F1 CF1,
C.F2 CF2 FROM A LEFT JOIN B ON A.ID = B.ID LEFT JOIN C ON A.ID = ID
WHERE A.F1 = 1 AND B.F1 = 1;

<span class="quote1">&gt; はじめまして、お世話になります。</span>
<span class="quote1">&gt; VIEWの使用で困っています。</span>
<span class="quote1">&gt; あるVIEWを作りました。</span>
<span class="quote1">&gt; 以下のような感じのVIEWです。（説明のために簡略化しています。）</span>
<span class="quote1">&gt; テーブルA, B, C は1万件程度のレコード数です。（A:B = 1:n  A:C = 1:n）</span>

<span class="quote1">&gt; CREATE VIEW V AS</span>
<span class="quote1">&gt; SELECT A.F1 AF1, A.F2 AF2, B.F1 BF1, B.F2 BF2, C.F1 CF1, C.F2 CF2</span>
<span class="quote1">&gt; FROM A</span>
<span class="quote1">&gt; LEFT JOIN B ON A.ID = B.ID</span>
<span class="quote1">&gt; LEFT JOIN C ON A.ID = C.ID</span>
<span class="quote1">&gt; WHERE A.F1 = 1 AND B.F1 = 1;</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; (1) SELECT * FROM V;</span>
<span class="quote1">&gt; を実行すると、0.1秒以下で完了します。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; (2) SELECT * FROM V WHERE CF2 = 1;</span>
<span class="quote1">&gt; を実行したところ、60秒くらいかかってしまいます。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; でも、</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; (3)</span>
<span class="quote1">&gt; SELECT A.F1 AF1, A.F2 AF2, B.F1 BF1, B.F2 BF2, C.F1 CF1, C.F2 CF2</span>
<span class="quote1">&gt; FROM A</span>
<span class="quote1">&gt; LEFT JOIN B ON A.ID = B.ID</span>
<span class="quote1">&gt; LEFT JOIN C ON A.ID = C.ID</span>
<span class="quote1">&gt; WHERE A.F1 = 1 AND B.F1 = 1 AND C.F2 = 1</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; というSELECT文を実行すると0.1秒以下で完了します。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; VIEWにWHERE句を入れると遅くなったりするのでしょうか？</span>
<span class="quote1">&gt; それとも、テーブル構造や結合の仕方でネックになっている部分があるのでしょ </span>
<span class="quote1">&gt; うか。</span>
<span class="quote1">&gt; (2)と(3)で、そんなにコストが変わるとは予想していませんでした。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; OSはFedora Core 6</span>
<span class="quote1">&gt; MySQLは 5.0.41-log Source distribution</span>
<span class="quote1">&gt; を使用しています。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; </span>

</pre>
</div>
<p class="button"><a href="14072.html">[前]</a><a href="14074.html">[次]</a><a href="../list/14001-14100.html">[番号順一覧]</a><a href="../thread/14001-14100.html">[スレッド一覧]</a></p>
<pre class="list"><span>&nbsp;&nbsp;&nbsp;<a href="14072.html">  14072 2007-06-22 12:43 [&lt;bm2dx.dd@xxxxxxxxxx] ビューをWHERE条件付きでSELECTすると遅くなる</a></span>
<span class="current">-&gt;&nbsp;<a href="14073.html">  14073 2007-06-22 15:13 ┗[YuGo &lt;yu.gotou@xxxxx]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14079.html">  14079 2007-06-22 21:22 　┗[hyu-ga &lt;bm2dx.dd@xxx]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14082.html">@ 14082 2007-06-23 09:15 　　┗["Yu Go" &lt;yotarog@xxx]                                   </a></span>
</pre>


</body></html>