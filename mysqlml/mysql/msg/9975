<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:9975</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="9974">[前]</a><a href="9976">[次]</a><a href="../list/9901-10000">[番号順一覧]</a><a href="../thread/9901-10000">[スレッド一覧]</a></p>
<p class="id">
mysql:9975
</p>
<div class="header">
<p>
From: ML account &lt;ML account &lt;ml@xxxxxxxxxx&gt;&gt;<br>
Date: Tue, 10 Aug 2004 09:30:00 +0900<br>
Subject: [mysql 09975] Re: データのロックについて<br>

</p>
</div>
<div class="body">
<pre>
　こんにちは。

&quot;akira&quot; &lt;akrst@xxxxxxxxxx&gt;さんの
&lt;004801c47e24$787ac250$0200a8c0@win2k&gt;
&quot;<a href="09970">[mysql 09970]</a> Re: データのロックについて&quot;


<span class="quote1">&gt; repeatable readは、同一トランザクションにおいて、複数回の</span>
<span class="quote1">&gt; selectコマンドが発行された場合、選択されたレコードが他の</span>
<span class="quote1">&gt; トランザクションの影響を受けない「分離性」です。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; なので、松枝知直さんが提示された以下の例では、</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt;      term1                           | term2</span>
<span class="quote1">&gt;     ---------------------------------+--------------------</span>
<span class="quote1">&gt;      set autocommit=0;               |</span>
<span class="quote2">&gt;                                      | set autocommit=0;</span>
<span class="quote1">&gt;      select * from BBB;              |</span>
<span class="quote2">&gt;                                      | select * from BBB;</span>
<span class="quote1">&gt;      update BBB set ID=2 where ID=1; |</span>
<span class="quote2">&gt;                                      | select * from BBB;</span>
<span class="quote1">&gt;      commit;                         |</span>
<span class="quote2">&gt;                                      | select * from BBB;</span>
<span class="quote1">&gt;      select * from BBB;              |</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; term1でcommitを発行してレコード更新を確定したとしても、</span>
<span class="quote1">&gt; term2のトランザクションは続いたままなので、repeatable r</span>
<span class="quote1">&gt; eadの分離性のために、term2の3つのselectコマンドは全て</span>
<span class="quote1">&gt; 同じ結果になります。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; term2が、term1での更新結果を取り込むには、term2のトラ</span>
<span class="quote1">&gt; ンザクションを終了させる必要があります。(たとえば、commit</span>
<span class="quote1">&gt; コマンドなどで)</span>
<span class="quote1">&gt; とみたまさひろさんが、「..常にイン・トランザクション,,,」といった</span>
<span class="quote1">&gt; のは、こういう意味じゃないでしょうか。</span>

　接続２(term2)がイン・トランザクションであれば、その通りでしょうね。で
も、akiraさんの論理は少々のmissing linkと言うか、飛躍があるのです。接続
２(term2)がイン・トランザクションである事を、証明不要な事実と仮定(じゃな
くて断定、かな？)していませんか？


　今までの話をまとめてみます。<a href="09957">[mysql 09957]</a>に於いて、何故にこの様な事が
起こるのかに付いて、

<span class="quote1">&gt; ・イン・トランザクションであろうがなかろうが、最初のselectでスナップショッ</span>
<span class="quote1">&gt;   トが作られ、それからの読み込みが継続される仕様にMySQLはなっている。</span>
<span class="quote1">&gt;   (REPEATABLE READの説明との齟齬)</span>
<span class="quote1">&gt; ・実はselectクエリでも暗黙のトランザクション開始をしてしまう仕様にMySQL</span>
<span class="quote1">&gt;   はなっている。(SQL92との齟齬)</span>

の２つの可能性を示しました。

　他の可能性、「set autocommit=0でトランザクションが開始される」は、、
<a href="09956">[mysql 09956]</a>の海老原さん、<a href="09959">[mysql 09959]</a>のとみたさんが述べられています。

　結局、

(1) イン・トランザクションであろうがなかろうが、最初のselectでスナップシ
    ョットが作られ、それからの読み込みが継続される仕様にMySQLはなってい
    る。 (REPEATABLE READの説明との齟齬)
　　　　-----&gt;議論無し

(2) 実はselectクエリでも暗黙のトランザクション開始をしてしまう仕様に
    MySQLはなっている。(SQL92との齟齬)
　　　　-----&gt;SQL92との齟齬であるかどうかはひろせさんの回答待ち

(3) set autocommit=0でトランザクションが開始される。
　　　　-----&gt;違うのではないか、が、<a href="09962">[mysql 09962]</a>でのボクの意見

が、現在の状況です。

　akiraさんの意見は、系統的には(2)に属しますね。(2)の記事の流れは、

　　<a href="09955">[mysql 09955]</a>(ひろせさん、ACID特性からも妥当な動作である)
　　　　|
　　<a href="09957">[mysql 09957]</a>(松枝、REPEATABLE READ分離レベルは、イン・トランザクシ
　　　　　　　　　ョンで適用されるべき、ACID特性も同様にイン・トランザク
　　　　　　　　　ションでの事、selectで暗黙のトランザクションが開始され
　　　　　　　　　なければ言及は無意味。MySQLはSQL92に沿わず、selectで暗
　　　　　　　　　黙のトランザクションを開始してしまう可能性の提示。
　　　　｜
　　<a href="09960">[mysql 09960]</a>(ひろせさん、selectでトランザクションが開始される、
　　　　　　　　　SQL92との齟齬は無い)
　　　　|
　　<a href="09962">[mysql 09962]</a>(松枝、全てのselectに付いてトランザクションが開始される
　　　　　　　　　のかが不明。SQL92との齟齬が無いのかは疑問)

です。現時点では、MySQL/InnoDB/REPEATABLE READの動作はイン・トランザクシ
ョンであればそういう動作になる、と言う点で異論は無く、read-opのselectに
よってイン・トランザクションになるかどうか、なるとすればそれが妥当なのか
どうか、が、争点となっています。

　山本さんの<a href="09969">[mysql 09969]</a>は、内容的には<a href="09957">[mysql 09957]</a>と同じでしょうか？そ
れに対するakiraさんの<a href="09970">[mysql 09970]</a>は、ひろせさんの<a href="09955">[mysql 09955]</a>へ戻って
しまったか、あるいは<a href="09962">[mysql 09962]</a>まででまだ決着が付いていない「read-opの
selectによってイン・トランザクションになるかどうか」について「なる」を自
明としての話ですよね。



　　　　松枝知直　　　　&lt;tomom@xxxxxxxxxx&gt;
　　　　　　　　　　　　<a href="http://www.argus.ne.jp/~tomom/">http://www.argus.ne.jp/~tomom/</a>



</pre>
</div>
<p class="button"><a href="9974">[前]</a><a href="9976">[次]</a><a href="../list/9901-10000">[番号順一覧]</a><a href="../thread/9901-10000">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="9940">   9940 2004-08-04 13:17 [&quot;Mamiya Masataka&quot; &lt;x] データのロックについて                  </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9943">   9943 2004-08-05 10:06 ┣[&quot;Mamiya Masataka&quot; &lt;x]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9944">   9944 2004-08-05 10:36 ┗[ML account &lt;ml@xxxxx]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9945">   9945 2004-08-05 11:26 　┣[seiji takegata &lt;take]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9946">   9946 2004-08-05 13:30 　┃┣[ML account &lt;ml@xxxxx]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9949">   9949 2004-08-05 15:24 　┃┃┗[EBIHARA Yuichiro &lt;ui]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9951">   9951 2004-08-05 23:09 　┃┃　┗[ML account &lt;ml@xxxxx]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9952">   9952 2004-08-05 23:19 　┃┃　　┣[&quot;TAKAHASHI, Tomohiro]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9953">   9953 2004-08-06 05:37 　┃┃　　┃┗[ML account &lt;ml@xxxxx]                           </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9954">   9954 2004-08-06 05:51 　┃┃　　┃　┗[ML account &lt;ml@xxxxx]                         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9955">   9955 2004-08-06 11:25 　┃┃　　┃　　┗[&quot;HIROSE, Masaaki&quot; &lt;h]                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9957">   9957 2004-08-06 13:30 　┃┃　　┃　　　┗[ML account &lt;ml@xxxxx]                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9958">   9958 2004-08-06 14:04 　┃┃　　┃　　　　┣[SUGAWARA Hajime &lt;sug]                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9959">   9959 2004-08-06 14:17 　┃┃　　┃　　　　┣[とみたまさひろ &lt;tomm]                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9960">   9960 2004-08-06 16:50 　┃┃　　┃　　　　┗[&quot;HIROSE, Masaaki&quot; &lt;h]                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9962">   9962 2004-08-07 16:49 　┃┃　　┃　　　　　┗[ML account &lt;ml@xxxxx]                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9969">   9969 2004-08-09 18:24 　┃┃　　┃　　　　　　┣[&lt;kuyo@xxxxxxxxxx&gt;   ]               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9970">   9970 2004-08-10 00:20 　┃┃　　┃　　　　　　┃┗[&quot;akira&quot; &lt;akrst@xxxxx]             </a></span>
<span class="current">-&gt;&nbsp;<a href="9975">   9975 2004-08-10 09:30 　┃┃　　┃　　　　　　┃　┗[ML account &lt;ml@xxxxx]           </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9976">   9976 2004-08-10 10:48 　┃┃　　┃　　　　　　┃　　┣[&quot;TAKAHASHI, Tomohiro]         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9997">   9997 2004-08-11 13:03 　┃┃　　┃　　　　　　┃　　┗[&lt;akrst@xxxxxxxxxx&gt;  ]         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9983">   9983 2004-08-10 18:28 　┃┃　　┃　　　　　　┣[とみたまさひろ &lt;tomm]               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9987">   9987 2004-08-10 20:28 　┃┃　　┃　　　　　　┃┗[ML account &lt;ml@xxxxx]             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9988">   9988 2004-08-10 21:26 　┃┃　　┃　　　　　　┃　┣[&lt;kuyo@xxxxxxxxxx&gt;   ]           </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9994">   9994 2004-08-11 11:38 　┃┃　　┃　　　　　　┃　┃┗[ML account &lt;ml@xxxxx]         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10004">  10004 2004-08-12 01:03 　┃┃　　┃　　　　　　┃　┃　┗[Tomoyuki Ishino &lt;ish]       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10006">  10006 2004-08-12 08:54 　┃┃　　┃　　　　　　┃　┃　　┗[ML account &lt;ml@xxxxx]     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10012">  10012 2004-08-13 12:52 　┃┃　　┃　　　　　　┃　┃　　　┗[Tomoyuki Ishino &lt;ish]   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10014">  10014 2004-08-13 20:08 　┃┃　　┃　　　　　　┃　┃　　　　┗[ML account &lt;ml@xxxxx] </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9989">   9989 2004-08-10 23:39 　┃┃　　┃　　　　　　┃　┗[とみたまさひろ &lt;tomm]           </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9992">   9992 2004-08-11 10:54 　┃┃　　┃　　　　　　┃　　┣[&quot;Tomo Ikehara&quot; &lt;tomo]         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9995">   9995 2004-08-11 12:08 　┃┃　　┃　　　　　　┃　　┃┣[&quot;TAKAHASHI, Tomohiro]       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10001">  10001 2004-08-11 16:16 　┃┃　　┃　　　　　　┃　　┃┃┣[&quot;TAKAHASHI, Tomohiro] Re: データのロックについて(余談:START TRANSACTION)</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10003">  10003 2004-08-12 00:51 　┃┃　　┃　　　　　　┃　　┃┃┃┗[とみたまさひろ &lt;tomm]   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10011">  10011 2004-08-13 11:06 　┃┃　　┃　　　　　　┃　　┃┃┗[&quot;Tomo Ikehara&quot; &lt;tomo]     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9999">   9999 2004-08-11 15:40 　┃┃　　┃　　　　　　┃　　┃┗[EBIHARA Yuichiro &lt;ui]       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10017">  10017 2004-08-13 22:42 　┃┃　　┃　　　　　　┃　　┃　┗[&quot;Tomo Ikehara&quot; &lt;tomo]     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9993">   9993 2004-08-11 11:38 　┃┃　　┃　　　　　　┃　　┗[ML account &lt;ml@xxxxx]         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10000">  10000 2004-08-11 15:53 　┃┃　　┃　　　　　　┃　　　┣[EBIHARA Yuichiro &lt;ui]       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10008">  10008 2004-08-12 10:30 　┃┃　　┃　　　　　　┃　　　┃┗[ML account &lt;ml@xxxxx]     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10009">  10009 2004-08-12 11:57 　┃┃　　┃　　　　　　┃　　　┃　┗[&lt;kuyo@xxxxxxxxxx&gt;   ]   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10013">  10013 2004-08-13 20:07 　┃┃　　┃　　　　　　┃　　　┃　　┗[ML account &lt;ml@xxxxx] </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10016">  10016 2004-08-13 22:02 　┃┃　　┃　　　　　　┃　　　┃　　　┣[とみたまさひろ &lt;tomm]   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10018">  10018 2004-08-14 19:58 　┃┃　　┃　　　　　　┃　　　┃　　　┗[&lt;kuyo@xxxxxxxxxx&gt;   ]   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10005">  10005 2004-08-12 01:32 　┃┃　　┃　　　　　　┃　　　┗[とみたまさひろ &lt;tomm]       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="10010">  10010 2004-08-13 01:25 　┃┃　　┃　　　　　　┗[&quot;HIROSE, Masaaki&quot; &lt;h]               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9956">   9956 2004-08-06 11:44 　┃┃　　┗[EBIHARA Yuichiro &lt;ui]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9974">   9974 2004-08-10 09:30 　┃┃　　　┗[ML account &lt;ml@xxxxx]                           </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9982">   9982 2004-08-10 16:41 　┃┃　　　　┗[EBIHARA Yuichiro &lt;ui]                         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9986">   9986 2004-08-10 20:25 　┃┃　　　　　┗[ML account &lt;ml@xxxxx]                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9950">   9950 2004-08-05 16:20 　┃┗[HAMAI Kyoichi &lt;k-ham]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9947">   9947 2004-08-05 13:35 　┗[&quot;Mamiya Masataka&quot; &lt;x]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9948">   9948 2004-08-05 15:03 　　┗[ML account &lt;ml@xxxxx]                                   </a></span>
</pre>
</body>
</html>
