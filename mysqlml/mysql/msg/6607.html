<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:6607</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css.html">
</head>
<body>
<p class="button"><a href="6606.html">[前]</a><a href="6608.html">[次]</a><a href="../list/6601-6700.html">[番号順一覧]</a><a href="../thread/6601-6700.html">[スレッド一覧]</a></p>
<p class="id">
mysql:6607
</p>
<div class="header">
<p>
From: Tomoyuki Ishino &lt;Tomoyuki Ishino &lt;ishino@xxxxxxxxxx&gt;&gt;<br>
Date: Sun, 24 Nov 2002 17:44:50 +0900<br>
Subject: [mysql 06607] Re: MySQL におけるロックについて<br>

</p>
</div>
<div class="body">
<pre>
石野です。こんにちは。

* <a href="06606.html">[mysql 06606]</a> MySQL におけるロックについて
* shogo &lt;sho@xxxxxxxxxx&gt; wrote:

<span class="quote1">&gt; </span>
<span class="quote1">&gt; MySQLのMyISAMテーブルを対戦型ゲームのユーザー情報に使用しています。</span>
<span class="quote1">&gt; 処理としては</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; １．ユーザー情報をSELECTにより取得</span>
<span class="quote1">&gt; ２．対戦相手情報をSELECTにより取得</span>
<span class="quote1">&gt; ３．PHPで対戦処理</span>
<span class="quote1">&gt; ４．ユーザー情報をUPDATE</span>
<span class="quote1">&gt; ５．対戦相手情報をUPDATE</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; という流れになっています。実際には0.1秒以内に終わるような処理なのですが、</span>
<span class="quote1">&gt; 同時に多数のアクセスがあるので、同じレコードに対して複数のスレッドからの</span>
<span class="quote1">&gt; アクセスを想定した場合、UPDATE前のデータをSELECTされては困ります。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; そのため、テーブル（またはレコード）のロックを考えているのですが、</span>
<span class="quote1">&gt; SELECT２回、UPDATE２回という短い処理においてテーブルをロックするのはあまり</span>
<span class="quote1">&gt; 効率的とは思えず、マニュアルを読んでいるのですが良い方法が思いつきません。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; そこでSELECT 〜 FOR UPDATE構文を見つけたのですが、その部分についての</span>
<span class="quote1">&gt; 記述がよく理解できず、結局どのような方法を使えばいいのかがわからずじまいとなっています。</span>
<span class="quote1">&gt; </span>

要件を正確に把握してないですが、MyISAMテーブルでレコードレベルのロックを
実現したいなら、GET_LOCK関数を使われてみてはいかがでしょうか。
<a href="http://www.mysql.gr.jp/jpdoc/3.23.x/manual.ja_Reference.html#Miscellaneous_functions">http://www.mysql.gr.jp/jpdoc/3.23.x/manual.ja_Reference.html#Miscellaneous_functions</a>

select for update はトランザクションをサポートしているテーブルタイプでしか
有効ではないですし、selectに関しては衝突は起こりません。（=読み込みに関しては
ロックされません。）

--
Tomoyuki ISHINO


</pre>
</div>
<p class="button"><a href="6606.html">[前]</a><a href="6608.html">[次]</a><a href="../list/6601-6700.html">[番号順一覧]</a><a href="../thread/6601-6700.html">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="6606.html">   6606 2002-11-24 02:32 [shogo &lt;sho@xxxxxxxxx] MySQL におけるロックについて            </a></span>
<span class="current">-&gt;&nbsp;<a href="6607.html">   6607 2002-11-24 17:44 ┗[Tomoyuki Ishino &lt;ish]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6610.html">   6610 2002-11-24 19:08 　┗[とみたまさひろ &lt;tomm]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6611.html">   6611 2002-11-24 19:57 　　┣[Tomoyuki Ishino &lt;ish]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6625.html">   6625 2002-11-26 19:07 　　┗[shogo &lt;sho@xxxxxxxxx]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6628.html">   6628 2002-11-27 00:07 　　　┗[とみたまさひろ &lt;tomm]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6629.html">   6629 2002-11-27 02:24 　　　　┗[Tomoyuki Ishino &lt;ish]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6630.html">   6630 2002-11-27 03:02 　　　　　┣[とみたまさひろ &lt;tomm]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6631.html">   6631 2002-11-27 15:47 　　　　　┗[遠藤 俊裕 &lt;endo_t@xx]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="6633.html">   6633 2002-11-28 19:38 　　　　　　┗[Takeyuki Miyagawa &lt;m]                           </a></span>
</pre>
</body>
</html>
