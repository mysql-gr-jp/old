<html><body><div style="color:; background-color:; font-family:MS PGothic, sans-serif;font-size:12pt"><div><span>明智重蔵です。<br><br>MySQL8.0でWindow関数を使ったビューは、<br>更新(および削除)不可のようですね。<br>ありがとうございました。<br></span><br><blockquote style="border-left: 2px solid rgb(16, 16, 255); margin-left: 5px; margin-top: 5px; padding-left: 5px;">    <div style="font-family: MS PGothic, sans-serif; font-size: 12pt;">        <div style="font-family: MS PGothic, sans-serif; font-size: 12pt;">            <div dir="ltr">            <font size="2" face="Arial">                ----- Original Message -----<br>                <b><span style="font-weight:bold;">From:</span></b> meiji kimura &lt;meiji.kimura@oracle.com&gt;<br>                <b><span style="font-weight: bold;">To:</span></b> ml@mysql.gr.jp                <br>                <b><span style="font-weight: bold;">Date:</span></b>
 2017/11/4, Sat 13:04<br>                <b><span style="font-weight: bold;">Subject:</span></b> [mysql 16440] Re: MySQL8.0のwindow関数と他DBとの比較結果<br>            </font>            </div>            <br>木村明治です。<br><br>取り急ぎためしてみました。<br><br>(2017/11/04 12:03), <a ymailto="mailto:mysql201706mailing@yahoo.co.jp" href="mailto:mysql201706mailing@yahoo.co.jp" target="_self">mysql201706mailing@yahoo.co.jp</a> wrote:<br>&gt; 明智重蔵です。<br>&gt;<br>&gt; MySQL8.0のWindow関数を他DBと比較してまして、<br>&gt; MySQLエキスパートの皆様に御願いがあります。<br>&gt;<br>&gt; MySQL8.0が動かせる方がおりましたら、<br>&gt; 比較3を、試した結果を書いていただけないでしょうか？<br>&gt;
 (同様の比較をされる方に、有用な情報になると思いますので)<br><br>8.0.3では以下のようにどちらもエラーになります。<br><br>mysql [localhost] {msandbox} (test) &gt;<br>mysql [localhost] {msandbox} (test) &gt; with UpdView as(<br>&nbsp; &nbsp;  -&gt; select Val,Row_Number() over(order by Val) as NewVal<br>&nbsp; &nbsp;  -&gt;&nbsp;  from TestTable)<br>&nbsp; &nbsp;  -&gt; update UpdView set Val = NewVal;<br>ERROR 1288 (HY000): The target table UpdView of the UPDATE is not updatable<br><br>mysql [localhost] {msandbox} (test) &gt;<br>mysql [localhost] {msandbox} (test) &gt; with DelView as(<br>&nbsp; &nbsp;  -&gt; select Row_Number() over(order by Val) as rn<br>&nbsp; &nbsp;  -&gt;&nbsp;  from TestTable)<br>&nbsp; &nbsp;  -&gt; delete from DelView where rn &lt; 3;<br>ERROR 1146 (42S02): Table 'test.DelView' doesn't exist<br><br>&gt;
 ■■■比較1■■■■■■■■■■■■■■■■■■■■■■■■■■■<br>&gt; Oracleで可能な、<br>&gt; Lag,Lead,First_Value,Last_Value,Nth_Valueでのignore nulls<br>&gt;<br>&gt; <a href="https://www.slideshare.net/oysteing/common-table-expressions-cte-window-functions-in-mysql-80" target="_blank">https://www.slideshare.net/oysteing/common-table-expressions-cte-window-functions-in-mysql-80</a><br>&gt; の48ページと49ページによると、MySQL8.0では不可<br>&gt;<br>&gt; ■■■比較2■■■■■■■■■■■■■■■■■■■■■■■■■■■<br>&gt; ソートキーが日付型で、Range指定でのInterVal型の使用<br>&gt;<br>&gt; <a href="https://www.slideshare.net/oysteing/common-table-expressions-cte-window-functions-in-mysql-80" target="_blank">https://www.slideshare.net/oysteing/common-table-expressions-cte-window-functions-in-mysql-80</a><br>&gt;
 の35ページによると、MySQL8.0で可能です<br>&gt;<br>&gt; ■■■比較3■■■■■■■■■■■■■■■■■■■■■■■■■■■<br>&gt; SQLServerで可能な、<br>&gt; Window関数を使用したインラインビューでのUpdateとDelete<br>&gt;<br>&gt; create table TestTable(<br>&gt; Val int unsigned);<br>&gt;<br>&gt; insert into TestTable values<br>&gt; (1),(3),(5),(10),(20),(30),(40);<br>&gt;<br>&gt; with UpdView as(<br>&gt; select Val,Row_Number() over(order by Val) as NewVal<br>&gt;&nbsp; &nbsp; from TestTable)<br>&gt; update UpdView set Val = NewVal;<br>&gt;<br>&gt; with DelView as(<br>&gt; select Row_Number() over(order by Val) as rn<br>&gt;&nbsp; &nbsp; from TestTable)<br>&gt; delete from DelView where rn &lt; 3;<br>&gt;<br>&gt; <a href="https://www.slideshare.net/oysteing/mysql-80-common-table-expressions-71760102"
 target="_blank">https://www.slideshare.net/oysteing/mysql-80-common-table-expressions-71760102</a><br>&gt; の5ページに書いてある構文です。<br>&gt;<br>&gt; <a href="https://dev.mysql.com/doc/refman/8.0/en/view-updatability.html" target="_blank">https://dev.mysql.com/doc/refman/8.0/en/view-updatability.html</a><br>&gt; にWindow関数を使うと更新(および削除)不可と書いてないので<br>&gt; 更新(および削除)可能と予想してます。<br><br>上記のとおりです。ちなみにFirebird 3.0の場合は、そもそもCTEがselectのみ <br>の対応なので、当然エラーになります。(token select 以外は×)<br><br>create table TestTable(Val int);<br><br>insert into TestTable values(1);<br>insert into TestTable values(3);<br>insert into TestTable values(5);<br>insert into TestTable values(10);<br>insert into TestTable values(20);<br>insert into TestTable values(30);<br>insert into TestTable
 values(40);<br><br>commit;<br>SQL&gt; with UpdView as(<br>CON&gt; select Val,Row_Number() over(order by Val) as NewVal<br>CON&gt;&nbsp;  from TestTable)<br>CON&gt; update UpdView set Val = NewVal;<br>Statement failed, SQLSTATE = 42000<br>Dynamic SQL Error<br>-SQL error code = -104<br>-Token unknown - line 4, column 1<br>-update<br>SQL&gt;<br>SQL&gt; with DelView as(<br>CON&gt; select Row_Number() over(order by Val) as rn<br>CON&gt;&nbsp;  from TestTable)<br>CON&gt; delete from DelView where rn &lt; 3;<br>Statement failed, SQLSTATE = 42000<br>Dynamic SQL Error<br>-SQL error code = -104<br>-Token unknown - line 4, column 1<br>-delete<br><br>        </div>    </div>    </blockquote></div>    </div></body></html>
