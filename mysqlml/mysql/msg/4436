<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:4436</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="4435">[前]</a><a href="4437">[次]</a><a href="../list/4401-4500">[番号順一覧]</a><a href="../thread/4401-4500">[スレッド一覧]</a></p>
<p class="id">
mysql:4436
</p>
<div class="header">
<p>
From: Takeharu Masuda &lt;Takeharu Masuda &lt;tac@xxxxxxxxxx&gt;&gt;<br>
Date: Fri, 05 Oct 2001 17:45:28 +0900<br>
Subject: [mysql 04436] テーブルの差し替えとロック<br>

</p>
</div>
<div class="body">
<pre>
　定期的にバッチで内容を更新する、サマリーテーブル tbl_A があります。
　更新のロジックの関係で、データを全部破棄して作り直す必要があります。
　テーブル再構築中に使えないと困るため、次のようなロジックを考えています。

1. tbl_A と同一構造を持つ tbl_B を作成
2. tbl_B に、最新のデータでサマリーを作成
3. tbl_A を削除（ drop table tbl_A）
4. tbl_B を tbl_A にリネーム（ rename table tbl_B to tbl_A ）

　3. および 4. を実行している最中に、他からのアクセスを禁止するため、テー
ブルをロックしたいのです。

　この場合、 LOCK TABLES 〜 UNLOCK TABLES は使用可能でしょうか？

　仮に LOCK TABLES tbl_A WRITE としても、ロック処理中にそのテーブルその
ものが消えるので、ここでロックが解除されることになってしまうような気がし
ます。直後に rename table するとしても、その瞬間だけはアクセスが可能になっ
て、クライアントに「テーブルがない」と判断されてしまいます。
　まあ、クライアント側でエラーチェックして、テーブルがない（＝SQL エラー
になる）ときにはちょっと待って再実行すればいいことではあるのですが。

-- 
written by Takeharu Masuda &lt;tac@xxxxxxxxxx&gt;
with Thinkpad 235 - called &quot;Chandra II&quot; / &quot;Clavius&quot;
at 2001/10/05 17:34:12


</pre>
</div>
<p class="button"><a href="4435">[前]</a><a href="4437">[次]</a><a href="../list/4401-4500">[番号順一覧]</a><a href="../thread/4401-4500">[スレッド一覧]</a></p>
<pre class="list">
<span class="current">-&gt;&nbsp;<a href="4436">   4436 2001-10-05 17:45 [Takeharu Masuda &lt;tac] テーブルの差し替えとロック              </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="4440">   4440 2001-10-05 19:54 ┗[YONEMOTO Kazumasa &lt;y]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="4445">   4445 2001-10-06 00:48 　┗[Takeharu Masuda &lt;tac]                                     </a></span>
</pre>
</body>
</html>
