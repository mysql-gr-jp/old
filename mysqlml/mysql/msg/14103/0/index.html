<HTML><BODY style="word-wrap: break-word; -khtml-nbsp-mode: space; -khtml-line-break: after-white-space; "><DIV>久光です</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV><BR class="khtml-block-placeholder"></DIV><BR><DIV><BLOCKQUOTE type="cite"><DIV>(2)count関数中にcase式を入れて、一度で複数の日付の範囲を集計できるようにしま</DIV><DIV>す。</DIV></BLOCKQUOTE><BR><BLOCKQUOTE type="cite"><DIV>count(case when dt between '2007-03-01 00:00:00' and '2007-03-31 23:59:59' then 1 else null end) as a1,</DIV></BLOCKQUOTE><BR><BLOCKQUOTE type="cite"><DIV>from material left join log_mate on material.id=log_mate.mate_id</DIV><DIV>and dt between '2007-1-31 0:0:0' and '2007-7-31 23:59:59' group by id,name order by id,name ;</DIV></BLOCKQUOTE><BR></DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>・CASEを使って条件に合うものを別個に集計する方法</DIV><DIV>・FROMの中に日付の絞り込みも入れてしまう方法</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>　CASEはここで使えることが思いつかなかったです。言われてみれば使えま</DIV><DIV>すねコレが。FROMにいたってはこんな形で絞り込む条件が入れられるとは知</DIV><DIV>りませんでした。</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>　で、さっそく試してみたのですが、3時間ほど計算しても実行結果が返っ</DIV><DIV>てこなかったです。SQL文が間違ってたのかと思い、あれやこれや試したん</DIV><DIV>ですが全然実行結果が返ってこず。</DIV><DIV>　ログファイルが大きすぎるのかもしれないと思って、79万行あるデータを</DIV><DIV>今年の6月30日〜7月1日の2日間だけの2600行に減らして、さらにSQL文を下</DIV><DIV>記のように単純にしたところ</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>SELECT</DIV><DIV> material.id,</DIV><DIV> COUNT( </DIV><DIV> CASE WHEN log_mate.datetime</DIV><DIV> BETWEEN '2007-06-30 00:00:00'</DIV><DIV> AND '2007-06-30 23:59:59'</DIV><DIV> THEN 1 </DIV><DIV> ELSE NULL </DIV><DIV> END ) AS a1</DIV><DIV>FROM material</DIV><DIV> LEFT JOIN log_mate ON material.id = log_mate.mate_id</DIV><DIV> AND test.datetime</DIV><DIV> BETWEEN '2007-6-29 0:0:0'</DIV><DIV> AND '2007-7-1 23:59:59'</DIV><DIV>GROUP BY material.id</DIV><DIV>ORDER BY material.id</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>　130秒くらいでようやく実行結果が返ってきました。結果は私が欲しがっ</DIV><DIV>ていたとおり、利用がなければ「0」が返ってくる部品一覧表になっていま</DIV><DIV>した。すごいです。ありがとうございました。</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>　こんどの問題は実行時間が非常に長い点です。自分のパソコン（CoreDuo </DIV><DIV>2GHz）の処理能力がひどく劣っているとも思えないし、でもSQL文はちゃん</DIV><DIV>と動作することがわかったので、まずは気長に一晩くらい回しっぱなしにし</DIV><DIV>てみます。EXCELにペタペタ貼付けてエッサホッサと行のずれを揃える仕事</DIV><DIV>を考えれば、一晩ほっといて結果一覧がでる方がかなり効率的なので。</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>　あとはSQL一発ってわけにはいかないけどテンポラリー・テーブルを組み</DIV><DIV>合わせる方法も現実的な速度でPHPを使わずに一覧表が作れるかもしれない</DIV><DIV>と考えてます。</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>　なんにせよおかげさまで進歩しました。ありがとうございます。</DIV><DIV><BR class="khtml-block-placeholder"></DIV><BR><DIV> <SPAN class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Hiragino Maru Gothic Pro; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><DIV style="font-family: Hiragino Kaku Gothic Pro; "><SPAN class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; ">=================================</SPAN></DIV><DIV style="font-family: Hiragino Kaku Gothic Pro; "><SPAN class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; ">==    HISAMITSU ISSEI    ==</SPAN></DIV><DIV style="font-family: Hiragino Kaku Gothic Pro; "><SPAN class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; ">== <A href="mailto:DS1I-HSMT@asahi-net.or.jp">DS1I-HSMT@asahi-net.or.jp</A> ==</SPAN></DIV><DIV style="font-family: Hiragino Kaku Gothic Pro; "><SPAN class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; "><A href="http://www.ne.jp/asahi/pro/his/">http://www.ne.jp/asahi/pro/his/</A></SPAN></DIV><DIV style="font-family: Hiragino Kaku Gothic Pro; "><SPAN class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; ">=================================</SPAN></DIV><BR class="Apple-interchange-newline"></SPAN> </DIV><BR></BODY></HTML>
