<html><head></head><body style="word-wrap: break-word; -khtml-nbsp-mode: space; -khtml-line-break: after-white-space; "><div>久光です</div><div><br class="khtml-block-placeholder"></div><div><br class="khtml-block-placeholder"></div><br><div><blockquote type="cite"><div>(2)count関数中にcase式を入れて、一度で複数の日付の範囲を集計できるようにしま</div><div>す。</div></blockquote><br><blockquote type="cite"><div>count(case when dt between '2007-03-01 00:00:00' and '2007-03-31 23:59:59' then 1 else null end) as a1,</div></blockquote><br><blockquote type="cite"><div>from material left join log_mate on material.id=log_mate.mate_id</div><div>and dt between '2007-1-31 0:0:0' and '2007-7-31 23:59:59' group by id,name order by id,name ;</div></blockquote><br></div><div><br class="khtml-block-placeholder"></div><div>・CASEを使って条件に合うものを別個に集計する方法</div><div>・FROMの中に日付の絞り込みも入れてしまう方法</div><div><br class="khtml-block-placeholder"></div><div>　CASEはここで使えることが思いつかなかったです。言われてみれば使えま</div><div>すねコレが。FROMにいたってはこんな形で絞り込む条件が入れられるとは知</div><div>りませんでした。</div><div><br class="khtml-block-placeholder"></div><div>　で、さっそく試してみたのですが、3時間ほど計算しても実行結果が返っ</div><div>てこなかったです。SQL文が間違ってたのかと思い、あれやこれや試したん</div><div>ですが全然実行結果が返ってこず。</div><div>　ログファイルが大きすぎるのかもしれないと思って、79万行あるデータを</div><div>今年の6月30日～7月1日の2日間だけの2600行に減らして、さらにSQL文を下</div><div>記のように単純にしたところ</div><div><br class="khtml-block-placeholder"></div><div>SELECT</div><div> material.id,</div><div> COUNT( </div><div> CASE WHEN log_mate.datetime</div><div> BETWEEN '2007-06-30 00:00:00'</div><div> AND '2007-06-30 23:59:59'</div><div> THEN 1 </div><div> ELSE NULL </div><div> END ) AS a1</div><div>FROM material</div><div> LEFT JOIN log_mate ON material.id = log_mate.mate_id</div><div> AND test.datetime</div><div> BETWEEN '2007-6-29 0:0:0'</div><div> AND '2007-7-1 23:59:59'</div><div>GROUP BY material.id</div><div>ORDER BY material.id</div><div><br class="khtml-block-placeholder"></div><div>　130秒くらいでようやく実行結果が返ってきました。結果は私が欲しがっ</div><div>ていたとおり、利用がなければ「0」が返ってくる部品一覧表になっていま</div><div>した。すごいです。ありがとうございました。</div><div><br class="khtml-block-placeholder"></div><div>　こんどの問題は実行時間が非常に長い点です。自分のパソコン（CoreDuo </div><div>2GHz）の処理能力がひどく劣っているとも思えないし、でもSQL文はちゃん</div><div>と動作することがわかったので、まずは気長に一晩くらい回しっぱなしにし</div><div>てみます。EXCELにペタペタ貼付けてエッサホッサと行のずれを揃える仕事</div><div>を考えれば、一晩ほっといて結果一覧がでる方がかなり効率的なので。</div><div><br class="khtml-block-placeholder"></div><div>　あとはSQL一発ってわけにはいかないけどテンポラリー・テーブルを組み</div><div>合わせる方法も現実的な速度でPHPを使わずに一覧表が作れるかもしれない</div><div>と考えてます。</div><div><br class="khtml-block-placeholder"></div><div>　なんにせよおかげさまで進歩しました。ありがとうございます。</div><div><br class="khtml-block-placeholder"></div><br><div> <span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Hiragino Maru Gothic Pro; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><div style="font-family: Hiragino Kaku Gothic Pro; "><span class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; ">=================================</span></div><div style="font-family: Hiragino Kaku Gothic Pro; "><span class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; ">==    HISAMITSU ISSEI    ==</span></div><div style="font-family: Hiragino Kaku Gothic Pro; "><span class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; ">== <a href="mailto:DS1I-HSMT@asahi-net.or.jp">DS1I-HSMT@asahi-net.or.jp</a> ==</span></div><div style="font-family: Hiragino Kaku Gothic Pro; "><span class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; "><a href="http://www.ne.jp/asahi/pro/his/">http://www.ne.jp/asahi/pro/his/</a></span></div><div style="font-family: Hiragino Kaku Gothic Pro; "><span class="Apple-style-span" style="font-family: Hiragino Kaku Gothic Pro; ">=================================</span></div><br class="Apple-interchange-newline"></span> </div><br>
</body></html>