<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:5924</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css.html">
</head>
<body>
<p class="button"><a href="5923.html">[前]</a><a href="5925.html">[次]</a><a href="../list/5901-6000.html">[番号順一覧]</a><a href="../thread/5901-6000.html">[スレッド一覧]</a></p>
<p class="id">
mysql:5924
</p>
<div class="header">
<p>
From: MAO &lt;MAO &lt;mao@xxxxxxxxxx&gt;&gt;<br>
Date: Mon, 05 Aug 2002 19:59:19 +0900<br>
Subject: [mysql 05924] 二重登録を防ぐには？<br>

</p>
</div>
<div class="body">
<pre>
こんにちは、maoと申します。

現在、ユーザ登録のDBをPHP4.2.2＋MySQL3.22.32にて開発しております。

ユーザを登録する際に、
メールアドレスで判断をして、すでに登録されているユーザの場合は
登録させないように下記のように処理をしております。


$SQL = &quot;select mail from user_tbl where mail = $email&quot;;
$result = mysql_query($SQL,$ConnectID);
if ($result1 == FALSE){
	$ErrMSG .= &quot;データの取得に失敗しました&lt;BR&gt;&quot;;
}else{
	if($row = mysql_fetch_array($result)){
		$ErrMSG .= &quot;すでにこのメールアドレスは登録されています&lt;BR&gt;&quot;;
	}else{
		$SQL = &quot;insert into user_tbl ....... &quot;;#省略
		$result = mysql_query($SQL,$ConnectID);
	}
}

しかし、上記のような処理をしても、登録ボタンの連続クリックなどを
された場合に、2重登録されてしまう場合があります。

オラクルで開発を行っていたときは、トランザクション処理を
利用していたのですが、MySQLにはトランザクション処理ないと聞いています。

皆様はどのようにして対応されているのでしょうか？

Maxを使えばトランザクション処理ができる事は調べましたが、
すでにMySQLがインストールされた環境のため、
MySQLの利用が必須になっています。

現在JavaScriptで連続登録ができないようにはしていますが
ユーザ環境により完璧ではありません。
また、UNIQUE (mail)も検討はしていますが、
insert時にSQLのエラーを返すのではなく、
insert前に処理をしたいとおもっております。

以上、よろしくおねがいいたします。

mao[mao@xxxxxxxxxx]



</pre>
</div>
<p class="button"><a href="5923.html">[前]</a><a href="5925.html">[次]</a><a href="../list/5901-6000.html">[番号順一覧]</a><a href="../thread/5901-6000.html">[スレッド一覧]</a></p>
<pre class="list">
<span class="current">-&gt;&nbsp;<a href="5924.html">   5924 2002-08-05 19:59 [MAO &lt;mao@xxxxxxxxxx&gt;] 二重登録を防ぐには？                    </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="5925.html">   5925 2002-08-05 20:17 ┗[&quot;Yuya.Nishida.&quot; &lt;yuy]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="5927.html">   5927 2002-08-06 09:58 　┗[MAO &lt;mao@xxxxxxxxxx&gt;]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="5928.html">   5928 2002-08-06 18:43 　　┗[&quot;Hiroaki,Sakuma&quot; &lt;sa]                                   </a></span>
</pre>
</body>
</html>
