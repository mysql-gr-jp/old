<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:2437</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="2436.html">[前]</a><a href="2438.html">[次]</a><a href="../list/2401-2500.html">[番号順一覧]</a><a href="../thread/2401-2500.html">[スレッド一覧]</a></p>
<p class="id">
mysql:2437
</p>
<div class="header">
<p>
From: takano masaki &lt;takano masaki &lt;mtakano@xxxxxxxxxx&gt;&gt;<br>
Date: Fri, 01 Sep 2000 08:58:08 +0900<br>
Subject: [mysql 02437] レプリケーション / スレッド固まる？<br>

</p>
</div>
<div class="body">
<pre>
高野 真樹と申します。

現在、MySQLのレプリケーション評価中です。

評価内容：
 1) ３台のホストがあります。
    日本の１つのセグメントに２台、米国に１台あり、日本の１台を
    マスタDBとし、他をスレーブにしています。
 3) 日本・米国間は直接インターネット経由です。VPNや専用線では
    ありません。
 4) 5分に１回、マスタの１レコードを更新します。
    更新の10秒後、マスタDBとスレーブDBを比較し、差異があるか、
    検出します。

で、肝心の評価結果ですが・・・
 1) 今日まで３日くらいやってます。
 2) 同じセグメント内のマスタ＆スレーブは今のところまったく問題
    なし。
    セッション(ネットワーク)が切れてもちゃんと再接続しにいく。
 3) 米国に置いたサーバは、スレーブ用のスレッドがだんまりになる
    率が高い。 1日2回くらい。
    だんまりの内容は下記の通り。
     a) レプリケートされない。
     b) エラーメッセージをいっさい出さない。
     c) stop-slave,stop-slave,start-slave すると、レプリケートが
        再開され、データはちゃんと同じになる。
    たぶん、レプリケーション用のスレッドがどこかでデッドロック
    してるか、ループしてる。

マスタとのセッションが切れると、検出はしてる。
たとえば、下記のログ。
000831 11:17:27  Slave thread: error connecting to slave:Lost
 connection to MySQL server during query,retry in 60 sec

気になるのが下記のログ。
ただし、発生した時間的に考えて「だんまり」とは関連なさそう。
000901  5:48:39  Error reading packet from server: Lost
 connection to MySQL server during query (107)

どこでスレーブスレッドが停止してるのか・・・
わかれば直すんだけど。
gdbでできるかなあ。

みなさんのご意見をお聞かせいただけると幸いです。

</pre>
</div>
<p class="button"><a href="2436.html">[前]</a><a href="2438.html">[次]</a><a href="../list/2401-2500.html">[番号順一覧]</a><a href="../thread/2401-2500.html">[スレッド一覧]</a></p>
<pre class="list">
<span class="current">-&gt;&nbsp;<a href="2437.html">   2437 2000-09-01 08:58 [takano masaki &lt;mtaka] レプリケーション / スレッド固まる？     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="2438.html">   2438 2000-09-01 09:03 ┗[takano masaki &lt;mtaka]                                       </a></span>
</pre>
</body>
</html>
