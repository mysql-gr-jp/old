<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:13974</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="13973">[前]</a><a href="13975">[次]</a><a href="../list/13901-14000">[番号順一覧]</a><a href="../thread/13901-14000">[スレッド一覧]</a></p>
<p class="id">
mysql:13974
</p>
<div class="header">
<p>
From: Hiroki Tamakoshi &lt;Hiroki Tamakoshi &lt;hiroki.tamakoshi@xxxxxxxxxx&gt;&gt;<br>
Date: Tue, 22 May 2007 14:54:17 +0900<br>
Subject: [mysql 13974] Re: 高速なデータの書き込み方法<br>

</p>
</div>
<div class="body">
<pre>
玉越です。

On Tue, 22 May 2007 11:46:26 +0900
HIRATSUKA Sadao &lt;hiratsuka.sadao@xxxxxxxxxx&gt; wrote:

<span class="quote1">&gt; 平塚です。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; On Mon, 21 May 2007 10:26:30 +0900</span>
<span class="quote1">&gt; Hiroki Tamakoshi &lt;hiroki.tamakoshi@xxxxxxxxxx&gt; wrote:</span>
<span class="quote1">&gt; </span>
<span class="quote3">&gt; &gt; &gt; I/Oも少しは出ていますが、こちらの環境ではほぼCPUネックです。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; という点が少し分かりかねますが、これは書き込みの時間ではなくCPU処理時間</span>
<span class="quote2">&gt; &gt; の差でしょうか？</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; こちらでは、書き込み時間が殆どを占めています。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; usr 99%、sys 1%、wait 0%、idle 0%という感じでI/O時間はほとんどないです。</span>
<span class="quote1">&gt; ただ、こちらのテストデータは数十MBと小さいせいもあると思います。</span>

こちらですと通常状態でwaitが数十％、データを一気に書き込むともっと上昇し
ます。
（load averageが7などになります）

<span class="quote1">&gt; ・ON DUPLICATE KEYがO(n^2)で時間がかかる点</span>
<span class="quote1">&gt; ・ストレージがwrite throughになっていた点＆RAID 5な点</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; write backキャッシュで解決するとよいのですが、</span>
<span class="quote1">&gt; 他にも原因があるのかもしれないですね。</span>

write backキャッシュのおかげで少しだけ速くなったようです。
あと考えられるのは、indexの再構築に時間が掛かっているのではないかと考え
ています。

テーブルのサイズは大きいもので15GBになっていて、半分がindexです。
マルチカラムインデックスを使っているのですが、カーディナリティの大きさに
よってはマルチカラムインデックスを作るときのカラムの順番に気を付ける方が
よいとどこかに書いてありました。

そういったことも関係するでしょうか？


--
株式会社ビービット　玉越 大輝
ユーザビリティ コンサルタント
beBit,Inc. Tamakoshi Hiroki hiroki.tamakoshi@xxxxxxxxxx
--------------------------------------------------------
〒105-0001 東京都港区虎ノ門1-18-1 虎ノ門10森ビル7F
TEL: 03-3509-7602 / FAX: 03-3509-7605
URL: <a href="http://www.bebit.co.jp/">http://www.bebit.co.jp/</a>
--------------------------------------------------------
◆◆◆お知らせ◆◆◆
・ビービット新刊書籍 『ユーザ中心ウェブサイト戦略』発売
  <a href="http://www.bebit.co.jp/news/2006/book.html">http://www.bebit.co.jp/news/2006/book.html</a>
  <a href="http://www.amazon.co.jp/gp/product/4797333529/">http://www.amazon.co.jp/gp/product/4797333529/</a>


</pre>
</div>
<p class="button"><a href="13973">[前]</a><a href="13975">[次]</a><a href="../list/13901-14000">[番号順一覧]</a><a href="../thread/13901-14000">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="13957">  13957 2007-05-17 21:01 [Hiroki Tamakoshi &lt;hi] 高速なデータの書き込み方法              </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13958">  13958 2007-05-17 23:20 ┗[&quot;Yoshio Kawano&quot; &lt;kaw]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13959">  13959 2007-05-18 13:02 　┗[Hiroki Tamakoshi &lt;hi]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13960">  13960 2007-05-18 13:33 　　┣[HIRATSUKA Sadao &lt;hir]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13971">  13971 2007-05-21 10:26 　　┃┗[Hiroki Tamakoshi &lt;hi]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13973">  13973 2007-05-22 11:46 　　┃　┗[HIRATSUKA Sadao &lt;hir]                               </a></span>
<span class="current">-&gt;&nbsp;<a href="13974">  13974 2007-05-22 14:54 　　┃　　┗[Hiroki Tamakoshi &lt;hi]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14007">  14007 2007-05-25 11:08 　　┃　　　┗[Hiroki Tamakoshi &lt;hi]                           </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14008">  14008 2007-05-25 11:15 　　┃　　　　┣[&lt;ml@xxxxxxxxxx&gt;     ]                         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14009">  14009 2007-05-25 11:33 　　┃　　　　┃┗[Hiroki Tamakoshi &lt;hi]                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14010">  14010 2007-05-25 14:10 　　┃　　　　┃　┗[&quot;橋本健太&quot; &lt;kem@xxxx]                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14022">  14022 2007-05-28 00:51 　　┃　　　　┗[とみたまさひろ &lt;tomm]                         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14023">  14023 2007-05-28 12:17 　　┃　　　　　┗[Hiroki Tamakoshi &lt;hi]                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="14024">  14024 2007-05-28 14:48 　　┃　　　　　　┗[&quot;KIMURA, Meiji&quot; &lt;kim]                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13961">  13961 2007-05-19 00:13 　　┗[とみたまさひろ &lt;tomm]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13962">  13962 2007-05-19 11:05 　　　┗[坂井 英夫 &lt;hide_s@xx] データベースをRAID5に置く       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13963">  13963 2007-05-19 12:13 　　　　┣[とみたまさひろ &lt;tomm]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13964">  13964 2007-05-19 12:41 　　　　┃┗[坂井 英夫 &lt;hide_s@xx]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13965">  13965 2007-05-19 13:15 　　　　┣[kurokawa &lt;ml@xxxxxxx]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13966">  13966 2007-05-19 13:57 　　　　┃┗[ひでさん &lt;hide_s@xxx]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13967">  13967 2007-05-19 14:14 　　　　┃　┗[N.Toge &lt;toge@xxxxxxx]                           </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13968">  13968 2007-05-19 15:10 　　　　┃　　┗[ひでさん &lt;hide_s@xxx]                         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13969">  13969 2007-05-20 06:58 　　　　┗[Kenji Irie &lt;kenji@xx]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13970">  13970 2007-05-20 09:31 　　　　　┗[ひでさん &lt;hide_s@xxx]                             </a></span>
</pre>
</body>
</html>
