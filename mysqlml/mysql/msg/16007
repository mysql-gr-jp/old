<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:16007</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="16006">[前]</a><a href="16008">[次]</a><a href="../list/16001-16100">[番号順一覧]</a><a href="../thread/16001-16100">[スレッド一覧]</a></p>
<p class="id">
mysql:16007
</p>
<div class="header">
<p>
From: ayako hiroe &lt;ayako hiroe &lt;roeaya03@xxxxxxxxxx&gt;&gt;<br>
Date: Tue, 30 Jul 2013 14:25:19 +0900<br>
Subject: [mysql 16007] 数百万件のload data  infileの繰り返し中にmysqldがハング<br>

</p>
</div>
<div class="body">
<pre>
お世話になります。
広江彩子と申します。

サーバー移行のため数億件のレストアテストをしております。
３００万件ずつのtab区切りプレインテキストのダンプを
バッチで何度もload infeを繰りかえしているうちmysqldが突然ハングします。

ハングの具体的な現象は
・load中のCPU使用率からすると突然それが下がる
・mysql関連のコマンドがすべてハング（killするしかない）
・mysqladmin shutdownもハング
・mysqldのスクリプトを実行してもハング

上記のような状態になると結局killallなどするしかありません。
エラーログはハングの時点では何も吐いていません。
killallでmysqldのプロセスを停止するので、システムをリブートしてmysqld startするときに
リカバリ・ロールバックプロセスががんがん走るのをエラーログが吐いているようになります。

バッチをまわし始めるとだんだん使用メモリが増え、しばらくするとスワップが発生します。
それが原因かもわかりません。
innodb使用です。

何かお気づきの方がおられましたら
ご教授いただけますと幸いです。



OS:
Linux CentOS release6.4

MySQL：
MySQL 5.5.32 Remi

ロケール：
utf8

my.cnf

[mysqld]
innodb_file_per_table
back_log = 50
max_connections = 500
max_connect_errors = 10
table_open_cache = 2048
max_allowed_packet = 16M
binlog_cache_size = 1M
max_heap_table_size = 64M
read_buffer_size = 512M
read_rnd_buffer_size = 1M
ted per thread if sort is needed.
sort_buffer_size = 8M
join_buffer_size = 8M
thread_cache_size = 180
thread_concurrency = 8
query_cache_size = 64M
query_cache_limit = 2M

ft_min_word_len = 4

default-storage-engine = InnoDB
thread_stack = 192K
transaction_isolation = REPEATABLE-READ
tmp_table_size = 64M

binlog_format=mixed
slow_query_log
log-error=/var/log/myerror.log
log-warnings=1
long_query_time = 120
key_buffer_size = 32M
bulk_insert_buffer_size = 64M
myisam_sort_buffer_size = 128M
myisam_max_sort_file_size = 10G
myisam_repair_threads = 1

myisam_recover
innodb_io_capacity=2000
innodb_additional_mem_pool_size = 16M
innodb_buffer_pool_size = 19G

innodb_data_file_path = ibdata1:10M:autoextend
innodb_write_io_threads = 8
innodb_read_io_threads = 8
innodb_thread_concurrency = 16

innodb_flush_log_at_trx_commit = 1
innodb_log_buffer_size = 8M

innodb_log_file_size = 1G
innodb_log_files_in_group = 3

innodb_max_dirty_pages_pct = 90
innodb_lock_wait_timeout = 120


[mysqldump]
quick

max_allowed_packet = 16M
default-character-set=utf8

[mysql]
no-auto-rehash

# Only allow UPDATEs and DELETEs that use keys.
#safe-updates
default-character-set=utf8

[myisamchk]
key_buffer_size = 512M
sort_buffer_size = 512M
read_buffer = 8M
write_buffer = 8M

[mysqlhotcopy]
interactive-timeout

[mysqld_safe]
open-files-limit = 8192


</pre>
</div>
<div class="attach">
<h3 class="attachtitle">添付ファイル</h3>
<ul>
<li><a href="http://www.mysql.gr.jp/mysqlml/mysql/msg/16007/0/"> [text/html]</a>
</ul>
</div>
<p class="button"><a href="16006">[前]</a><a href="16008">[次]</a><a href="../list/16001-16100">[番号順一覧]</a><a href="../thread/16001-16100">[スレッド一覧]</a></p>
<pre class="list">
<span class="current">-&gt;&nbsp;<a href="16007">@ 16007 2013-07-30 14:25 [ayako hiroe &lt;roeaya0] 数百万件のload data  infileの繰り返し中にmysqldがハング</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16008">  16008 2013-07-31 15:37 ┣[&quot;yoku ts.&quot; &lt;yoku0825]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16009">@ 16009 2013-07-31 15:45 ┗[Yasuo Ohgaki &lt;yohgak] Re: [mysql 16007] 数百万件のload data infileの繰り返し中にmysqldがハング</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16010">@ 16010 2013-07-31 16:52 　┗[ayako hiroe &lt;roeaya0] Re: 数百万件のload data  infileの繰り返し中にmysqldがハング</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16011">@ 16011 2013-07-31 19:20 　　┣[Yasuo Ohgaki &lt;yohgak] Re: [mysql 16010] Re: 数百万件のload data infileの繰り返し中にmysqldがハング</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16014">@ 16014 2013-08-01 02:23 　　┃┗[ayako hiroe &lt;roeaya0] Re: 数百万件のload data  infileの繰り返し中にmysqldがハング</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16015">@ 16015 2013-08-01 06:08 　　┃　┣[Yasuo Ohgaki &lt;yohgak] Re: [mysql 16014] Re: 数百万件のload data infileの繰り返し中にmysqldがハング</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16016">  16016 2013-08-02 22:58 　　┃　┗[とみたまさひろ &lt;tomm]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16017">@ 16017 2013-08-03 14:47 　　┃　　┗[ayako hiroe &lt;roeaya0]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16012">  16012 2013-07-31 20:18 　　┗[&quot;yoku ts.&quot; &lt;yoku0825]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="16013">@ 16013 2013-08-01 02:17 　　　┗[ayako hiroe &lt;roeaya0]                                 </a></span>
</pre>
</body>
</html>
