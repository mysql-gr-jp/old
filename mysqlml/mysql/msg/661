<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:661</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="660">[前]</a><a href="662">[次]</a><a href="../list/601-700">[番号順一覧]</a><a href="../thread/601-700">[スレッド一覧]</a></p>
<p class="id">
mysql:661
</p>
<div class="header">
<p>
From: 民斗 &lt;民斗 &lt;tommy@xxxxxxxxxx&gt;&gt;<br>
Date: Sat, 30 Jan 1999 00:46:12 +0900<br>
Subject: [mysql 00661] Re: mysql_reload<br>

</p>
</div>
<div class="body">
<pre>
民斗です。

[Subject: <a href="00657">[mysql 00657]</a> Re: mysql_reload]
[Date: Thu, 28 Jan 1999 19:55:28 +0900  From:takeshi@xxxxxxxxxx]

<span class="quote1">&gt; takeshi&gt; 3.22.14 のマニュアルで C API の説明が違うことに気づきました。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; しつれいしました。違うのではなくて、</span>
<span class="quote1">&gt; &quot;refresh が無い&quot; の間違いです。</span>
<span class="quote1">&gt; mysql_reload は mysql_refresh(a,REFRESH_GRANT) で再定義されてました。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; takeshi&gt; で、民斗さんの mysql-ruby-2.1.1 に対するパッチを添付します</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; こちらが正解のパッチです。</span>

このパッチではちょっとまずいです。

refresh() の引数 VALUE a は int 型の値ではなくて、Ruby のオブジェクトを
指定する必要があるので…。

ということで、2.1.1 に対するパッチを添付します。単純に mysql_refresh()
を追加したのと REFRESH_* の定数を追加しただけです。

で、毅さんのパッチを見て思ったんですが、やっぱり MYSQL_VERSION_ID とか
でクライアント（というかC API）のバージョンを判断して色んなバージョンで 
make できるようにしておいた方がいいのかな…と…。

今は自分のことしか考えてないんで (^^; 最新の MySQL バージョン用になって
しまっていますが、いつごろのバージョンから対応した方がいいでしょう？

3.20.xx にも対応してた方がいいですかね？ やっぱり…。
--
民斗 &lt;tommy@xxxxxxxxxx&gt;


--- mysql.c.orig	Sat Jan 30 00:29:56 1999
+++ mysql.c	Sat Jan 30 00:18:16 1999
@@ -257,4 +257,13 @@
 }
 
+/*	refresh(r)	*/
+static VALUE refresh(VALUE obj, VALUE r)
+{
+    MYSQL* m = GetHandler(obj);
+    if (mysql_refresh(m, NUM2INT(r)) != 0)
+	mysql_raise(m);
+    return TRUE;
+}
+
 /*	reload()	*/
 static VALUE reload(VALUE obj)
@@ -624,4 +633,5 @@
     rb_define_method(cMysql, &quot;ping&quot;, ping, 0);
     rb_define_method(cMysql, &quot;query&quot;, query, 1);
+    rb_define_method(cMysql, &quot;refresh&quot;, refresh, 1);
     rb_define_method(cMysql, &quot;reload&quot;, reload, 0);
     rb_define_method(cMysql, &quot;select_db&quot;, select_db, 1);
@@ -639,4 +649,9 @@
     rb_define_const(cMysql, &quot;CLIENT_COMPRESS&quot;, INT2NUM(CLIENT_COMPRESS));
     rb_define_const(cMysql, &quot;CLIENT_ODBC&quot;, INT2NUM(CLIENT_ODBC));
+    rb_define_const(cMysql, &quot;REFRESH_GRANT&quot;, INT2NUM(REFRESH_GRANT));
+    rb_define_const(cMysql, &quot;REFRESH_LOG&quot;, INT2NUM(REFRESH_LOG));
+    rb_define_const(cMysql, &quot;REFRESH_TABLES&quot;, INT2NUM(REFRESH_TABLES));
+    rb_define_const(cMysql, &quot;REFRESH_HOSTS&quot;, INT2NUM(REFRESH_HOSTS));
+    rb_define_const(cMysql, &quot;REFRESH_STATUS&quot;, INT2NUM(REFRESH_STATUS));
 
     /* MysqlRes object method */

</pre>
</div>
<p class="button"><a href="660">[前]</a><a href="662">[次]</a><a href="../list/601-700">[番号順一覧]</a><a href="../thread/601-700">[スレッド一覧]</a></p>
<pre class="list">
<span class="current">-&gt;&nbsp;<a href="661">    661 1999-01-30 00:46 [民斗 &lt;tommy@xxxxxxxx] Re: mysql_reload                        </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="665">    665 1999-01-31 12:35 ┣[&lt;takeshi@xxxxxxxxxx&gt;]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="765">    765 1999-03-08 16:06 ┗[Yasuaki Tanaka &lt;yasu] データの変換                          </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="771">    771 1999-03-09 13:27 　┗[kazumasa Nakamura &lt;k]                                     </a></span>
</pre>
</body>
</html>
