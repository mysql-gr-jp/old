<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:3857</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="3856.html">[前]</a><a href="3858.html">[次]</a><a href="../list/3801-3900.html">[番号順一覧]</a><a href="../thread/3801-3900.html">[スレッド一覧]</a></p>
<p class="id">
mysql:3857
</p>
<div class="header">
<p>
From: &quot;Kawai,Takanori&quot; &lt;&quot;Kawai,Takanori&quot; &lt;GCD00051@xxxxxxxxxx&gt;&gt;<br>
Date: Thu, 28 Jun 2001 12:31:52 +0900<br>
Subject: [mysql 03857] Re: update した件数をカウントしたい。<br>

</p>
</div>
<div class="body">
<pre>
川合孝典です。

----- Original Message -----
From: &quot;Akihiko Shinohara&quot; &lt;sino@xxxxxxxxxx&gt;
To: &lt;ml@xxxxxxxxxx&gt;
Sent: Thursday, June 28, 2001 11:02 AM
Subject: <a href="03853.html">[mysql 03853]</a> Re: updateした件数をカウントしたい。


<span class="quote1">&gt; 篠原です。</span>
（中略）
<span class="quote1">&gt; DBI::MySQL のマニュアルを注意深く読んでいると</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; 影響のあった行(Changed)を調べるには、</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; $sth-&gt;rows</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; 探した行(Matched)を調べるには、connectのdata_sourceに、</span>
<span class="quote1">&gt; mysql_client_found_rowsを真にして設定し</span>
<span class="quote1">&gt; ＃ DBI:mysql:database=$database;host=$host;mysql_client_found_rows=1</span>
<span class="quote1">&gt; 同じく、$sth-&gt;rows で、返ってくるようです。</span>
perldocからちょっと長いですがその部分を引用すると...
&lt;引用&gt;
mysql_client_found_rows
    Enables (TRUE value) or disables (FALSE value)
    the flag CLIENT_FOUND_ROWS while connecting to
    the MySQL server. This has a somewhat funny
    effect: Without mysql_client_found_rows, if
    you perform a query like

    UPDATE $table SET id = 1 WHERE id = 1

    then the MySQL engine will always return 0,
    because no rows have changed.  With
    mysql_client_found_rows however, it will
    return the number of rows that have an id 1,
    as some people are expecting. (At least for
    compatibility to other engines.)

    By default this flag is disabled. However, you
    can enable it by default, when installing the
    Msql-Mysql-modules with

    perl Makefile.PL --config --mysql-use-client-found-rows
    make
    make install
&lt;/引用&gt;
まさに、そのまんまのことが書いてありますね。
設定すれば、デフォルトにすることもできるとありますし。

<span class="quote1">&gt; ここから質問です。</span>
<span class="quote1">&gt; 今まで気にしてませんでしたが、他のデータベースでは、</span>
<span class="quote1">&gt; どっちを返すのでしょう。クライアント的には、</span>
<span class="quote1">&gt; Matchedの行を返してもらったほうが便利なような気がします。</span>
いちいち確かめたわけではありませんが、上記の引用にもあると
おり、どちらかといえばMatchedの行数を返すケースのほうが
多いような気がします。
＃「(At least for compatibility to other engines.)」との
＃ことですし

ただDBIのrowsの定義はrowsメソッドの説明にある
&lt;引用&gt;
　Returns the number of rows affected by the last row
affecting command
&lt;/引用&gt;
ということだけだと思いますし、実装のガイドラインである
DBI::DBDでも特に説明があるわけでもありません。ですので
実装者の「解釈」によってバラつきがあるかもしれません。
（少なくともmysqlにはあったわけですし(^^)）

==============================================
川合 孝典 (Hippo2000)
   kwitknr@xxxxxxxxxx GCD00051@xxxxxxxxxx
   <a href="http://member.nifty.ne.jp/hippo2000">http://member.nifty.ne.jp/hippo2000</a>
   <a href="http://www.hippo2000.net/">http://www.hippo2000.net/</a>
    DBI日本語メーリングリスト管理人、 Kansai.pm所属
==============================================


</pre>
</div>
<p class="button"><a href="3856.html">[前]</a><a href="3858.html">[次]</a><a href="../list/3801-3900.html">[番号順一覧]</a><a href="../thread/3801-3900.html">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="3845.html">   3845 2001-06-27 19:00 [MAO &lt;mao@xxxxxxxxxx&gt;] update した件数をカウントしたい。       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="3846.html">   3846 2001-06-27 19:31 ┗[TSUTSUMI Thoru &lt;tutu]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="3848.html">   3848 2001-06-27 22:41 　┗[MAO &lt;mao@xxxxxxxxxx&gt;]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="3852.html">   3852 2001-06-28 10:31 　　┣[TSUTSUMI Thoru &lt;tutu]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="3856.html">   3856 2001-06-28 12:17 　　┃┗[&quot;Kawai,Takanori&quot; &lt;GC]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="3853.html">   3853 2001-06-28 11:02 　　┗[Akihiko Shinohara &lt;s]                                   </a></span>
<span class="current">-&gt;&nbsp;<a href="3857.html">   3857 2001-06-28 12:31 　　　┗[&quot;Kawai,Takanori&quot; &lt;GC]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="3860.html">   3860 2001-06-28 16:46 　　　　┗[MAO &lt;mao@xxxxxxxxxx&gt;]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="3861.html">   3861 2001-06-28 17:36 　　　　　┗[TSUTSUMI Thoru &lt;tutu]                             </a></span>
</pre>
</body>
</html>
