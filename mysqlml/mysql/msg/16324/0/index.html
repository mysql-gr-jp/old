<html><head></head><body><div style="color:; background-color:; font-family:MS PGothic, sans-serif;font-size:12pt"><div id="yiv166745212"><div style="font-family: MS PGothic, sans-serif; font-size: 12pt;"><div>MySQLをはじめて1ヶ月の初心者です。以前、他のRDBを少しかじった程度ですが<br>本格的にものにしようと勉強中です。<br>ところが、MySQLの処理速度が遅いので困惑しており、メールをしたところです。</div><div><br>テーブルは日付、 keycode、数値1、数値2と簡単ですが、データ量は毎日取込んでおりで<br>&nbsp;keycodeが2000種程になるので今では200万件を超えております。<br>今回MySQLに移植しなおして、ためしにselect * from テーブル名(tb)de開けたところ3.2秒かかりました。<br>まだインデックスは付けていませんが、
 keycodeだけ付けましたが2.2秒とあまり変わりません。<br>その時、EXPLAINを見ましたが　type = ALL&nbsp; Key=NULL Extra = NULL&nbsp;
 になっていました。</div><div>今回は自己結合を使って日付、 keycodeごとに1週間分、1か月分、半年分、一年分の平均を算出していきたく<br>クエリーを作りました。　A.日付&nbsp; &gt;=&nbsp; '2016-04-29' にして直近だけで9.6秒かかりました。<br>ちなみに今年から（A.日付&nbsp; &gt;=&nbsp; '2016-01-01' )では　96分かかっていました。本当は2年分程を5～6分以内に<br>できないか思っております。<br>この時の条件は　日付とkeycodeを単独でインデックスを作りました。<br>explain は tb A&nbsp; type = range ,key=日付&nbsp;&nbsp;&nbsp; ,extra =Using index condition; Using MRR; Using temporary; Using filesort<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tb B&nbsp; type = ref&nbsp;&nbsp; ,key=keycode ,extra =Using where<br>MYSQLのVer=5.7&nbsp;
 モメリー＝4Ｇ　　ＯＳ=WIN7pro</div><div>explainは初めてで良くわかりませんが、速度アップのためのご指導頂けないでしょうか。</div><div>***************************************************************<br>select</div><div>&nbsp;&nbsp; A.hizuke&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; as&nbsp;&nbsp; "HIZUKE"&nbsp; ,<br>&nbsp;&nbsp; A.keycode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; as&nbsp;&nbsp; "KEYCODE",</div><div>&nbsp; avg(case when&nbsp; B.日付 &gt;= date_add(A.日付,interval -7 day)　 then&nbsp; B.数値1&nbsp;&nbsp; else null end )&nbsp; as&nbsp; "7d_1_HEIKIN"&nbsp; ,<br>&nbsp; avg(case when&nbsp; B.日付 &gt;= date_add(A.日付,interval -7 day)　 then&nbsp; B.数値2&nbsp;&nbsp; else null end )&nbsp; as&nbsp; "7d_2_HEIKIN"&nbsp; ,<br>&nbsp; avg(case when&nbsp; B.日付 &gt;= date_add(A.日付,interval -31 day) then&nbsp; B.数値1&nbsp;&nbsp; else null end )&nbsp; as&nbsp;
 "31d_1_HEIKIN"&nbsp; ,<br>&nbsp; avg(case when&nbsp; B.日付 &gt;= date_add(A.日付,interval -31 day) then&nbsp; B.数値2&nbsp;&nbsp; else null end )&nbsp; as&nbsp; "31d_2_HEIKIN"&nbsp; ,</div><div>&nbsp; avg(case when&nbsp; B.日付 &gt;= date_add(A.日付,interval -150 day) then&nbsp; B.数値1&nbsp;&nbsp; else null end )&nbsp; as&nbsp; "180d_1_HEIKIN"&nbsp; ,<br>&nbsp; avg(case when&nbsp; B.日付 &gt;= date_add(A.日付,interval -150 day) then&nbsp; B.数値2&nbsp;&nbsp; else null end )&nbsp; as&nbsp; "180d_2_HEIKIN"&nbsp; ,</div><div>&nbsp; avg(case when&nbsp; B.日付 &gt;=&nbsp; date_add(A.日付,interval -365 day)　then&nbsp; B.数値1&nbsp;&nbsp; else null end )&nbsp; as&nbsp; "365d_1_HEIKIN"&nbsp; ,<br>&nbsp; avg(case when&nbsp; B.日付 &gt;=&nbsp; date_add(A.日付,interval -365 day)&nbsp; then&nbsp; B.数値2&nbsp;&nbsp; else null end )&nbsp; as&nbsp; "365d_2_HEIKIN"&nbsp; ,</div><div>&nbsp; from&nbsp;&nbsp; tb A , tb
 B<br>&nbsp;<br>&nbsp;where&nbsp; A.keycode&nbsp;&nbsp; =&nbsp; B.keycode<br>&nbsp;and&nbsp;&nbsp;&nbsp; A.日付&nbsp; &gt;=&nbsp; '2016-04-29' <br>&nbsp;and&nbsp;&nbsp;&nbsp; B.日付&nbsp; between&nbsp;&nbsp;&nbsp; date_add(A.日付,interval -365 day)&nbsp;&nbsp; and&nbsp;&nbsp; A.日付<br>&nbsp; <br>&nbsp;group by&nbsp; A.keycode ,A.日付<br>&nbsp;&nbsp; <br>******************************************************************<br></div></div></div></div>
</body></html>