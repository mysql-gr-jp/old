<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:15504</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="15503">[前]</a><a href="15505">[次]</a><a href="../list/15501-15600">[番号順一覧]</a><a href="../thread/15501-15600">[スレッド一覧]</a></p>
<p class="id">
mysql:15504
</p>
<div class="header">
<p>
From: Tsuyoshi Nukii &lt;Tsuyoshi Nukii &lt;nukii@xxxxxxxxxx&gt;&gt;<br>
Date: Mon, 14 Feb 2011 20:47:00 +0900<br>
Subject: [mysql 15504] レプリケーションの遅延対策について<br>

</p>
</div>
<div class="body">
<pre>
貫井（ぬきい）と申します。

MySQLのレプリケーション環境で稼動しているサーバのスレーブサーバが
HDD障害を起こしたので、HDDの交換をおこなって再レプリケーションを
行ったところ、レプリケーションの遅延が発生してこまっております。

再レプリケーションは、
１．マスターを停止
２．データファイルのコピー
３．スレーブサーバにレプリケーションの指定
４．レプリケーション開始
といったオーソドックスな手法で行っています。


今回、HDDの交換だけではなく、どうせ環境を作りなおすならと欲張って
しまい、MySQL5.5.9にバージョンアップを行っていることもあり、問題
点の切り分けすらできていない状況です。

問題の切り分け、解決に向けてのアドバイスがいただければとおもい
メールさせていただいております。

環境
  マスタサーバ
    OS   ：RHEL 4.4 (x86_64)
    MySQL：MySQL 5.1.48( 64 Bit版) =&gt; MySQL 5.5.9( 64 Bit版)

  スレーブサーバ
    OS   ：RHEL 4.4 (x86_64)
    MySQL：MySQL 5.1.48( 64 Bit版) =&gt; MySQL 5.5.9( 64 Bit版)

  ・レプリケーションは、行 ベース レプリケーションで行っています。
  ・各サーバ間は、専用のGBitネットワークです。


HDD障害が発生するまでは若干の遅延が発生することがあっても、時間単
位の遅延が発生することがなかった状況です。

両サーバとも、バージョンアップとレプリケーション自体は正常稼動し
ており、レプリケーションのログもスレーブサーバ側に届いていますが
スレーブサーバへの書込みが追いついていないように見えます。

設定等につきましては、取り立てて変更はしておらずInnoDbプラグイン
を使用するため、以下の設定を追加した程度です。

innodb_io_capacity=500
innodb_read_io_threads=8
innodb_write_io_threads=8


もともと、マスターに書き込んでいるデータ量が大量であるためマスタを
分割することも検討中ですが、ハードの手配等々で手間取っており現状の
解決策とはなっておりません。


基本的な問題点に気づいていない可能性もありますので、何かお気づきの
点がございましたら、アドバイスいただけますようお願いします。

以上
-- 
   貫井 剛 （ぬきい つよし）

   mailto:nukii@xxxxxxxxxx

</pre>
</div>
<p class="button"><a href="15503">[前]</a><a href="15505">[次]</a><a href="../list/15501-15600">[番号順一覧]</a><a href="../thread/15501-15600">[スレッド一覧]</a></p>
<pre class="list">
<span class="current">-&gt;&nbsp;<a href="15504">  15504 2011-02-14 20:47 [Tsuyoshi Nukii &lt;nuki] レプリケーションの遅延対策について      </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="15505">  15505 2011-02-14 23:59 ┣[とみたまさひろ &lt;tomm]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="15509">  15509 2011-02-15 08:51 ┃┗[Tsuyoshi Nukii &lt;nuki]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="15506">  15506 2011-02-15 00:59 ┗[kenichi masuda &lt;masu] Re: [mysql 15504] レプリケーションの遅延対策について</a></span>
</pre>
</body>
</html>
