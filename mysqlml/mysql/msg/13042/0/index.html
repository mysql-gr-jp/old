<html><head></head><body><table width="100%"><tbody><tr><td>
<p>ska king です。</p>
<p>あくまで推測ですが、結果から言うと「InnoDBのフラグメンテーション状況を定量的に知る方法はないので、後述する方法で定期的にInnoDBの最適化を行う」しかないのかなと思います。<br>
定期的というのは、日々のトランザクション数に応じて1ヶ月/3ヶ月/6ヶ月単位で行えばよいと思います。</p>
<p>以下は、質問に対しての回答です。ほとんど推測ですが。</p>
<p>・1について<br>
InnoDBのフラグメント状況を定量的に知る方法は無いと思われます。<br>
もしかしたら、「show innodb status」や「show status」コマンド<br>
にヒントらしきものがあるのかもしれませんが、英語はさっぱりなもので。。。</p>
<p>・2について<br>
mysqlcheckコマンドはMyISAM型やBDB型のテーブルに対しての最適化で、InnoDB型に<br>
対しては使用できなかった気がします。<br>
推測ですが、内部的には「ANALYZE TABLE」や「OPTIMIZE TABLE」を呼んでいるのかもしれません。<br>
MyISAM型であれば、このコマンドでインデックスのソートや統計情報を最新にするので、<br>
検索効率等をアップさせることができます。</p>
<p>InnoDBのフラグメンテーションの最適化であれば次の二通りがあります。</p>
<p>① mysqldumpコマンドでテーブルを再構築する方法<br>
② ALTER TABLE文でテーブル文を再構築する方法。</p>
<p>上記の二通りで、InnoDBデータファイル内のインデックス領域とデータ領域を最適化することができるはずです。<br>
いずれの方法も、MySQLリファレンスマニュアルの「7.5.13.3. InnoDB テーブルのデフラグメント化」に記述されていますので、参照することをお勧めします。また、試す前には必ずバックアップを取得してください。<br>
但し、InnoDBデータファイルサイズが小さくなるわけではないので注意して下さい。</p>
<p>以下は、全くの未検証方法で、運用段階でどのような弊害が発生するかわからないので、実行する場合は十分に検証して下さい。</p>
<p>① 設定ファイルの[mysqld]セクションに「innodb_file_per_table」オプションを記述する。<br>
② 定期的にmysqldumpを使用してテーブル単位に最適化を行う。</p>
<p>①によって、InnoDBのテーブル単位に「テーブル名.ibd」というファイルが作成されます。<br>
このファイルは、MyISAMテーブルを作成した時に生成される「MYD（データファイル）」「MYI（インデックスファイル）」を合わせたようなファイルです。<br>
なので、「一つのInnoDBデータファイルの肥大化を防ぐことができ、テーブル単位で最適化できる」のではないかと思っています。<br>
ただOSの制限によって、一つのInnoDBデータファイルが肥大化するのを防ぎたいだけであれば、「innodb_data_file_path」の指定で十分だと思います。</p>
<p>以上です。長文になって申し訳ありません。<br>
有識者の方々ツッコミよろしくお願いいたします。。。</p>
</td></tr></tbody></table>
<p></p><p></p><p><br></p><hr size="1">
<a target="_blank" href="http://pr.mail.yahoo.co.jp/auction/">Let's start Yahoo! Auction  -  Free Campaign Now!</a>
</body></html>