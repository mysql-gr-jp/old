<html><head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:12995</title>
<link rel="stylesheet" type="text/css" href="/css/w3ml.css">
</head>
<body>
<p class="button"><a href="12994.html">[前]</a><a href="12996.html">[次]</a><a href="../list/12901-13000.html">[番号順一覧]</a><a href="../thread/12901-13000.html">[スレッド一覧]</a></p>
<p class="id">
mysql:12995
</p>
<div class="header">
<p>
From: 天野　潔 &lt;天野　潔 &lt;kiyoshi.amano@xxxxxxxxxx&gt;&gt;<br>
Date: Thu, 18 May 2006 15:06:19 +0900<br>
Subject: [mysql 12995] SQL 文の文法エラーで、以降ロックが解除できない？<br>

</p>
</div>
<div class="body">
<pre>お世話になっております。天野です。

以下のような SQL 文を C# で生成して mysql のサーバに投げているのですが、SQL 文法
エラーがあった場合、クライアントのプログラムがフリーズした上、mysqld を再起動し
ない限り、他のユーザもアクセスできなくなってしまいます。
	
	lock tables characters write, messages write;
	insert into characters … ;	←ここにSQL文法エラーがあった
	select sn from characters where  … ;
	
	ここで取得した sn の値を元に以下を実行
	
	update messages set … where sn = XX;
	unlock tables;

普通は SQL 文のエラーがあった場合、エラーメッセージをはいて SQL の接続の解除され
るのですが、上記のように lock tables があった場合、ロックした状態で接続が続いて
いるようなのです。

このシステムは、ログインの管理を mysql で行っているため、１ユーザのエラーで他の
ユーザがすべてログインできなくなるという、重大な問題が生じて困っています。

このようなことは普通にあるのでしょうか。また回避する方法はあるのでしょうか。
何かご存じの方がいらっしゃればよろしくお願いいたします。

バージョンは RHLE 3.0 に添付の mysql 3.23 を使用しています。
また、クライアントは XML Web サービスで mysql が稼働しているサーバにアクセスし、
Webサービスプログラムにより、ローカルでSQLにアクセスしています。
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
天野　潔 &lt;kiyoshi.amano@xxxxxxxxxx&gt;
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

</pre>
</div>
<p class="button"><a href="12994.html">[前]</a><a href="12996.html">[次]</a><a href="../list/12901-13000.html">[番号順一覧]</a><a href="../thread/12901-13000.html">[スレッド一覧]</a></p>


</body></html>