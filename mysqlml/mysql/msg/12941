<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:12941</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="12940">[前]</a><a href="12942">[次]</a><a href="../list/12901-13000">[番号順一覧]</a><a href="../thread/12901-13000">[スレッド一覧]</a></p>
<p class="id">
mysql:12941
</p>
<div class="header">
<p>
From: &quot;山下 智久&quot; &lt;&quot;山下 智久&quot; &lt;peanuts1113@xxxxxxxxxx&gt;&gt;<br>
Date: Thu, 27 Apr 2006 17:10:44 +0900<br>
Subject: [mysql 12941] Re:<br>

</p>
</div>
<div class="body">
<pre>
まず皆様にタイトル表記がなかったことを謝罪させて下さい。
すみませんでした。

Yasufumi Kinoshita様
お返事ありがとうございます。

バグレポート拝見させていただきました。

<span class="quote1">&gt; 論理ＣＰＵ数が多過ぎると上手く扱えないことがあるようですので、</span>
<span class="quote1">&gt; HyperThreadingを無効にすると状況が改善する可能性があります。</span>
<span class="quote1">&gt; それでもだめならば、さらにカーネルオプションなどで</span>
<span class="quote1">&gt; CPU数を減らす必要があるかもしれません。</span>

早速検証してみます。

<span class="quote1">&gt; また、この事象に直接関係は無いかもしれませんが、</span>
<span class="quote2">&gt; &gt; MAINはinnoDBです。</span>
<span class="quote1">&gt; とのことですがinnodb関係のパラメータはデフォルトのままなのでしょうか？</span>

innodb関連のパラメーターはデフォルトのままです。
別スレになるかもしれませんが、
set-variable = innodb_log_file_sizeを変更し、
start/restartすると立ち上がらない現象がでておりましたので、
そのままの設定で運営しております。

以上宜しくお願いいたします。

--Yasufumi Kinoshita&lt;kinoshita.yasufumi@xxxxxxxxxx&gt; wrote:
<span class="quote1">&gt; 確実な情報ではありませんが、参考までに。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; 詳しいことは良く分りませんが、バグレポートに報告されている事象</span>
<span class="quote1">&gt; bugs.mysql.com/bug.php?id=15815</span>
<span class="quote1">&gt; と関係があるかもしれません。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; 論理ＣＰＵ数が多過ぎると上手く扱えないことがあるようですので、</span>
<span class="quote1">&gt; HyperThreadingを無効にすると状況が改善する可能性があります。</span>
<span class="quote1">&gt; それでもだめならば、さらにカーネルオプションなどで</span>
<span class="quote1">&gt; CPU数を減らす必要があるかもしれません。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; バージョン5.1.8以降で改善する可能性があります。</span>
<span class="quote1">&gt; もちろんしない可能性も大いにあります。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; また、この事象に直接関係は無いかもしれませんが、</span>
<span class="quote2">&gt; &gt; MAINはinnoDBです。</span>
<span class="quote1">&gt; とのことですがinnodb関係のパラメータはデフォルトのままなのでしょうか？</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; 以上気づいたことでした。</span>
<span class="quote1">&gt; </span>
<span class="quote2">&gt; &gt; 山下と申します。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; Webサーバ2台・DBサーバ1台の構成でサイト運営を行っております。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; この度DBサーバのCPU高負荷により安定運営が難しくなったため、</span>
<span class="quote2">&gt; &gt; スペックをアップさせたＤＢサーバを購入・設置し旧サーバよりデータ移行したのですが、</span>
<span class="quote2">&gt; &gt; 逆にかなりレスポンスが悪くなってしまいました。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; 原因または解決策をご存知の方いらっしゃいましたら</span>
<span class="quote2">&gt; &gt; どんな些細なことでもかまいませんのでご教授いただけますでしょうか。</span>
<span class="quote2">&gt; &gt; 宜しくお願いいたします。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; innoDBとMyISAMのテーブルが混在しており、</span>
<span class="quote2">&gt; &gt; MAINはinnoDBです。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; INDEXも適宜はっております。</span>
<span class="quote2">&gt; &gt; データ以移行はmysqldumpを使用いたしました。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; 現象として、</span>
<span class="quote2">&gt; &gt; 旧サーバでは、CPUに負荷がかかるものの、負荷状況に上下がみられ、遅いながらも運営できていたのですが（集中時間を除く）、</span>
<span class="quote2">&gt; &gt; 新サーバではCPUが高負荷のまま、絶えずFULLに使用されhung up状態になってしまいます。</span>
<span class="quote2">&gt; &gt; サーバ交換時間が集中時間ではなかったため、純粋にアクセス集中によるCPU高負荷とは考えづらい状況です。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; 新・旧サーバを比較して</span>
<span class="quote2">&gt; &gt; (1)DBサーバ本体の変更</span>
<span class="quote2">&gt; &gt; (2)OSの変更(32bitから64bit)</span>
<span class="quote2">&gt; &gt; (3)my.confのの変更</span>
<span class="quote2">&gt; &gt; 以外に変更を行っていないためその中に問題があるのではないかと調査しております。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; 開発環境ならびにＤＢサーバスペックは下記の通りです。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; −−−−−−−−−−−</span>
<span class="quote2">&gt; &gt; ●旧ＤＢサーバ環境：</span>
<span class="quote2">&gt; &gt; Pen4 3.2GHz 32bit * 1</span>
<span class="quote2">&gt; &gt; メモリ2Ｇ</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; Red Hat Enterprise Linux ES3 32bit</span>
<span class="quote2">&gt; &gt; php 4.4.2</span>
<span class="quote2">&gt; &gt; mysql 4.1.9</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; my.conf内容</span>
<span class="quote2">&gt; &gt; [mysqld]</span>
<span class="quote2">&gt; &gt; default-table-type=InnoDB</span>
<span class="quote2">&gt; &gt; query_cache_limit=10M</span>
<span class="quote2">&gt; &gt; query_cache_size=150M</span>
<span class="quote2">&gt; &gt; query_cache_type=1</span>
<span class="quote2">&gt; &gt; set-variable = key_buffer=300M</span>
<span class="quote2">&gt; &gt; set-variable = table_cache=256</span>
<span class="quote2">&gt; &gt; set-variable = sort_buffer=150M</span>
<span class="quote2">&gt; &gt; set-variable = record_buffer=350M</span>
<span class="quote2">&gt; &gt; set-variable = long_query_time=5</span>
<span class="quote2">&gt; &gt; set-variable = max_connections=500</span>
<span class="quote2">&gt; &gt; log-slow-queries</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; [mysqldump]</span>
<span class="quote2">&gt; &gt; default-character-set = ujis</span>
<span class="quote2">&gt; &gt; −−−−−−−−−−−</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; −−−−−−−−−−−</span>
<span class="quote2">&gt; &gt; ●新ＤＢサーバ環境：</span>
<span class="quote2">&gt; &gt; Xeon 3.33GHz 64bit * 4</span>
<span class="quote2">&gt; &gt; メモリ8Ｇ</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; Red Hat Enterprise Linux AS4 64bit</span>
<span class="quote2">&gt; &gt; php 4.4.2</span>
<span class="quote2">&gt; &gt; mysql 4.1.18</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; my.conf内容</span>
<span class="quote2">&gt; &gt; [mysqld]</span>
<span class="quote2">&gt; &gt; default-table-type=InnoDB</span>
<span class="quote2">&gt; &gt; query_cache_limit=10M</span>
<span class="quote2">&gt; &gt; query_cache_size=150M</span>
<span class="quote2">&gt; &gt; query_cache_type=1</span>
<span class="quote2">&gt; &gt; set-variable = key_buffer=4000M</span>
<span class="quote2">&gt; &gt; set-variable = table_cache=256</span>
<span class="quote2">&gt; &gt; set-variable = sort_buffer=400M</span>
<span class="quote2">&gt; &gt; set-variable = record_buffer=350M</span>
<span class="quote2">&gt; &gt; set-variable = long_query_time=5</span>
<span class="quote2">&gt; &gt; set-variable = max_connections=500</span>
<span class="quote2">&gt; &gt; set-variable = join_buffer=1000M</span>
<span class="quote2">&gt; &gt; #set-variable = innodb_log_file_size=20M</span>
<span class="quote2">&gt; &gt; log-slow-queries</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; [mysqldump]</span>
<span class="quote2">&gt; &gt; default-character-set = ujis</span>
<span class="quote2">&gt; &gt; −−−−−−−−−−−</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; </span>
<span class="quote2">&gt; &gt; 何卒宜しくお願いいたします。</span>
<span class="quote2">&gt; &gt; </span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt;</span>




-----------------------------------------------
得するキャンペーンやプレゼント情報を是非ご覧下さい！
livedoor 懸賞
<a href="http://present.livedoor.com/">http://present.livedoor.com/</a>


</pre>
</div>
<p class="button"><a href="12940">[前]</a><a href="12942">[次]</a><a href="../list/12901-13000">[番号順一覧]</a><a href="../thread/12901-13000">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="12938">  12938 2006-04-27 13:45 [&quot;山下 智久&quot; &lt;peanuts]                                         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12939">  12939 2006-04-27 15:42 ┣[Yasufumi Kinoshita &lt;]                                       </a></span>
<span class="current">-&gt;&nbsp;<a href="12941">  12941 2006-04-27 17:10 ┃┣[&quot;山下 智久&quot; &lt;peanuts]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12943">  12943 2006-04-27 17:34 ┃┃┣[SATOH Fumiyasu &lt;fumi]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12954">  12954 2006-04-28 21:31 ┃┃┗[&quot;山下 智久&quot; &lt;peanuts]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12956">  12956 2006-04-28 23:36 ┃┃　┗[SUGAWARA Hajime &lt;sug]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13489">  13489 2006-11-14 09:35 ┃┗[遠藤 俊裕 &lt;endo@xxxx] HT使用時の速度低下について          </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13495">  13495 2006-11-14 12:51 ┃　┣[SATOH Fumiyasu &lt;fumi]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13496">  13496 2006-11-14 13:51 ┃　┃┗[遠藤 俊裕 &lt;endo@xxxx]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13497">  13497 2006-11-14 14:43 ┃　┃　┗[SATOH Fumiyasu &lt;fumi]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13498">  13498 2006-11-14 15:03 ┃　┗[Yasufumi Kinoshita &lt;]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13499">  13499 2006-11-14 15:12 ┃　　┗[遠藤 俊裕 &lt;endo@xxxx]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13505">  13505 2006-11-15 21:41 ┃　　　┗[&quot;Hiro Yoshioka&quot; &lt;hyo]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12940">  12940 2006-04-27 16:00 ┗[&quot;Tetsuro IKEDA&quot; &lt;ikd]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12944">  12944 2006-04-27 17:42 　┗[&quot;山下 智久&quot; &lt;peanuts]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="12945">  12945 2006-04-27 18:02 　　┗[Tetsuro IKEDA &lt;te.ik]                                   </a></span>
</pre>
</body>
</html>
