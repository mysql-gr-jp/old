<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:14561</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="14560.html">[前]</a><a href="14562.html">[次]</a><a href="../list/14501-14600.html">[番号順一覧]</a><a href="../thread/14501-14600.html">[スレッド一覧]</a></p>
<p class="id">
mysql:14561
</p>
<div class="header">
<p>
From: &quot;なかで&quot; &lt;&quot;なかで&quot; &lt;nakade@xxxxxxxxxx&gt;&gt;<br>
Date: Fri, 16 May 2008 15:10:49 +0900<br>
Subject: [mysql 14561] 片方のテーブルに存在しないデータを取得するSQL<br>

</p>
</div>
<div class="body">
<pre>
中出と申します。

2つのテーブルがA、Bがあり、Aのあるフィールドの値が
Bのフィールドに存在しないか、部分一致もしない場合に
取り出したいと思っています。

それで、以下のようなSQLを作成したのですが、Aのデータが
3万件、Bのデータが1000件をこえたあたりから、
mysqlの反応がなくなるようになりました。

EXPLAIN  SELECT count( * ) AS cnt
FROM `A`
LEFT JOIN `B` ON ( `B`.`email` != ''
AND (
`B`.`email` = `A`.`email`
OR INSTR( `A`.`email` , `B`.`email` ) &gt;0 )
)
WHERE `B`.`email` IS NULL 

データがふえても動くようにするにはどのようなSQLに
したらよいでしょうか？


●テーブル
create table A (
  name varchar(50),
  email varchar(255),
  UNIQUE KEY `email` (`email`)
);

create table B (
  email varchar(255),
  cnt int,
  UNIQUE KEY `email` (`email`)
);


●mysqlのバージョン
4.0.23


以上、よろしくお願いします。




</pre>
</div>
<p class="button"><a href="14560.html">[前]</a><a href="14562.html">[次]</a><a href="../list/14501-14600.html">[番号順一覧]</a><a href="../thread/14501-14600.html">[スレッド一覧]</a></p>
</body>
</html>
