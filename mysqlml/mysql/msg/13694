<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:13694</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="13693">[前]</a><a href="13695">[次]</a><a href="../list/13601-13700">[番号順一覧]</a><a href="../thread/13601-13700">[スレッド一覧]</a></p>
<p class="id">
mysql:13694
</p>
<div class="header">
<p>
From: &quot;Mitsuru Araki&quot; &lt;&quot;Mitsuru Araki&quot; &lt;gunny517@xxxxxxxxxx&gt;&gt;<br>
Date: Thu, 25 Jan 2007 20:37:50 +0900<br>
Subject: [mysql 13694] Re: トランザクション中のオートインクリメント値<br>

</p>
</div>
<div class="body">
<pre>
久保様　広津様

ご指摘ありがとうございます。
なるほど。使えそうですね。
今までもlast_insert_id()は使っていたのですが、
トランザクションをかけていないケースだったので・・・・

<span class="quote1">&gt; ですので、Rollback した場合、そのトランザクション中で自動生成</span>
<span class="quote1">&gt; された値は、Rollback 後の自動生成値としては再使用されず欠番となります。</span>

なるほど。
これはMS Accessでオートナンバーと呼ばれている設定
（要するにオートインクリメントですね）をされたカラムに
入力を始めた場合、途中で中止してもそのとき入力しようとした
レコードのオートインクリメント値が欠番になるのと同じ原理ですね。

スッキリしました。
安心して使ってみます。
ありがとうございました。




07/01/22 に T.Hirotsu&lt;hirotsu@xxxxxxxxxx&gt; さんは書きました:
<span class="quote1">&gt; こんにちは、広津です。</span>
<span class="quote1">&gt; エンジンは InnoDB と仮定します。</span>
<span class="quote1">&gt; Ver. 4.0, 4.1, 5.0 で私もそのようにして使っています。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; select LAST_INSERT_ID() は、トランザクション分離レベルや、</span>
<span class="quote1">&gt; トランザクションブロックの内外に関わらず、Connection ごとに、</span>
<span class="quote1">&gt; 最後に自動生成された AUTO_INCREMENT カラム値を返すようです。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; 「最後に自動生成された」とは、「トランザクションが最終的に</span>
<span class="quote1">&gt; Commit か Rollback かは関係なく、とりあえず Insert に成功した」</span>
<span class="quote1">&gt; ということかと。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; ですので、Rollback した場合、そのトランザクション中で自動生成</span>
<span class="quote1">&gt; された値は、Rollback 後の自動生成値としては再使用されず欠番となります。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt; （でないと、逆に使えないですよね、、、(^^;）</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;</span>

</pre>
</div>
<p class="button"><a href="13693">[前]</a><a href="13695">[次]</a><a href="../list/13601-13700">[番号順一覧]</a><a href="../thread/13601-13700">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="13681">  13681 2007-01-22 00:00 [&quot;Mitsuru Araki&quot; &lt;gun] トランザクション中のオートインクリメント値</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13682">  13682 2007-01-22 01:03 ┣[kubo &lt;jazzflute@xxxx]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="13683">  13683 2007-01-22 10:42 ┗[&quot;T.Hirotsu&quot; &lt;hirotsu]                                       </a></span>
<span class="current">-&gt;&nbsp;<a href="13694">  13694 2007-01-25 20:37 　┗[&quot;Mitsuru Araki&quot; &lt;gun]                                     </a></span>
</pre>
</body>
</html>
