<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:9251</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="9250">[前]</a><a href="9252">[次]</a><a href="../list/9201-9300">[番号順一覧]</a><a href="../thread/9201-9300">[スレッド一覧]</a></p>
<p class="id">
mysql:9251
</p>
<div class="header">
<p>
From: 川合孝典 &lt;川合孝典 &lt;gcd00051@xxxxxxxxxx&gt;&gt;<br>
Date: Wed, 21 Apr 2004 17:39:54 +0900 (JST)<br>
Subject: [mysql 09251] Re: auto_incrementで次番号を確認したい。<br>

</p>
</div>
<div class="body">
<pre>
川合孝典です。

----- Original Message -----
<span class="quote1">&gt;Date: Wed, 21 Apr 2004 09:15:02 +0900</span>
<span class="quote1">&gt;From: &quot;片寄白王&quot; &lt;katayose@xxxxxxxxxx&gt;</span>
<span class="quote1">&gt;Subject: <a href="09246">[mysql 09246]</a> Re: auto_incrementで次番号を確認したい。</span>
<span class="quote1">&gt;To: ml@xxxxxxxxxx</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;片寄です。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;高橋政利 wrote:</span>
<span class="quote2">&gt;&gt; 調べたところ、LAST_INSERT_ID()が使えるのかな？と思ったのですが、確かに通</span>
<span class="quote2">&gt;&gt; 常の運用では、最後の番号を取得して１を加える方法や</span>
<span class="quote2">&gt;&gt; SELECT 管理番号 FROM 見積書 ORDER BY 管理番号 DESC LIMIT 1</span>
<span class="quote2">&gt;&gt; として得た数字に１を加えれば良いのですが、平成１５年度の管理番号が500件</span>
<span class="quote2">&gt;&gt; しかなく最終番号が150500となっている場合に、平成１６年度となり</span>
<span class="quote2">&gt;&gt; ALTER TABLE 見積書 AUTO_INCREMENT = 160001</span>
<span class="quote2">&gt;&gt; としたときには希望通りの動作にはなりません。</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;ALTER TABLE 見積書 auto_increment=160001;</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;を直前に実行しても</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;SELECT LAST_INSERT_ID();</span>
<span class="quote1">&gt;</span>
<span class="quote1">&gt;は、最後に追加されたauto_incrementフィールドの値を返すだけですので</span>
<span class="quote1">&gt;目的には沿わないと思われます。</span>

切り替えた後の値が問題なのだとすれば、切り替えるさいに
ALTER TABLE 見積書 auto_increment=160000;
とした後（160001 - 1というのがミソ）、
　(1)ダミーで見積書を1件発行して（INSERT）
　(2)そのレコードを削除
というのでは、いかがでしょう？

てっきり切り替える前のほうの問題かと思っていたんですが...
いつ切り替えるかは結局、切り替えられるまで誰にも確実なことは
いえそうもないので。（年度末になったら「切り替えられるかもよ」といった
メッセージをつけるとかぐらいしか思いつきませんでした）


</pre>
</div>
<p class="button"><a href="9250">[前]</a><a href="9252">[次]</a><a href="../list/9201-9300">[番号順一覧]</a><a href="../thread/9201-9300">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="9239">   9239 2004-04-20 18:45 [高橋政利 &lt;takahashi@] auto_incrementで次番号を確認したい。    </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9240">   9240 2004-04-20 23:29 ┣[Shinya Kawaji &lt;kawaj]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9245">   9245 2004-04-21 09:00 ┃┗[高橋政利 &lt;takahashi@]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9248">   9248 2004-04-21 10:12 ┃　┗[Shinya Kawaji &lt;kawaj]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9250">   9250 2004-04-21 11:20 ┃　　┗[ML account &lt;ml@xxxxx]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9246">   9246 2004-04-21 09:15 ┣[&quot;片寄白王&quot; &lt;katayose]                                       </a></span>
<span class="current">-&gt;&nbsp;<a href="9251">   9251 2004-04-21 17:39 ┃┗[川合孝典 &lt;gcd00051@x]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9252">   9252 2004-04-21 18:02 ┃　┣[&quot;山本　瑞己&quot; &lt;mizuki]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9253">   9253 2004-04-21 18:53 ┃　┗[ML account &lt;ml@xxxxx]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9254">   9254 2004-04-22 00:19 ┃　　┗[&quot;KATAYOSE hakuo&quot; &lt;ka]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9255">   9255 2004-04-22 01:42 ┃　　　┗[ML account &lt;ml@xxxxx]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9256">   9256 2004-04-22 09:02 ┃　　　　┗[&quot;片寄白王&quot; &lt;katayose]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9258">   9258 2004-04-22 09:36 ┃　　　　　┗[高橋政利 &lt;takahashi@]                           </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9265">   9265 2004-04-22 11:44 ┃　　　　　　┗[ML account &lt;ml@xxxxx]                         </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9249">   9249 2004-04-21 10:56 ┣[Seiji Tateyama &lt;tate]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9257">   9257 2004-04-22 09:07 ┣[高橋政利 &lt;takahashi@]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9264">   9264 2004-04-22 11:44 ┃┗[ML account &lt;ml@xxxxx]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9277">   9277 2004-04-23 00:29 ┗[Kenji Irie &lt;kenji@xx]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="9279">   9279 2004-04-23 08:01 　┗[高橋政利 &lt;takahashi@]                                     </a></span>
</pre>
</body>
</html>
