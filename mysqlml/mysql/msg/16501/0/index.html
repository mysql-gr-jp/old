<html><head></head><body><div dir="ltr">yoku0825様<div><br></div><div>とても分かり易い説明ありがとうございます。</div><div><br></div><div>- mysqld, クライアントのホストはそれぞれ過負荷になったりパケロスが発生していなかったか<br>→WEBサーバ及びDBサーバのリソースをモニタリングしておりますが、</div><div>　どちらも過負荷に陥っているようには見えませんでした。</div><div>　また、WEBサーバ側はパケットロスは発生しておりませんでした。</div><div>　mysqld側については、クラウドベンダー側に問い合わせを行いたいと思います。</div><div><br></div><div>- 中間にプロキシやソフトウェアルーターをはさんでいる場合、そこが高負荷になっていないか<br></div><div>→プロキシやソフトウェアルータははさんではいないです。</div><div><br></div><div>上記を確認した上で、サーバのインスタンスサイズのアップを検討したいと思います。</div><div>進展がありましたら、ご報告させて頂きます。</div><div><br></div><br><div class="gmail_quote"><div dir="ltr">2018年12月11日(火) 14:35 yoku0825 &lt;<a href="mailto:yoku0825@mysql.gr.jp">yoku0825@mysql.gr.jp</a>&gt;:<br></div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">yoku0825といいます。<br>
<br>
"Lost connection to MySQL server at 'reading initial communication packet'" は<br>
コネクションを確立するシーケンスの最初のパケットの読み取りに失敗（読み取ったパケットが0バイト）の場合に発生します。<br>
<br>
通常、クライアントからmysqldの3306（などの）ポートを叩くと、<br>
mysqldからバージョン番号や認証のためのダイジェストなどを詰めたグリーティングメッセージが返ってくるのですが、<br>
3306を叩いてもそれが返ってこなかったために起こります。<br>
3306を叩くことができなかった場合や、叩いた後に返ってきても不正だった場合は違うエラーメッセージになるので、<br>
「接続を開始しようとはしたが返事がない ~~ただのしかばねのようだ~~ 」という状況になります。<br>
<br>
余談ですが、検索した時にファイアウォールやhost.allowなどが解決策として出てくるのは、<br>
クライアントより下のレイヤー（OS周りなど）で戻りのパケットがドロップされていると<br>
クライアントからはパケットが読み取れないのでこのエラーに到達するためです。<br>
<br>
「エラー発生直後に再接続処理を行うと正常に接続が行える」ことから、<br>
OSやNWのレイヤーで設定が間違っている可能性は低いとは思いますので、<br>
<br>
- mysqld, クライアントのホストはそれぞれ過負荷になったりパケロスが発生していなかったか<br>
- 中間にプロキシやソフトウェアルーターをはさんでいる場合、そこが高負荷になっていないか<br>
<br>
あたりが確認ポイントかなぁと思います。<br>
<br>
- WEBサーバーのインスタンスサイズを1ランク上げる<br>
 - 再発しなくなればWEBサーバーのスペック不足<br>
 - 再発するならDBサーバーのインスタンスサイズを1ランク上げる<br>
  - 再発しなくなればDBサーバーのスペック不足<br>
  - まだ再発するならもう一度WEBサーバーのインスタスサイズを上げるところから<br>
- 上記を十分繰り返しても再発する場合、中間の何かがおかしい可能性が高い<br>
 - VPCを作り直してみるとかそういうやつです<br>
<br>
みたいな切り分けになるかなと思います。<br>
ご参考までに。<br>
<br>
<br>
yoku0825,<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
2018年12月11日(火) 12:03 田中正志 &lt;<a href="mailto:m.tanaka056245@gmail.com" target="_blank">m.tanaka056245@gmail.com</a>&gt;:<br>
&gt;<br>
&gt; 御世話になります。<br>
&gt; 田中と申します。<br>
&gt;<br>
&gt; 次のような構成でシステムを運用しております。<br>
&gt; ■WEBサーバ<br>
&gt; ・CentOS6.9<br>
&gt; ・Apache 2.2.15<br>
&gt; ・php 5.3.3<br>
&gt;<br>
&gt; ■DBサーバ<br>
&gt; ・某社PaaSサービスを利用<br>
&gt; ・MySQL 5.6.22<br>
&gt;<br>
&gt; PaaSのMySQLを利用しているため、こちらのメーリングリストに質問を投稿しても良いものが悩みましたが、エラーの原因究明が手詰まり状態のため投稿させていただきました。<br>
&gt;<br>
&gt; 普段はWEBサーバからDBサーバへは正常に接続が行えておりますが、<br>
&gt; 稀に下記エラーが発生して接続エラーになることがあります。<br>
&gt;<br>
&gt; [2013] Lost connection to MySQL server at 'reading initial communication packet', system error: 0<br>
&gt;<br>
&gt; エラー発生直後に再接続処理を行うと正常に接続が行えます。<br>
&gt; エラーについて調べてみたところ、ファイアウォールやhost.allowなどの設定漏れとの情報が多く見られましたが、<br>
&gt; 平常時は問題なく接続が行えているため、そのあたりの設定に問題はないと考えております。<br>
&gt; 他に有益な情報を見つけることができませんでした。<br>
&gt; また、PaaS提供会社からはインフラ基盤等には異常はないとの回答をいただいております。<br>
&gt;<br>
&gt; 原因として何が考えられるのか御知恵をお貸しいただけますと幸いです。<br>
&gt; 宜しくお願いいたします。<br>
&gt;<br>
</blockquote></div></div>
</body></html>