<html>
<head>
<meta http-equiv="Content-Style-Type" context="text/css">
<title>mysql:7418</title>
<link rel=stylesheet type="text/css" href="../../../css/w3ml.css">
</head>
<body>
<p class="button"><a href="7417">[前]</a><a href="7419">[次]</a><a href="../list/7401-7500">[番号順一覧]</a><a href="../thread/7401-7500">[スレッド一覧]</a></p>
<p class="id">
mysql:7418
</p>
<div class="header">
<p>
From: Shinya Kawaji &lt;Shinya Kawaji &lt;kawaji@xxxxxxxxxx&gt;&gt;<br>
Date: Mon, 07 Apr 2003 20:57:24 +0900<br>
Subject: [mysql 07418] Re: 最新のレコードを○○件残して古いものを削除<br>

</p>
</div>
<div class="body">
<pre>
かわじ、です。


<span class="quote2">&gt; &gt; 最新のレコードを○○件残して古いものを削除するSQL文を発行したいので</span>
<span class="quote2">&gt; &gt; すが、どのように書いたらよいのか悩んでおります。</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt; 　以下のようなsql文でいいのかなぁと思いますが，どうでしょう。</span>
<span class="quote1">&gt; (総レコード件数が10,000件を超えない場合に10件だけ残すことを</span>
<span class="quote1">&gt; 想定しています。)</span>
<span class="quote1">&gt; </span>
<span class="quote1">&gt;  delete from db_name order by timestamp desc limit 10,10000;</span>

delete 文に order by を使うことが出来るのは、MySQL 4.0 以降のようです。
(それと、limit に offset は指定できないような気も)
<a href="http://www.mysql.com/doc/en/DELETE.html">http://www.mysql.com/doc/en/DELETE.html</a>


元の話ですが、何か auto_increment なフィールドを仮に id とし、
また、残す件数を 10000 件 として

新しいものから10000件前の id を調べて
select id from db_name order by id desc limit 10000,1;

上記で id が 得られた場合のみ(10000件以上あった場合のみ)、
それ以前のものを消す
delete from db_name where id &lt; (上記のid);

という感じでいかがでしょう？



</pre>
</div>
<p class="button"><a href="7417">[前]</a><a href="7419">[次]</a><a href="../list/7401-7500">[番号順一覧]</a><a href="../thread/7401-7500">[スレッド一覧]</a></p>
<pre class="list">
<span>&nbsp;&nbsp;&nbsp;<a href="7412">   7412 2003-04-07 18:35 [Satoshi Iwanaga &lt;iwa] インストール・別サーバへ接続            </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7413">   7413 2003-04-07 19:08 ┗[doumae &lt;doumae@xxxxx]                                       </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7414">   7414 2003-04-07 19:51 　┣[yuji koga &lt;koga-y@xx] 最新のレコードを○○件残して古いものを削除</a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7415">   7415 2003-04-07 20:12 　┃┣[Daiju Azuma &lt;daiju_a]                                   </a></span>
<span class="current">-&gt;&nbsp;<a href="7418">   7418 2003-04-07 20:57 　┃┃┗[Shinya Kawaji &lt;kawaj]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7420">   7420 2003-04-07 21:24 　┃┃　┗[Daiju Azuma &lt;daiju_a]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7422">   7422 2003-04-08 09:54 　┃┗[yuji koga &lt;koga-y@xx]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7416">   7416 2003-04-07 20:16 　┣[Satoshi Iwanaga &lt;iwa]                                     </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7423">   7423 2003-04-08 15:12 　┃┗[Satoshi Iwanaga &lt;iwa]                                   </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7424">   7424 2003-04-08 15:47 　┃　┗[doumae &lt;doumae@xxxxx]                                 </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7425">   7425 2003-04-08 16:12 　┃　　┗[Satoshi Iwanaga &lt;iwa]                               </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7426">   7426 2003-04-08 16:48 　┃　　　┣[&quot;TOYOSHIMA,Masayuki&quot;]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7432">   7432 2003-04-09 14:26 　┃　　　┗[Satoshi Iwanaga &lt;iwa]                             </a></span>
<span>&nbsp;&nbsp;&nbsp;<a href="7417">   7417 2003-04-07 20:21 　┗[doumae &lt;doumae@xxxxx]                                     </a></span>
</pre>
</body>
</html>
